<custom-navbar title="搜索" showBack="{{true}}" bind:navheight="onNavHeight" />

<view class="page-container" style="padding-top: {{navBarHeight}}px;">
  <view class="responsive-container">
  <!-- 搜索框 -->
  <view class="search-section">
    <t-search 
      value="{{keyword}}" 
      placeholder="搜索菜品、商家" 
      bind:change="onSearchChange"
      bind:submit="onSearch"
    />
  </view>

  <!-- Tab切换 -->
  <view class="tabs-section">
    <t-tabs value="{{activeTab}}" bind:change="onTabChange">
      <t-tab-panel label="菜品" value="dishes" />
      <t-tab-panel label="餐厅" value="restaurants" />
    </t-tabs>
  </view>

  <!-- 加载中 -->
  <t-loading wx:if="{{loading}}" theme="circular" size="40rpx" class="loading" />

  <!-- 菜品结果 -->
  <view wx:if="{{activeTab === 'dishes' && !loading}}" class="results">
    <view wx:if="{{dishes.length === 0}}" class="empty">
      <t-empty description="暂无搜索结果" />
    </view>
    <view wx:else>
      <view 
        wx:for="{{dishes}}" 
        wx:key="id" 
        class="dish-item"
        data-id="{{item.id}}"
        bindtap="onDishTap"
      >
        <t-image class="dish-image" src="{{item.image_url}}" mode="aspectFill" />
        <view class="dish-info">
          <text class="dish-name">{{item.name}}</text>
          <text class="dish-shop">{{item.shop_name}}</text>
          <view class="dish-meta">
            <text class="rating">⭐{{item.rating}}</text>
            <text class="sales">月销{{item.month_sales}}</text>
          </view>
          <text class="dish-price">¥{{item.price / 100}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 餐厅结果 -->
  <view wx:if="{{activeTab === 'restaurants' && !loading}}" class="results">
    <view wx:if="{{restaurants.length === 0}}" class="empty">
      <t-empty description="暂无搜索结果" />
    </view>
    <view wx:else>
      <view 
        wx:for="{{restaurants}}" 
        wx:key="id" 
        class="restaurant-item"
        data-id="{{item.id}}"
        bindtap="onRestaurantTap"
      >
        <t-image class="restaurant-image" src="{{item.cover_image}}" mode="aspectFill" />
        <view class="restaurant-info">
          <text class="restaurant-name">{{item.name}}</text>
          <view class="restaurant-meta">
            <text class="rating">⭐{{item.rating}}</text>
            <text class="reviews">{{item.review_count}}条评价</text>
            <text class="distance">{{item.distance_meters}}m</text>
          </view>
        </view>
      </view>
    </view>
    </view>
</view>
</view>
