<!-- ç»è¥ç»Ÿè®¡é¡µé¢ - PC-SaaS å¸ƒå±€ -->
<wxs module="utils">
  module.exports = {
    formatAmount: function(fen) {
      return (fen / 100).toFixed(2)
    },
    formatOrderType: function(type) {
      var map = {
        'takeout': 'å¤–å–',
        'dine_in': 'å ‚é£Ÿ',
        'pickup': 'è‡ªå–'
      }
      return map[type] || type
    },
    formatPercent: function(rate) {
      return (rate * 100).toFixed(1) + '%'
    }
  }
</wxs>

<!-- å°å±æç¤º -->
<match-media max-width="1599">
  <view class="desktop-only-notice">
    <view class="notice-box">
      <view class="notice-icon">ğŸ“Š</view>
      <text class="notice-title">æ­¤åŠŸèƒ½éœ€è¦åœ¨ç”µè„‘ç«¯ä½¿ç”¨</text>
      <text class="notice-desc">è¯·ä½¿ç”¨ 1600px ä»¥ä¸Šåˆ†è¾¨ç‡çš„æ˜¾ç¤ºå™¨è®¿é—®ç»è¥ç»Ÿè®¡</text>
      <navigator url="/pages/merchant/dashboard/index" class="btn-back">è¿”å›å·¥ä½œå°</navigator>
    </view>
  </view>
</match-media>

<!-- å¤§å±å¸ƒå±€ -->
<match-media min-width="1600">
  <view class="saas-layout">
    <!-- ä¾§è¾¹æ  -->

    <!-- ä¸»åŒºåŸŸ -->
    <view class="main-area" style="margin-left: 0;">
      <!-- é¡¶éƒ¨æ  -->

      <!-- é¡µé¢å†…å®¹ -->
      <view class="page-container">
        <!-- æ ‡é¢˜æ  -->
        <view class="page-header">
          <view class="page-title">
            <text class="title-icon">ğŸ“Š</text>
            <text class="title-text">ç»è¥ç»Ÿè®¡</text>
          </view>
          <!-- æ—¥æœŸèŒƒå›´ -->
          <view class="date-range-picker">
            <view class="range-option {{dateRange === 'today' ? 'active' : ''}}" data-range="today" bindtap="onDateRangeChange">ä»Šå¤©</view>
            <view class="range-option {{dateRange === 'week' ? 'active' : ''}}" data-range="week" bindtap="onDateRangeChange">è¿‘7å¤©</view>
            <view class="range-option {{dateRange === 'month' ? 'active' : ''}}" data-range="month" bindtap="onDateRangeChange">è¿‘30å¤©</view>
          </view>
        </view>

        <!-- åŠ è½½çŠ¶æ€ -->
        <view wx:if="{{loading}}" class="loading-state">
          <view class="loading-spinner"></view>
          <text>åŠ è½½ä¸­...</text>
        </view>

        <!-- å†…å®¹åŒº -->
        <view wx:else class="stats-content">
          <!-- æ¦‚è§ˆå¡ç‰‡ -->
          <view class="overview-cards">
            <view class="stat-card">
              <text class="card-label">æ€»é”€å”®é¢</text>
              <text class="card-value primary">Â¥{{utils.formatAmount(overview.total_sales || 0)}}</text>
            </view>
            <view class="stat-card">
              <text class="card-label">æ€»è®¢å•æ•°</text>
              <text class="card-value">{{overview.total_orders || 0}}</text>
            </view>
            <view class="stat-card">
              <text class="card-label">æ—¥å‡é”€å”®</text>
              <text class="card-value">Â¥{{utils.formatAmount(overview.avg_daily_sales || 0)}}</text>
            </view>
            <view class="stat-card">
              <text class="card-label">å¹³å°ä½£é‡‘</text>
              <text class="card-value warning">Â¥{{utils.formatAmount(overview.total_commission || 0)}}</text>
            </view>
          </view>

          <!-- ä¸¤åˆ—å¸ƒå±€ -->
          <view class="two-column-layout">
            <!-- å·¦åˆ— -->
            <view class="left-column">
              <!-- æ—¥æŠ¥è¶‹åŠ¿ -->
              <view class="section-card">
                <text class="section-title">ğŸ“ˆ é”€å”®è¶‹åŠ¿</text>
                <view class="daily-list">
                  <view wx:if="{{dailyStats.length === 0}}" class="empty-hint">æš‚æ— æ•°æ®</view>
                  <view wx:for="{{dailyStats}}" wx:key="date" class="daily-row">
                    <text class="daily-date">{{item.date}}</text>
                    <text class="daily-orders">{{item.order_count}}å•</text>
                    <text class="daily-sales">Â¥{{utils.formatAmount(item.total_sales)}}</text>
                  </view>
                </view>
              </view>

              <!-- æ—¶æ®µåˆ†æ -->
              <view class="section-card">
                <text class="section-title">â° æ—¶æ®µåˆ†å¸ƒ</text>
                <view class="hourly-chart">
                  <view wx:if="{{hourlyStats.length === 0}}" class="empty-hint">æš‚æ— æ•°æ®</view>
                  <view wx:for="{{hourlyStats}}" wx:key="hour" class="hourly-bar-row">
                    <text class="hourly-label">{{item.hour}}:00</text>
                    <view class="hourly-bar-wrap">
                      <view class="hourly-bar" style="width: {{item.order_count * 10}}px;"></view>
                    </view>
                    <text class="hourly-count">{{item.order_count}}å•</text>
                  </view>
                </view>
              </view>
            </view>

            <!-- å³åˆ— -->
            <view class="right-column">
              <!-- è®¢å•æ¥æº -->
              <view class="section-card">
                <text class="section-title">ğŸ“± è®¢å•æ¥æº</text>
                <view class="source-list">
                  <view wx:if="{{sourceStats.length === 0}}" class="empty-hint">æš‚æ— æ•°æ®</view>
                  <view wx:for="{{sourceStats}}" wx:key="order_type" class="source-row">
                    <text class="source-type">{{utils.formatOrderType(item.order_type)}}</text>
                    <text class="source-count">{{item.order_count}}å•</text>
                    <text class="source-sales">Â¥{{utils.formatAmount(item.total_sales)}}</text>
                  </view>
                </view>
              </view>

              <!-- å¤è´­ç‡ -->
              <view class="section-card">
                <text class="section-title">ğŸ”„ å¤è´­åˆ†æ</text>
                <view wx:if="{{repurchaseRate}}" class="repurchase-stats">
                  <view class="repurchase-row">
                    <text class="rep-label">å¤è´­ç‡</text>
                    <text class="rep-value highlight">{{utils.formatPercent(repurchaseRate.repurchase_rate)}}</text>
                  </view>
                  <view class="repurchase-row">
                    <text class="rep-label">æ€»é¡¾å®¢æ•°</text>
                    <text class="rep-value">{{repurchaseRate.total_users}}</text>
                  </view>
                  <view class="repurchase-row">
                    <text class="rep-label">å¤è´­é¡¾å®¢</text>
                    <text class="rep-value">{{repurchaseRate.repeat_users}}</text>
                  </view>
                  <view class="repurchase-row">
                    <text class="rep-label">äººå‡è®¢å•</text>
                    <text class="rep-value">{{repurchaseRate.avg_orders_per_user}}å•</text>
                  </view>
                </view>
                <view wx:else class="empty-hint">æš‚æ— æ•°æ®</view>
              </view>

              <!-- åˆ†ç±»é”€å”® -->
              <view class="section-card">
                <text class="section-title">ğŸ·ï¸ åˆ†ç±»é”€å”®</text>
                <view class="category-list">
                  <view wx:if="{{categoryStats.length === 0}}" class="empty-hint">æš‚æ— æ•°æ®</view>
                  <view wx:for="{{categoryStats}}" wx:key="category_name" class="category-row">
                    <text class="cat-name">{{item.category_name}}</text>
                    <text class="cat-qty">{{item.total_quantity}}ä»½</text>
                    <text class="cat-sales">Â¥{{utils.formatAmount(item.total_sales)}}</text>
                  </view>
                </view>
              </view>
            </view>
          </view>

          <!-- æ’è¡Œæ¦œåŒºåŸŸ -->
          <view class="rankings-section">
            <!-- çƒ­é—¨èœå“ -->
            <view class="ranking-card">
              <text class="section-title">ğŸ† èœå“é”€é‡ Top 10</text>
              <view class="ranking-table">
                <view class="ranking-header">
                  <text class="rank-col">æ’å</text>
                  <text class="name-col">èœå“</text>
                  <text class="qty-col">é”€é‡</text>
                  <text class="amount-col">é”€å”®é¢</text>
                </view>
                <view wx:if="{{topDishes.length === 0}}" class="empty-hint">æš‚æ— æ•°æ®</view>
                <view wx:for="{{topDishes}}" wx:key="dish_id" class="ranking-row">
                  <text class="rank-col rank-{{index + 1}}">{{index + 1}}</text>
                  <text class="name-col">{{item.dish_name}}</text>
                  <text class="qty-col">{{item.total_sold}}</text>
                  <text class="amount-col">Â¥{{utils.formatAmount(item.total_revenue)}}</text>
                </view>
              </view>
            </view>

            <!-- æ¶ˆè´¹æ’è¡Œ -->
            <view class="ranking-card">
              <text class="section-title">ğŸ‘¤ é¡¾å®¢æ¶ˆè´¹ Top 10</text>
              <view class="ranking-table">
                <view class="ranking-header">
                  <text class="rank-col">æ’å</text>
                  <text class="name-col">é¡¾å®¢</text>
                  <text class="qty-col">è®¢å•æ•°</text>
                  <text class="amount-col">æ¶ˆè´¹é¢</text>
                </view>
                <view wx:if="{{topCustomers.length === 0}}" class="empty-hint">æš‚æ— æ•°æ®</view>
                <view wx:for="{{topCustomers}}" wx:key="user_id" class="ranking-row">
                  <text class="rank-col rank-{{index + 1}}">{{index + 1}}</text>
                  <text class="name-col">{{item.full_name || 'åŒ¿åé¡¾å®¢'}}</text>
                  <text class="qty-col">{{item.total_orders}}</text>
                  <text class="amount-col">Â¥{{utils.formatAmount(item.total_amount)}}</text>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
</match-media>
