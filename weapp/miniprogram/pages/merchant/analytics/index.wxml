<custom-navbar title="数据分析" showBack="{{true}}" bind:navheight="onNavHeight" />

<view class="page-container {{isLargeScreen ? 'large-screen' : ''}}" style="padding-top: {{navBarHeight}}px;">
  <!-- 时间筛选 -->
  <view class="time-filter">
    <t-tabs value="{{timeRange}}" bind:change="onTimeRangeChange">
      <t-tab-panel label="今天" value="TODAY" />
      <t-tab-panel label="本周" value="WEEK" />
      <t-tab-panel label="本月" value="MONTH" />
    </t-tabs>
  </view>

  <t-loading wx:if="{{loading}}" theme="circular" size="40rpx" class="loading" />

  <view wx:if="{{!loading}}" class="analytics-container">
    <!-- 核心指标卡片 -->
    <view class="metrics-grid">
      <view class="metric-card">
        <text class="metric-label">GMV</text>
        <text class="metric-value">¥{{metrics.gmv.value}}k</text>
        <text class="metric-change positive">+{{metrics.gmv.change}}%</text>
      </view>
      <view class="metric-card">
        <text class="metric-label">订单数</text>
        <text class="metric-value">{{metrics.orderCount.value}}</text>
        <text class="metric-change positive">+{{metrics.orderCount.change}}%</text>
      </view>
      <view class="metric-card">
        <text class="metric-label">客单价</text>
        <text class="metric-value">¥{{metrics.avgOrderValue.value}}</text>
        <text class="metric-change positive">+{{metrics.avgOrderValue.change}}%</text>
      </view>
      <view class="metric-card">
        <text class="metric-label">复购率</text>
        <text class="metric-value">{{metrics.repeatRate.value}}%</text>
        <text class="metric-change positive">+{{metrics.repeatRate.change}}%</text>
      </view>
    </view>

    <!-- 菜品销量TOP10 -->
    <view class="chart-section">
      <view class="section-title">菜品销量TOP10</view>
      <view class="top-dishes">
        <view wx:for="{{topDishes}}" wx:key="name" class="dish-row">
          <text class="dish-rank">{{index + 1}}</text>
          <text class="dish-name">{{item.name}}</text>
          <view class="dish-bar" style="width: {{item.sales / 5}}rpx;"></view>
          <text class="dish-sales">{{item.sales}}份</text>
        </view>
      </view>
    </view>

    <!-- 提示信息 -->
    <view class="tip-section">
      <t-cell-group>
        <t-cell title="销售趋势图" note="需要集成ECharts" />
        <t-cell title="时段分析" note="需要集成ECharts" />
      </t-cell-group>
    </view>
  </view>
</view>
