<!-- è®¢å•ç®¡ç† - æ¡Œé¢çº§ SaaS ç•Œé¢ -->
<!-- ä»… PC-Full (>=1600px) æ”¯æŒ -->

<match-media max-width="1599">
  <view class="desktop-only-notice">
    <view class="notice-box">
      <view class="notice-icon">ğŸ–¥ï¸</view>
      <text class="notice-title">æ­¤åŠŸèƒ½éœ€è¦åœ¨ç”µè„‘ç«¯ä½¿ç”¨</text>
      <text class="notice-desc">è¯·ä½¿ç”¨ 1600px ä»¥ä¸Šåˆ†è¾¨ç‡çš„æ˜¾ç¤ºå™¨è®¿é—®è®¢å•ç®¡ç†ç³»ç»Ÿ</text>
      <button class="btn-back" bindtap="goBack">è¿”å›å·¥ä½œå°</button>
    </view>
  </view>
</match-media>

<match-media min-width="1600">
  <view class="saas-layout">
    <!-- ä¾§è¾¹æ  -->
    <merchant-sidebar 
      current-path="orders" 
      collapsed="{{sidebarCollapsed}}"
      pending-order-count="{{statusCounts.paid}}"
      bind:collapse="onSidebarCollapse"
    />

    <!-- ä¸»åŒºåŸŸ -->
    <view class="main-area" style="margin-left: {{sidebarCollapsed ? 64 : 200}}px;">
      <!-- é¡¶éƒ¨æ  -->
      <merchant-header 
        merchant-name="{{merchantName}}"
        is-open="{{isOpen}}"
        sidebar-width="{{sidebarCollapsed ? 64 : 200}}"
      />

      <!-- é¡µé¢å†…å®¹ -->
      <view class="page-container">
        <!-- é¡µé¢å¤´éƒ¨ -->
        <view class="page-header">
          <view class="page-title-section">
            <text class="page-title">è®¢å•ç®¡ç†</text>
            <text class="page-subtitle">ç®¡ç†æ‰€æœ‰è®¢å•çš„æ¥å•ã€åˆ¶ä½œå’Œå®Œæˆæµç¨‹</text>
          </view>
          <view class="page-actions">
            <button class="btn-refresh" bindtap="refreshOrders">
              <text class="btn-icon">ğŸ”„</text>
              <text>åˆ·æ–°</text>
            </button>
            <button class="btn-export" bindtap="exportOrders">
              <text class="btn-icon">ğŸ“Š</text>
              <text>å¯¼å‡º</text>
            </button>
          </view>
        </view>

        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <view class="stats-cards">
          <view class="stat-card warning" bindtap="filterByStatus" data-status="paid">
            <view class="stat-value">{{statusCounts.paid}}</view>
            <view class="stat-label">å¾…æ¥å•</view>
            <view class="stat-trend" wx:if="{{statusCounts.paid > 0}}">éœ€ç«‹å³å¤„ç†</view>
          </view>
          <view class="stat-card info" bindtap="filterByStatus" data-status="preparing">
            <view class="stat-value">{{statusCounts.preparing}}</view>
            <view class="stat-label">åˆ¶ä½œä¸­</view>
          </view>
          <view class="stat-card success" bindtap="filterByStatus" data-status="ready">
            <view class="stat-value">{{statusCounts.ready}}</view>
            <view class="stat-label">å¾…å‡ºé¤</view>
          </view>
          <view class="stat-card" bindtap="filterByStatus" data-status="completed">
            <view class="stat-value">{{statusCounts.completed}}</view>
            <view class="stat-label">ä»Šæ—¥å®Œæˆ</view>
          </view>
          <view class="stat-card primary">
            <view class="stat-value">Â¥{{todayRevenue}}</view>
            <view class="stat-label">ä»Šæ—¥è¥ä¸šé¢</view>
          </view>
        </view>

        <!-- ç­›é€‰å·¥å…·æ  -->
        <view class="filter-toolbar">
          <view class="filter-left">
            <!-- çŠ¶æ€ç­›é€‰ -->
            <view class="filter-group">
              <view 
                class="filter-tab {{currentStatus === '' ? 'active' : ''}}" 
                bindtap="filterByStatus" 
                data-status=""
              >å…¨éƒ¨</view>
              <view 
                class="filter-tab {{currentStatus === 'paid' ? 'active' : ''}}" 
                bindtap="filterByStatus" 
                data-status="paid"
              >å¾…æ¥å• <text class="badge" wx:if="{{statusCounts.paid}}">{{statusCounts.paid}}</text></view>
              <view 
                class="filter-tab {{currentStatus === 'preparing' ? 'active' : ''}}" 
                bindtap="filterByStatus" 
                data-status="preparing"
              >åˆ¶ä½œä¸­</view>
              <view 
                class="filter-tab {{currentStatus === 'ready' ? 'active' : ''}}" 
                bindtap="filterByStatus" 
                data-status="ready"
              >å¾…å‡ºé¤</view>
              <view 
                class="filter-tab {{currentStatus === 'completed' ? 'active' : ''}}" 
                bindtap="filterByStatus" 
                data-status="completed"
              >å·²å®Œæˆ</view>
              <view 
                class="filter-tab {{currentStatus === 'cancelled' ? 'active' : ''}}" 
                bindtap="filterByStatus" 
                data-status="cancelled"
              >å·²å–æ¶ˆ</view>
            </view>
          </view>
          <view class="filter-right">
            <!-- ç±»å‹ç­›é€‰ -->
            <view class="select-box" bindtap="showTypeFilter">
              <text>{{orderTypeLabel}}</text>
              <text class="arrow">â–¼</text>
            </view>
            <!-- æœç´¢ -->
            <view class="search-box">
              <text class="search-icon">ğŸ”</text>
              <input 
                class="search-input" 
                placeholder="æœç´¢è®¢å•å·/å¤‡æ³¨" 
                value="{{searchKeyword}}"
                bindinput="onSearchInput"
                bindconfirm="doSearch"
              />
            </view>
          </view>
        </view>

        <!-- è®¢å•è¡¨æ ¼ -->
        <view class="table-container">
          <view class="table-wrapper">
            <!-- è¡¨å¤´ -->
            <view class="table-header">
              <view class="th th-checkbox">
                <view class="checkbox {{allSelected ? 'checked' : ''}}" bindtap="toggleSelectAll"></view>
              </view>
              <view class="th th-order-no">è®¢å•å·</view>
              <view class="th th-type">ç±»å‹</view>
              <view class="th th-items">å•†å“</view>
              <view class="th th-amount">é‡‘é¢</view>
              <view class="th th-status">çŠ¶æ€</view>
              <view class="th th-time">ä¸‹å•æ—¶é—´</view>
              <view class="th th-actions">æ“ä½œ</view>
            </view>

            <!-- åŠ è½½ä¸­ -->
            <view wx:if="{{loading}}" class="table-loading">
              <view class="loading-spinner"></view>
              <text>åŠ è½½ä¸­...</text>
            </view>

            <!-- ç©ºçŠ¶æ€ -->
            <view wx:elif="{{orders.length === 0}}" class="table-empty">
              <text class="empty-icon">ğŸ“‹</text>
              <text class="empty-text">æš‚æ— è®¢å•æ•°æ®</text>
            </view>

            <!-- è¡¨æ ¼å†…å®¹ -->
            <scroll-view wx:else scroll-y class="table-body">
              <view 
                wx:for="{{orders}}" 
                wx:key="id" 
                class="table-row {{item.selected ? 'selected' : ''}} status-{{item.status}}"
              >
                <view class="td td-checkbox">
                  <view 
                    class="checkbox {{item.selected ? 'checked' : ''}}" 
                    catchtap="toggleSelect" 
                    data-id="{{item.id}}"
                  ></view>
                </view>
                <view class="td td-order-no">
                  <text class="order-no">#{{item.order_no}}</text>
                  <text class="order-note" wx:if="{{item.notes}}">{{item.notes}}</text>
                </view>
                <view class="td td-type">
                  <view class="type-tag {{item.order_type}}">{{item.order_type_label}}</view>
                </view>
                <view class="td td-items">
                  <text class="items-summary">{{item.items_summary}}</text>
                  <text class="items-count">å…±{{item.items_count}}ä»¶</text>
                </view>
                <view class="td td-amount">
                  <text class="amount">Â¥{{item.total_display}}</text>
                  <text class="discount" wx:if="{{item.discount_amount > 0}}">-Â¥{{item.discount_display}}</text>
                </view>
                <view class="td td-status">
                  <view class="status-badge status-{{item.status}}">{{item.status_label}}</view>
                </view>
                <view class="td td-time">
                  <text class="time-date">{{item.created_date}}</text>
                  <text class="time-clock">{{item.created_time}}</text>
                </view>
                <view class="td td-actions">
                  <!-- å¾…æ¥å• -->
                  <block wx:if="{{item.status === 'paid'}}">
                    <button class="btn-action accept" catchtap="acceptOrder" data-id="{{item.id}}">æ¥å•</button>
                    <button class="btn-action reject" catchtap="rejectOrder" data-id="{{item.id}}">æ‹’å•</button>
                  </block>
                  <!-- åˆ¶ä½œä¸­ -->
                  <block wx:elif="{{item.status === 'preparing'}}">
                    <button class="btn-action ready" catchtap="markReady" data-id="{{item.id}}">å‡ºé¤</button>
                  </block>
                  <!-- å¾…å‡ºé¤/é…é€ä¸­ -->
                  <block wx:elif="{{item.status === 'ready' || item.status === 'delivering'}}">
                    <button class="btn-action complete" catchtap="completeOrder" data-id="{{item.id}}">å®Œæˆ</button>
                  </block>
                  <!-- é€šç”¨ -->
                  <button class="btn-action detail" catchtap="viewDetail" data-id="{{item.id}}">è¯¦æƒ…</button>
                  <button class="btn-action print" catchtap="printOrder" data-id="{{item.id}}">æ‰“å°</button>
                </view>
              </view>
            </scroll-view>
          </view>

          <!-- åˆ†é¡µ -->
          <view class="pagination" wx:if="{{totalPages > 1}}">
            <view class="page-info">å…± {{totalCount}} æ¡è®°å½•</view>
            <view class="page-controls">
              <button 
                class="page-btn {{currentPage <= 1 ? 'disabled' : ''}}" 
                bindtap="prevPage"
                disabled="{{currentPage <= 1}}"
              >ä¸Šä¸€é¡µ</button>
              <view class="page-numbers">
                <view 
                  wx:for="{{pageNumbers}}" 
                  wx:key="*this"
                  class="page-num {{currentPage === item ? 'active' : ''}}"
                  bindtap="goToPage"
                  data-page="{{item}}"
                >{{item}}</view>
              </view>
              <button 
                class="page-btn {{currentPage >= totalPages ? 'disabled' : ''}}" 
                bindtap="nextPage"
                disabled="{{currentPage >= totalPages}}"
              >ä¸‹ä¸€é¡µ</button>
            </view>
            <view class="page-size">
              <text>æ¯é¡µ</text>
              <picker mode="selector" range="{{pageSizeOptions}}" value="{{pageSizeIndex}}" bindchange="changePageSize">
                <view class="picker-value">{{pageSize}}</view>
              </picker>
              <text>æ¡</text>
            </view>
          </view>
        </view>

        <!-- æ‰¹é‡æ“ä½œæ  -->
        <view class="batch-actions" wx:if="{{selectedCount > 0}}">
          <text class="selected-info">å·²é€‰æ‹© {{selectedCount}} é¡¹</text>
          <button class="batch-btn accept" bindtap="batchAccept" wx:if="{{canBatchAccept}}">æ‰¹é‡æ¥å•</button>
          <button class="batch-btn print" bindtap="batchPrint">æ‰¹é‡æ‰“å°</button>
          <button class="batch-btn cancel" bindtap="clearSelection">å–æ¶ˆé€‰æ‹©</button>
        </view>
      </view>
    </view>
  </view>

  <!-- è®¢å•è¯¦æƒ…æŠ½å±‰ -->
  <view class="drawer-mask {{showDetail ? 'visible' : ''}}" bindtap="closeDetail"></view>
  <view class="drawer {{showDetail ? 'visible' : ''}}">
    <view class="drawer-header">
      <text class="drawer-title">è®¢å•è¯¦æƒ…</text>
      <view class="drawer-close" bindtap="closeDetail">âœ•</view>
    </view>
    <scroll-view scroll-y class="drawer-body" wx:if="{{detailOrder}}">
      <!-- è®¢å•åŸºæœ¬ä¿¡æ¯ -->
      <view class="detail-section">
        <view class="section-title">è®¢å•ä¿¡æ¯</view>
        <view class="info-grid">
          <view class="info-item">
            <text class="info-label">è®¢å•å·</text>
            <text class="info-value">#{{detailOrder.order_no}}</text>
          </view>
          <view class="info-item">
            <text class="info-label">è®¢å•ç±»å‹</text>
            <text class="info-value">{{detailOrder.order_type_label}}</text>
          </view>
          <view class="info-item">
            <text class="info-label">è®¢å•çŠ¶æ€</text>
            <view class="status-badge status-{{detailOrder.status}}">{{detailOrder.status_label}}</view>
          </view>
          <view class="info-item">
            <text class="info-label">ä¸‹å•æ—¶é—´</text>
            <text class="info-value">{{detailOrder.created_at}}</text>
          </view>
          <view class="info-item" wx:if="{{detailOrder.paid_at}}">
            <text class="info-label">æ”¯ä»˜æ—¶é—´</text>
            <text class="info-value">{{detailOrder.paid_at}}</text>
          </view>
          <view class="info-item" wx:if="{{detailOrder.table_id}}">
            <text class="info-label">æ¡Œå°</text>
            <text class="info-value">{{detailOrder.table_no}}</text>
          </view>
        </view>
      </view>

      <!-- å•†å“æ˜ç»† -->
      <view class="detail-section">
        <view class="section-title">å•†å“æ˜ç»†</view>
        <view class="items-list">
          <view class="item-row" wx:for="{{detailOrder.items}}" wx:key="id">
            <image class="item-image" src="{{item.image_url || '/assets/placeholder.png'}}" mode="aspectFill" />
            <view class="item-info">
              <text class="item-name">{{item.name}}</text>
              <text class="item-customs" wx:if="{{item.customizations}}">{{item.customizations}}</text>
            </view>
            <text class="item-qty">x{{item.quantity}}</text>
            <text class="item-price">Â¥{{item.subtotal / 100}}</text>
          </view>
        </view>
      </view>

      <!-- é‡‘é¢æ˜ç»† -->
      <view class="detail-section">
        <view class="section-title">é‡‘é¢æ˜ç»†</view>
        <view class="amount-rows">
          <view class="amount-row">
            <text>å•†å“å°è®¡</text>
            <text>Â¥{{detailOrder.subtotal / 100}}</text>
          </view>
          <view class="amount-row" wx:if="{{detailOrder.delivery_fee > 0}}">
            <text>é…é€è´¹</text>
            <text>Â¥{{detailOrder.delivery_fee / 100}}</text>
          </view>
          <view class="amount-row discount" wx:if="{{detailOrder.discount_amount > 0}}">
            <text>ä¼˜æƒ </text>
            <text>-Â¥{{detailOrder.discount_amount / 100}}</text>
          </view>
          <view class="amount-row total">
            <text>å®ä»˜é‡‘é¢</text>
            <text class="total-value">Â¥{{detailOrder.total_amount / 100}}</text>
          </view>
        </view>
      </view>

      <!-- å¤‡æ³¨ -->
      <view class="detail-section" wx:if="{{detailOrder.notes}}">
        <view class="section-title">è®¢å•å¤‡æ³¨</view>
        <view class="notes-box">{{detailOrder.notes}}</view>
      </view>
    </scroll-view>

    <view class="drawer-footer" wx:if="{{detailOrder}}">
      <button class="btn-print-lg" bindtap="printCurrentOrder">æ‰“å°å°ç¥¨</button>
      <block wx:if="{{detailOrder.status === 'paid'}}">
        <button class="btn-reject-lg" bindtap="rejectCurrentOrder">æ‹’å•</button>
        <button class="btn-accept-lg" bindtap="acceptCurrentOrder">æ¥å•</button>
      </block>
      <block wx:elif="{{detailOrder.status === 'preparing'}}">
        <button class="btn-ready-lg" bindtap="markCurrentReady">å‡ºé¤å®Œæˆ</button>
      </block>
    </view>
  </view>
</match-media>
