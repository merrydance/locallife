<import src="./shared-templates.wxml" />
<!-- PC-Full: SaaS å¸ƒå±€ï¼ˆä¾§è¾¹æ  + é¡¶æ  + ä¸»å†…å®¹åŒºï¼‰ -->
<view class="pc-saas-layout">
  <!-- ä¾§è¾¹æ å¯¼èˆª -->
  <merchant-sidebar 
    current-path="dashboard" 
    collapsed="{{sidebarCollapsed}}"
    pending-order-count="{{pendingOrders.length}}"
    bind:menuchange="onSidebarMenuChange"
    bind:collapse="onSidebarCollapse"
  />

  <!-- ä¸»åŒºåŸŸå®¹å™¨ -->
  <view class="saas-main" style="margin-left: {{sidebarCollapsed ? 64 : 200}}px;">
    <!-- é¡¶éƒ¨å·¥å…·æ  -->
    <merchant-header 
      merchant-name="{{merchantName}}"
      is-open="{{isOpen}}"
      owner-name="{{ownerName}}"
      avatar-url="{{avatarUrl}}"
      unread-count="{{unreadNotifications}}"
      sidebar-width="{{sidebarCollapsed ? 64 : 200}}"
      bind:togglestatus="onToggleStatus"
    />

    <!-- ä¸»å†…å®¹åŒº -->
    <view class="saas-content">
      <!-- ç»Ÿè®¡å¡ç‰‡åŒº -->
      <view class="stats-row">
        <view class="stat-card primary">
          <view class="stat-icon">ğŸ’°</view>
          <view class="stat-info">
            <text class="stat-label">ä»Šæ—¥è¥ä¸šé¢</text>
            <text class="stat-value">Â¥{{stats.todayRevenue / 100}}</text>
            <text class="stat-trend {{stats.revenueGrowth >= 0 ? 'up' : 'down'}}">
              {{stats.revenueGrowth >= 0 ? 'â†‘' : 'â†“'}}{{Math.abs(stats.revenueGrowth)}}%
            </text>
          </view>
        </view>
        <view class="stat-card">
          <view class="stat-icon">ğŸ“‹</view>
          <view class="stat-info">
            <text class="stat-label">ä»Šæ—¥è®¢å•</text>
            <text class="stat-value">{{stats.todayOrders}}</text>
            <text class="stat-trend up">è¾ƒæ˜¨æ—¥</text>
          </view>
        </view>
        <view class="stat-card">
          <view class="stat-icon">ğŸ’µ</view>
          <view class="stat-info">
            <text class="stat-label">å®¢å•ä»·</text>
            <text class="stat-value">Â¥{{stats.avgOrderAmount / 100}}</text>
          </view>
        </view>
        <view class="stat-card">
          <view class="stat-icon">ğŸ‘¥</view>
          <view class="stat-info">
            <text class="stat-label">æ–°å®¢æˆ·</text>
            <text class="stat-value">{{stats.newCustomers}}</text>
          </view>
        </view>
      </view>

      <!-- ä¸»é¢æ¿åŒºåŸŸ -->
      <view class="main-panels">
        <!-- å·¦ä¾§ï¼šå®æ—¶è®¢å•æµ -->
        <view class="panel order-panel">
          <view class="panel-header">
            <text class="panel-title">å®æ—¶è®¢å•</text>
            <view class="order-tabs">
              <view class="tab {{orderCategory === 'all' ? 'active' : ''}}" bindtap="onOrderCategoryChange" data-value="all">å…¨éƒ¨</view>
              <view class="tab {{orderCategory === 'dinein' ? 'active' : ''}}" bindtap="onOrderCategoryChange" data-value="dinein">å ‚é£Ÿ</view>
              <view class="tab {{orderCategory === 'takeout' ? 'active' : ''}}" bindtap="onOrderCategoryChange" data-value="takeout">å¤–å–</view>
            </view>
            <view class="order-count">{{filteredOrders.length}}</view>
          </view>
          <scroll-view scroll-y class="panel-body order-list">
            <view wx:if="{{filteredOrders.length === 0}}" class="empty-state">
              <text>æš‚æ— å¾…å¤„ç†è®¢å•</text>
            </view>
            <view 
              wx:for="{{filteredOrders}}" 
              wx:key="id" 
              class="order-card {{item.orderType}}"
            >
              <view class="order-header">
                <text class="order-id">#{{item.orderNo}}</text>
                <text class="order-time">{{item.waitTime}}</text>
              </view>
              <view class="order-items">
                <view wx:for="{{item.items}}" wx:for-item="dish" wx:key="id" class="order-item">
                  <text>{{dish.name}} Ã— {{dish.quantity}}</text>
                </view>
              </view>
              <view class="order-footer">
                <text class="order-total">Â¥{{item.totalAmount / 100}}</text>
                <view class="order-actions">
                  <button class="btn-reject" bindtap="onRejectOrder" data-id="{{item.id}}">æ‹’å•</button>
                  <button class="btn-accept" bindtap="onAcceptOrder" data-id="{{item.id}}">æ¥å•</button>
                </view>
              </view>
            </view>
          </scroll-view>
        </view>

        <!-- å³ä¾§ï¼šæ¡Œå°çŠ¶æ€ -->
        <view class="panel table-panel">
          <view class="panel-header">
            <text class="panel-title">æ¡Œå°çŠ¶æ€</text>
            <view class="table-legend">
              <view class="legend-item"><view class="dot available"></view>ç©ºé—²</view>
              <view class="legend-item"><view class="dot occupied"></view>å°±é¤</view>
              <view class="legend-item"><view class="dot reserved"></view>é¢„è®¢</view>
            </view>
          </view>
          <scroll-view scroll-y class="panel-body">
            <view wx:for="{{tableGroups}}" wx:key="type" class="table-group">
              <text class="group-label">{{item.name}}</text>
              <view class="table-grid">
                <view 
                  wx:for="{{item.tables}}" 
                  wx:for-item="table" 
                  wx:key="id" 
                  class="table-cell {{table.status}}"
                  bindtap="onTableTap"
                  data-id="{{table.id}}"
                >
                  <text class="table-no">{{table.table_no}}</text>
                  <text class="table-cap">{{table.capacity}}äºº</text>
                </view>
              </view>
            </view>
          </scroll-view>
        </view>
      </view>
    </view>
  </view>
</view>
