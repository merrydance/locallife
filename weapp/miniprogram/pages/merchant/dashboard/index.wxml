<!-- å•†æˆ·å·¥ä½œå° v4.0 - å…¨å±æ²‰æµ¸å¼è®¾è®¡ -->

<!-- å°å±æç¤º -->
<match-media max-width="1599">
  <view class="mobile-redirect">
    <view class="redirect-box">
      <view class="redirect-icon">ğŸª</view>
      <text class="redirect-title">è¯·ä½¿ç”¨ç”µè„‘ç«¯è®¿é—®å·¥ä½œå°</text>
      <text class="redirect-desc">å·¥ä½œå°ä¸ºå¤§å±ä¼˜åŒ–è®¾è®¡ï¼Œå»ºè®®ä½¿ç”¨ 1600px ä»¥ä¸Šæ˜¾ç¤ºå™¨</text>
      <navigator url="/pages/merchant/orders/index" class="btn-orders">è¿›å…¥è®¢å•ç®¡ç†</navigator>
    </view>
  </view>
</match-media>

<!-- PC å…¨å±å¸ƒå±€ (1600px+) -->
<match-media min-width="1600">
  <view class="dashboard-fullscreen">
    <!-- é¡¶éƒ¨æ  -->
    <view class="top-bar">
      <view class="left-section">
        <text class="merchant-name">{{merchantName || 'å•†æˆ·å·¥ä½œå°'}}</text>
        <view class="status-badge {{isOpen ? 'open' : 'closed'}}" bindtap="onToggleStatus">
          <text class="status-dot"></text>
          <text>{{isOpen ? 'è¥ä¸šä¸­' : 'å·²æ‰“çƒŠ'}}</text>
        </view>
        <view wx:if="{{wsConnected}}" class="ws-indicator connected">
          <text class="ws-dot"></text>
          <text>å®æ—¶</text>
        </view>
      </view>
      <view class="center-section">
        <text class="current-date">{{currentDate}}</text>
      </view>
      <view class="right-section">
        <!-- ç§»é™¤åˆ·æ–°æŒ‰é’®ï¼ŒWebSocketå®æ—¶æ›´æ–° -->
      </view>
    </view>

    <!-- ä¸»ä½“ä¸‰æ å¸ƒå±€ -->
    <view class="main-content">
      <!-- å·¦æ ï¼šè®¢å•æµ -->
      <view class="orders-column">
        <view class="column-header">
          <text class="column-title">ğŸ“‹ è®¢å•æµ</text>
          <navigator url="/pages/merchant/orders/index" class="view-all">æŸ¥çœ‹å…¨éƒ¨ â†’</navigator>
        </view>

        <!-- è®¢å•çŠ¶æ€æ ‡ç­¾ -->
        <view class="order-tabs">
          <view class="tab-item {{orderTab === 'all' ? 'active' : ''}}" bindtap="switchOrderTab" data-tab="all">
            <text>å…¨éƒ¨</text>
            <text class="tab-count">{{pendingOrders.length}}</text>
          </view>
          <view class="tab-item {{orderTab === 'paid' ? 'active' : ''}}" bindtap="switchOrderTab" data-tab="paid">
            <text>å¾…æ¥å•</text>
            <text class="tab-count pending">{{statusCounts.paid}}</text>
          </view>
          <view class="tab-item {{orderTab === 'preparing' ? 'active' : ''}}" bindtap="switchOrderTab" data-tab="preparing">
            <text>åˆ¶ä½œä¸­</text>
            <text class="tab-count">{{statusCounts.preparing}}</text>
          </view>
          <view class="tab-item {{orderTab === 'ready' ? 'active' : ''}}" bindtap="switchOrderTab" data-tab="ready">
            <text>å¾…å–é¤</text>
            <text class="tab-count">{{statusCounts.ready}}</text>
          </view>
        </view>

        <!-- è®¢å•åˆ—è¡¨ -->
        <view class="order-list">
          <view wx:if="{{filteredOrders.length === 0}}" class="empty-orders">æš‚æ— è®¢å•</view>
          <view wx:for="{{filteredOrders}}" wx:key="id" 
                class="order-card {{item.status}}" bindtap="onOrderTap" data-id="{{item.id}}">
            <view class="order-head">
              <text class="order-no">#{{item.order_no}}</text>
              <text class="order-type">{{item.order_type_text}}</text>
              <text class="order-status-tag {{item.status}}">{{item.status_text}}</text>
            </view>
            <view class="order-items">{{item.items_summary}}</view>
            <view class="order-foot">
              <text class="order-amount">Â¥{{item.amount_display}}</text>
              <text class="order-time">{{item.created_time}}</text>
            </view>
            <view class="order-actions">
              <button wx:if="{{item.status === 'paid'}}" class="btn-accept" catchtap="onAcceptOrder" data-id="{{item.id}}">æ¥å•</button>
              <button wx:if="{{item.status === 'paid'}}" class="btn-reject" catchtap="onRejectOrder" data-id="{{item.id}}">æ‹’ç»</button>
              <button wx:if="{{item.status === 'preparing'}}" class="btn-ready" catchtap="onReadyOrder" data-id="{{item.id}}">å·²å‡ºé¤</button>
            </view>
          </view>
        </view>
      </view>

      <!-- ä¸­æ ï¼šæ¡Œå°çŠ¶æ€ -->
      <view class="tables-column">
        <view class="column-header">
          <text class="column-title">ğŸª‘ æ¡Œå°çŠ¶æ€</text>
          <view class="table-stats">
            <text class="stat-item">ç©ºé—² {{tableStats.available}}</text>
            <text class="stat-item">å°±é¤ {{tableStats.occupied}}</text>
            <text class="stat-item">å…± {{tableStats.total}}</text>
          </view>
        </view>

        <view class="tables-grid">
          <view wx:if="{{tableGroups.length === 0}}" class="empty-tables">æš‚æ— æ¡Œå°æ•°æ®</view>
          <block wx:for="{{tableGroups}}" wx:key="type" wx:for-item="group">
            <view class="table-group">
              <text class="group-name">{{group.name}}</text>
              <view class="group-tables">
                <view wx:for="{{group.tables}}" wx:key="id" wx:for-item="table"
                      class="table-card {{table.status_class}}"
                      bindtap="onTableCardTap" data-table="{{table}}">
                  <view class="table-no">{{table.table_no}}</view>
                  <view class="table-status">{{table.status_text}}</view>
                  <view class="table-info">
                    <text wx:if="{{table.capacity}}">{{table.capacity}}äººåº§</text>
                  </view>
                </view>
              </view>
            </view>
          </block>
        </view>
      </view>

      <!-- æ¡Œå°çŠ¶æ€æ“ä½œå¼¹çª— -->
      <view wx:if="{{showTablePopup}}" class="table-popup-mask" bindtap="closeTablePopup">
        <view class="table-popup" catchtap="">
          <view class="popup-header">
            <text class="popup-title">{{activeTable.table_no}}</text>
            <text class="popup-close" bindtap="closeTablePopup">Ã—</text>
          </view>
          <view class="popup-info">
            <text>å½“å‰çŠ¶æ€ï¼š{{activeTable.status_text}}</text>
            <text wx:if="{{activeTable.capacity}}">å®¹é‡ï¼š{{activeTable.capacity}}äºº</text>
          </view>
          
          <!-- é¢„è®¢ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰ -->
          <view wx:if="{{activeTable.reservation}}" class="popup-reservation-info">
            <view class="res-line"><text class="res-label">é¢„è®¢äººï¼š</text>{{activeTable.reservation.contact_name}}</view>
            <view class="res-line"><text class="res-label">ç”µè¯ï¼š</text>{{activeTable.reservation.contact_phone}}</view>
            <view class="res-line"><text class="res-label">äººæ•°ï¼š</text>{{activeTable.reservation.guest_count}}äºº</view>
            <view class="res-line"><text class="res-label">æ—¶é—´ï¼š</text>{{activeTable.reservation.reservation_time}}</view>
          </view>
          
          <view class="popup-actions">
            <button wx:if="{{activeTable.status !== 'available'}}" 
                    class="popup-btn available" bindtap="setTableStatus" data-status="available">
              è®¾ä¸ºç©ºé—²ï¼ˆç¦»åœºï¼‰
            </button>
            <button wx:if="{{activeTable.status !== 'occupied'}}" 
                    class="popup-btn occupied" bindtap="setTableStatus" data-status="occupied">
              è®¾ä¸ºå°±é¤ä¸­
            </button>
            <button class="popup-btn reserved" bindtap="goToAddReservation">
              æ·»åŠ é¢„è®¢
            </button>
          </view>
        </view>
      </view>

      <!-- å³æ ï¼šå¿«æ·å…¥å£ + ä»Šæ—¥æ•°æ® -->
      <view class="quick-column">
        <!-- ä»Šæ—¥æ•°æ® -->
        <view class="today-stats">
          <text class="stats-title">ä»Šæ—¥è¥ä¸š</text>
          <view class="stats-main">
            <text class="stats-label">è¥ä¸šé¢</text>
            <text class="stats-value">Â¥{{revenueDisplay}}</text>
          </view>
          <view class="stats-sub">
            <text>è®¢å• {{stats.todayOrders}} å•</text>
          </view>
        </view>

        <!-- å¿«æ·å…¥å£ -->
        <view class="quick-entries">
          <text class="entries-title">å¿«æ·å…¥å£</text>
          
          <view class="entry-item" bindtap="goToInventory">
            <text class="entry-icon">ğŸ“¦</text>
            <text class="entry-text">å½“æ—¥åº“å­˜è®¾ç½®</text>
          </view>
          
          <view class="entry-item" bindtap="goToMembers">
            <text class="entry-icon">ğŸ‘¥</text>
            <text class="entry-text">ä¼šå‘˜ç®¡ç†</text>
          </view>
          
          <view class="entry-item" bindtap="goToReservations">
            <text class="entry-icon">ğŸ“…</text>
            <text class="entry-text">é¢„è®¢ç®¡ç†</text>
          </view>
          
          <view class="entry-item" bindtap="goToKitchen">
            <text class="entry-icon">ğŸ³</text>
            <text class="entry-text">åå¨æ˜¾ç¤º</text>
          </view>
          
          <view class="entry-item" bindtap="goToStats">
            <text class="entry-icon">ğŸ“Š</text>
            <text class="entry-text">ç»è¥ç»Ÿè®¡</text>
          </view>
          
          <view class="entry-item" bindtap="goToFinance">
            <text class="entry-icon">ğŸ’°</text>
            <text class="entry-text">è´¢åŠ¡ç®¡ç†</text>
          </view>
          
          <view class="entry-item" bindtap="goToSettings">
            <text class="entry-icon">âš™ï¸</text>
            <text class="entry-text">å•†æˆ·è®¾ç½®</text>
          </view>
        </view>

        <!-- æ›´å¤šç®¡ç†å…¥å£ -->
        <view class="more-entries">
          <text class="entries-title">æ›´å¤šç®¡ç†</text>
          
          <view class="entry-item" bindtap="goToDishes">
            <text class="entry-icon">ğŸœ</text>
            <text class="entry-text">èœå“ç®¡ç†</text>
          </view>
          
          <view class="entry-item" bindtap="goToCombos">
            <text class="entry-icon">ğŸ</text>
            <text class="entry-text">å¥—é¤ç®¡ç†</text>
          </view>
          
          <view class="entry-item" bindtap="goToTables">
            <text class="entry-icon">ğŸª‘</text>
            <text class="entry-text">æ¡Œå°ç®¡ç†</text>
          </view>
          
          <view class="entry-item" bindtap="goToMarketing">
            <text class="entry-icon">ğŸ¯</text>
            <text class="entry-text">è¥é”€æ´»åŠ¨</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</match-media>
