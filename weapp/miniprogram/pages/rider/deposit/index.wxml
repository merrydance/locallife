<custom-navbar title="我的押金" showBack="{{true}}" bind:navheight="onNavHeight" />

<view class="page-container" style="padding-top: {{navBarHeight}}px;">
  <t-loading wx:if="{{loading}}" theme="circular" size="40rpx" class="loading" />

  <view wx:if="{{!loading}}" class="content">
    <!-- 押金卡片 -->
    <view class="deposit-card">
      <view class="card-header">
        <text class="label">当前押金</text>
        <t-tag theme="{{status === 'PAID' ? 'success' : (status === 'REFUNDING' ? 'warning' : 'default')}}">
          {{status === 'PAID' ? '已缴纳' : (status === 'REFUNDING' ? '退款中' : '未缴纳')}}
        </t-tag>
      </view>
      <view class="amount-row">
        <text class="currency">¥</text>
        <text class="amount">{{depositDisplay}}</text>
      </view>
      <view class="action-row">
        <t-button 
          wx:if="{{status === 'UNPAID'}}" 
          theme="primary" 
          block 
          bindtap="onPayDeposit"
        >立即缴纳</t-button>
        <t-button 
          wx:if="{{status === 'PAID'}}" 
          theme="light" 
          block 
          bindtap="onRefundDeposit"
        >申请退还</t-button>
        <t-button 
          wx:if="{{status === 'REFUNDING'}}" 
          theme="default" 
          disabled 
          block
        >退款审核中</t-button>
      </view>
    </view>

    <!-- 押金说明 -->
    <view class="info-card">
      <view class="section-title">押金说明</view>
      <view class="info-item">
        <t-icon name="info-circle" size="32rpx" color="#666" />
        <text>接单前需缴纳押金 ¥{{minDepositDisplay}}</text>
      </view>
      <view class="info-item">
        <t-icon name="check-circle" size="32rpx" color="#666" />
        <text>押金随时可申请退还，预计1-3个工作日到账</text>
      </view>
    </view>

    <!-- 交易记录 -->
    <view class="history-section">
      <view class="section-title">交易记录</view>
      <view class="history-list">
        <view wx:for="{{transactions}}" wx:key="id" class="history-item">
          <view class="item-left">
            <text class="item-type">{{item.type === 'PAYMENT' ? '缴纳押金' : '退还押金'}}</text>
            <text class="item-time">{{item.created_at}}</text>
          </view>
          <text class="item-amount {{item.type === 'PAYMENT' ? 'negative' : 'positive'}}">
            {{item.amountDisplay}}
          </text>
        </view>
      </view>
    </view>
  </view>
</view>
