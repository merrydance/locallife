<!--å ‚é£Ÿç‚¹é¤èœå•é¡µé¢-->
<view class="menu-container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">æ­£åœ¨åŠ è½½èœå•...</text>
  </view>

  <!-- ä¸»è¦å†…å®¹ -->
  <view wx:else class="menu-content">
    <!-- æ¡Œå°ä¿¡æ¯æ  -->
    <view class="table-info-bar">
      <view class="table-info">
        <text class="table-number">{{tableInfo.table_number}}å·æ¡Œ</text>
        <text class="merchant-name">{{tableInfo.merchant_name}}</text>
      </view>
      <view class="table-actions">
        <button class="action-btn" bindtap="callWaiter">
          <text class="action-icon">ğŸ””</text>
          <text class="action-text">å‘¼å«æœåŠ¡å‘˜</text>
        </button>
      </view>
    </view>

    <!-- åˆ†ç±»å¯¼èˆª - ä½¿ç”¨ä¾§è¾¹æ æ ·å¼ -->
    <view class="category-sidebar">
      <scroll-view class="category-nav" scroll-y="true">
        <view 
          wx:for="{{categories}}" 
          wx:key="id"
          class="category-item {{currentCategoryId === item.id ? 'active' : ''}}"
          data-id="{{item.id}}"
          bindtap="switchCategory"
        >
          <text class="category-name">{{item.name}}</text>
          <view wx:if="{{currentCategoryId === item.id}}" class="category-indicator"></view>
        </view>
      </scroll-view>
    </view>

    <!-- èœå“åˆ—è¡¨ -->
    <view class="dish-content">
      <scroll-view class="dish-list" scroll-y="true">
        <view class="category-dishes">
          <view 
            wx:for="{{dishes}}" 
            wx:key="id"
            class="dish-item"
            data-id="{{item.id}}"
            bindtap="viewDishDetail"
          >
            <image class="dish-image" src="{{item.image_url}}" mode="aspectFill"></image>
            <view class="dish-info">
              <text class="dish-name">{{item.name}}</text>
              <text class="dish-description">{{item.description}}</text>
              <view class="dish-stats">
                <text class="dish-rating">â­ {{item.rating}}</text>
                <text class="dish-sales">æœˆå”®{{item.sales_count}}</text>
              </view>
              <view class="dish-price-row">
                <view class="price-info">
                  <text class="current-price">Â¥{{item.price}}</text>
                  <text wx:if="{{item.original_price && item.original_price > item.price}}" 
                        class="original-price">Â¥{{item.original_price}}</text>
                </view>
                <view class="cart-controls">
                  <view wx:if="{{getCartQuantity(item.id) > 0}}" class="quantity-controls">
                    <button 
                      class="quantity-btn minus" 
                      data-dish-id="{{item.id}}" 
                      data-quantity="{{getCartQuantity(item.id) - 1}}"
                      bindtap="updateCartQuantity"
                    >-</button>
                    <text class="quantity">{{getCartQuantity(item.id)}}</text>
                    <button 
                      class="quantity-btn plus" 
                      data-dish-id="{{item.id}}" 
                      data-quantity="{{getCartQuantity(item.id) + 1}}"
                      bindtap="updateCartQuantity"
                    >+</button>
                  </view>
                  <button 
                    wx:else
                    class="add-btn {{!item.is_available ? 'disabled' : ''}}" 
                    data-id="{{item.id}}"
                    bindtap="addToCart"
                    disabled="{{!item.is_available}}"
                  >
                    {{item.is_available ? '+' : 'å”®ç½„'}}
                  </button>
                </view>
              </view>
            </view>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- è´­ç‰©è½¦æ‚¬æµ®æŒ‰é’® -->
  <view class="cart-float-btn {{cart.total_quantity > 0 ? 'active' : ''}}" bindtap="showCart">
    <view class="cart-icon-wrapper">
      <text class="cart-icon">ğŸ›’</text>
      <view wx:if="{{cart.total_quantity > 0}}" class="cart-badge">{{cart.total_quantity}}</view>
    </view>
    <view class="cart-info">
      <text class="cart-total">Â¥{{cart.total_amount}}</text>
      <text class="cart-text">å»ç»“ç®—</text>
    </view>
  </view>

  <!-- è´­ç‰©è½¦å¼¹çª— -->
  <view wx:if="{{cartVisible}}" class="cart-modal">
    <view class="cart-mask" bindtap="hideCart"></view>
    <view class="cart-content">
      <view class="cart-header">
        <text class="cart-title">è´­ç‰©è½¦ ({{cart.total_quantity}})</text>
        <button class="cart-close" bindtap="hideCart">Ã—</button>
      </view>
      
      <scroll-view class="cart-items" scroll-y="true">
        <view wx:for="{{cart.items}}" wx:key="dish_id" class="cart-item">
          <view class="item-info">
            <text class="item-name">{{item.dish_name}}</text>
            <text class="item-price">Â¥{{item.price}}</text>
          </view>
          <view class="item-controls">
            <button 
              class="quantity-btn minus" 
              data-dish-id="{{item.dish_id}}" 
              data-quantity="{{item.quantity - 1}}"
              bindtap="updateCartQuantity"
            >-</button>
            <text class="quantity">{{item.quantity}}</text>
            <button 
              class="quantity-btn plus" 
              data-dish-id="{{item.dish_id}}" 
              data-quantity="{{item.quantity + 1}}"
              bindtap="updateCartQuantity"
            >+</button>
          </view>
        </view>
      </scroll-view>
      
      <view class="cart-footer">
        <view class="cart-total-info">
          <text class="total-label">åˆè®¡ï¼š</text>
          <text class="total-amount">Â¥{{cart.total_amount}}</text>
        </view>
        <button class="checkout-btn" bindtap="goToCheckout">
          å»ç»“ç®— ({{cart.total_quantity}})
        </button>
      </view>
    </view>
  </view>

  <!-- èœå“è¯¦æƒ…å¼¹çª— -->
  <view wx:if="{{selectedDish}}" class="dish-detail-modal">
    <view class="dish-detail-mask" bindtap="closeDishDetail"></view>
    <view class="dish-detail-content">
      <view class="dish-detail-header">
        <button class="detail-close" bindtap="closeDishDetail">Ã—</button>
      </view>
      
      <image class="dish-detail-image" src="{{selectedDish.image_url}}" mode="aspectFill"></image>
      
      <view class="dish-detail-info">
        <text class="dish-detail-name">{{selectedDish.name}}</text>
        <text class="dish-detail-description">{{selectedDish.description}}</text>
        
        <view class="dish-detail-stats">
          <text class="detail-rating">â­ {{selectedDish.rating}}</text>
          <text class="detail-sales">æœˆå”®{{selectedDish.sales_count}}</text>
        </view>
        
        <view class="dish-detail-price">
          <text class="detail-current-price">Â¥{{selectedDish.price}}</text>
          <text wx:if="{{selectedDish.original_price && selectedDish.original_price > selectedDish.price}}" 
                class="detail-original-price">Â¥{{selectedDish.original_price}}</text>
        </view>
        
        <view class="dish-detail-actions">
          <view wx:if="{{getCartQuantity(selectedDish.id) > 0}}" class="detail-quantity-controls">
            <button 
              class="quantity-btn minus" 
              data-dish-id="{{selectedDish.id}}" 
              data-quantity="{{getCartQuantity(selectedDish.id) - 1}}"
              bindtap="updateCartQuantity"
            >-</button>
            <text class="quantity">{{getCartQuantity(selectedDish.id)}}</text>
            <button 
              class="quantity-btn plus" 
              data-dish-id="{{selectedDish.id}}" 
              data-quantity="{{getCartQuantity(selectedDish.id) + 1}}"
              bindtap="updateCartQuantity"
            >+</button>
          </view>
          <button 
            wx:else
            class="detail-add-btn {{!selectedDish.is_available ? 'disabled' : ''}}" 
            data-id="{{selectedDish.id}}"
            bindtap="addToCart"
            disabled="{{!selectedDish.is_available}}"
          >
            {{selectedDish.is_available ? 'åŠ å…¥è´­ç‰©è½¦' : 'æš‚æ—¶å”®ç½„'}}
          </button>
        </view>
      </view>
    </view>
  </view>
</view>