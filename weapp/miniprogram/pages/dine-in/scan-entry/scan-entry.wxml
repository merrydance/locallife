<!--æ‰«ç ç‚¹é¤å…¥å£é¡µé¢-->
<view class="scan-entry-container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">æ­£åœ¨è·å–æ¡Œå°ä¿¡æ¯...</text>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view wx:elif="{{error}}" class="error-container">
    <image class="error-icon" src="/assets/icons/error.png" mode="aspectFit"></image>
    <text class="error-text">{{error}}</text>
    <button class="retry-btn" bindtap="rescan">é‡æ–°æ‰«ç </button>
  </view>

  <!-- æ¡Œå°ä¿¡æ¯ -->
  <view wx:else class="table-info-container">
    <!-- å•†æˆ·å¤´éƒ¨ -->
    <view class="merchant-header">
      <image class="merchant-logo" src="{{merchantInfo.logo_url}}" mode="aspectFill"></image>
      <view class="merchant-info">
        <text class="merchant-name">{{merchantInfo.name}}</text>
        <text class="merchant-category">{{merchantInfo.category}}</text>
        <view class="merchant-rating">
          <view class="stars">
            <block wx:for="{{5}}" wx:key="index">
              <text class="star {{index < merchantInfo.rating ? 'filled' : ''}}">â˜…</text>
            </block>
          </view>
          <text class="rating-text">{{merchantInfo.rating}}</text>
        </view>
      </view>
      <view class="merchant-action" bindtap="viewMerchantInfo">
        <text class="action-text">æŸ¥çœ‹è¯¦æƒ…</text>
        <text class="action-arrow">></text>
      </view>
    </view>

    <!-- æ¡Œå°ä¿¡æ¯å¡ç‰‡ -->
    <view class="table-card">
      <view class="table-header">
        <view class="table-number">
          <text class="table-label">æ¡Œå·</text>
          <text class="table-value">{{tableInfo.table_number}}</text>
        </view>
        <view class="table-capacity">
          <text class="capacity-icon">ğŸ‘¥</text>
          <text class="capacity-text">{{tableInfo.capacity}}äººæ¡Œ</text>
        </view>
      </view>
      
      <view class="table-status">
        <view class="status-indicator {{tableInfo.status}}"></view>
        <text class="status-text">
          {{tableInfo.status === 'available' ? 'å¯ç”¨' : 
            tableInfo.status === 'occupied' ? 'ä½¿ç”¨ä¸­' : 'å·²é¢„è®¢'}}
        </text>
      </view>

      <!-- æ¡Œå°çŠ¶æ€è¯´æ˜ -->
      <view class="table-tips">
        <text class="tips-icon">ğŸ’¡</text>
        <text class="tips-text">
          {{tableInfo.status === 'available' ? 'æ‚¨å¯ä»¥å¼€å§‹ç‚¹é¤äº†' : 
            tableInfo.status === 'occupied' ? 'æ­¤æ¡Œæ­£åœ¨ä½¿ç”¨ä¸­ï¼Œè¯·ç¡®è®¤æ˜¯å¦ä¸ºæ‚¨çš„æ¡Œå°' : 
            'æ­¤æ¡Œå·²è¢«é¢„è®¢ï¼Œè¯·è”ç³»æœåŠ¡å‘˜'}}
        </text>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-buttons">
      <button 
        class="start-dining-btn {{tableInfo.status !== 'available' ? 'disabled' : ''}}" 
        bindtap="startDining"
        disabled="{{tableInfo.status !== 'available'}}"
      >
        {{tableInfo.status === 'available' ? 'å¼€å§‹ç‚¹é¤' : 'æ¡Œå°ä¸å¯ç”¨'}}
      </button>
      
      <view class="secondary-actions">
        <button class="secondary-btn" bindtap="rescan">é‡æ–°æ‰«ç </button>
        <button class="secondary-btn" open-type="share">åˆ†äº«ç»™å¥½å‹</button>
      </view>
    </view>

    <!-- å•†æˆ·è¥ä¸šä¿¡æ¯ -->
    <view class="business-info">
      <view class="info-item">
        <text class="info-label">è¥ä¸šæ—¶é—´</text>
        <text class="info-value">{{merchantInfo.business_hours || '09:00-22:00'}}</text>
      </view>
      <view class="info-item">
        <text class="info-label">è”ç³»ç”µè¯</text>
        <text class="info-value">{{merchantInfo.phone || 'æš‚æ— '}}</text>
      </view>
      <view class="info-item">
        <text class="info-label">å•†æˆ·åœ°å€</text>
        <text class="info-value">{{merchantInfo.address || 'æš‚æ— '}}</text>
      </view>
    </view>

    <!-- æœåŠ¡æ¨å¹¿å¹¿å‘Šä½ -->
    <view class="service-promotion">
      <view class="promotion-header">
        <text class="promotion-title">ğŸ‰ æ›´å¤šä¾¿æ°‘æœåŠ¡</text>
      </view>
      <view class="promotion-services">
        <view class="service-card takeout" bindtap="goToTakeout">
          <view class="service-icon">ğŸšš</view>
          <view class="service-info">
            <text class="service-name">å¤–å–é…é€</text>
            <text class="service-desc">è¶³ä¸å‡ºæˆ·ï¼Œç¾é£Ÿåˆ°å®¶</text>
          </view>
          <view class="service-arrow">></view>
        </view>
        
        <view class="service-card reservation" bindtap="goToReservation">
          <view class="service-icon">ğŸ </view>
          <view class="service-info">
            <text class="service-name">åŒ…é—´é¢„å®š</text>
            <text class="service-desc">èšé¤èšä¼šï¼Œæå‰é¢„çº¦</text>
          </view>
          <view class="service-arrow">></view>
        </view>
      </view>
    </view>
  </view>
</view>