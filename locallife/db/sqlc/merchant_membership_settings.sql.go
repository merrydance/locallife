// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: merchant_membership_settings.sql

package db

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const createMerchantMembershipSettings = `-- name: CreateMerchantMembershipSettings :one
INSERT INTO merchant_membership_settings (
    merchant_id,
    balance_usable_scenes,
    bonus_usable_scenes,
    allow_with_voucher,
    allow_with_discount,
    max_deduction_percent
) VALUES (
    $1, $2, $3, $4, $5, $6
) RETURNING id, merchant_id, balance_usable_scenes, bonus_usable_scenes, allow_with_voucher, allow_with_discount, max_deduction_percent, created_at, updated_at
`

type CreateMerchantMembershipSettingsParams struct {
	MerchantID          int64    `json:"merchant_id"`
	BalanceUsableScenes []string `json:"balance_usable_scenes"`
	BonusUsableScenes   []string `json:"bonus_usable_scenes"`
	AllowWithVoucher    bool     `json:"allow_with_voucher"`
	AllowWithDiscount   bool     `json:"allow_with_discount"`
	MaxDeductionPercent int32    `json:"max_deduction_percent"`
}

func (q *Queries) CreateMerchantMembershipSettings(ctx context.Context, arg CreateMerchantMembershipSettingsParams) (MerchantMembershipSetting, error) {
	row := q.db.QueryRow(ctx, createMerchantMembershipSettings,
		arg.MerchantID,
		arg.BalanceUsableScenes,
		arg.BonusUsableScenes,
		arg.AllowWithVoucher,
		arg.AllowWithDiscount,
		arg.MaxDeductionPercent,
	)
	var i MerchantMembershipSetting
	err := row.Scan(
		&i.ID,
		&i.MerchantID,
		&i.BalanceUsableScenes,
		&i.BonusUsableScenes,
		&i.AllowWithVoucher,
		&i.AllowWithDiscount,
		&i.MaxDeductionPercent,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getMerchantMembershipSettings = `-- name: GetMerchantMembershipSettings :one

SELECT id, merchant_id, balance_usable_scenes, bonus_usable_scenes, allow_with_voucher, allow_with_discount, max_deduction_percent, created_at, updated_at FROM merchant_membership_settings
WHERE merchant_id = $1 LIMIT 1
`

// 商户会员设置查询
func (q *Queries) GetMerchantMembershipSettings(ctx context.Context, merchantID int64) (MerchantMembershipSetting, error) {
	row := q.db.QueryRow(ctx, getMerchantMembershipSettings, merchantID)
	var i MerchantMembershipSetting
	err := row.Scan(
		&i.ID,
		&i.MerchantID,
		&i.BalanceUsableScenes,
		&i.BonusUsableScenes,
		&i.AllowWithVoucher,
		&i.AllowWithDiscount,
		&i.MaxDeductionPercent,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const updateMerchantMembershipSettings = `-- name: UpdateMerchantMembershipSettings :one
UPDATE merchant_membership_settings
SET
    balance_usable_scenes = COALESCE($1, balance_usable_scenes),
    bonus_usable_scenes = COALESCE($2, bonus_usable_scenes),
    allow_with_voucher = COALESCE($3, allow_with_voucher),
    allow_with_discount = COALESCE($4, allow_with_discount),
    max_deduction_percent = COALESCE($5, max_deduction_percent),
    updated_at = NOW()
WHERE merchant_id = $6
RETURNING id, merchant_id, balance_usable_scenes, bonus_usable_scenes, allow_with_voucher, allow_with_discount, max_deduction_percent, created_at, updated_at
`

type UpdateMerchantMembershipSettingsParams struct {
	BalanceUsableScenes []string    `json:"balance_usable_scenes"`
	BonusUsableScenes   []string    `json:"bonus_usable_scenes"`
	AllowWithVoucher    pgtype.Bool `json:"allow_with_voucher"`
	AllowWithDiscount   pgtype.Bool `json:"allow_with_discount"`
	MaxDeductionPercent pgtype.Int4 `json:"max_deduction_percent"`
	MerchantID          int64       `json:"merchant_id"`
}

func (q *Queries) UpdateMerchantMembershipSettings(ctx context.Context, arg UpdateMerchantMembershipSettingsParams) (MerchantMembershipSetting, error) {
	row := q.db.QueryRow(ctx, updateMerchantMembershipSettings,
		arg.BalanceUsableScenes,
		arg.BonusUsableScenes,
		arg.AllowWithVoucher,
		arg.AllowWithDiscount,
		arg.MaxDeductionPercent,
		arg.MerchantID,
	)
	var i MerchantMembershipSetting
	err := row.Scan(
		&i.ID,
		&i.MerchantID,
		&i.BalanceUsableScenes,
		&i.BonusUsableScenes,
		&i.AllowWithVoucher,
		&i.AllowWithDiscount,
		&i.MaxDeductionPercent,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const upsertMerchantMembershipSettings = `-- name: UpsertMerchantMembershipSettings :one
INSERT INTO merchant_membership_settings (
    merchant_id,
    balance_usable_scenes,
    bonus_usable_scenes,
    allow_with_voucher,
    allow_with_discount,
    max_deduction_percent
) VALUES (
    $1, $2, $3, $4, $5, $6
)
ON CONFLICT (merchant_id) DO UPDATE SET
    balance_usable_scenes = EXCLUDED.balance_usable_scenes,
    bonus_usable_scenes = EXCLUDED.bonus_usable_scenes,
    allow_with_voucher = EXCLUDED.allow_with_voucher,
    allow_with_discount = EXCLUDED.allow_with_discount,
    max_deduction_percent = EXCLUDED.max_deduction_percent,
    updated_at = NOW()
RETURNING id, merchant_id, balance_usable_scenes, bonus_usable_scenes, allow_with_voucher, allow_with_discount, max_deduction_percent, created_at, updated_at
`

type UpsertMerchantMembershipSettingsParams struct {
	MerchantID          int64    `json:"merchant_id"`
	BalanceUsableScenes []string `json:"balance_usable_scenes"`
	BonusUsableScenes   []string `json:"bonus_usable_scenes"`
	AllowWithVoucher    bool     `json:"allow_with_voucher"`
	AllowWithDiscount   bool     `json:"allow_with_discount"`
	MaxDeductionPercent int32    `json:"max_deduction_percent"`
}

func (q *Queries) UpsertMerchantMembershipSettings(ctx context.Context, arg UpsertMerchantMembershipSettingsParams) (MerchantMembershipSetting, error) {
	row := q.db.QueryRow(ctx, upsertMerchantMembershipSettings,
		arg.MerchantID,
		arg.BalanceUsableScenes,
		arg.BonusUsableScenes,
		arg.AllowWithVoucher,
		arg.AllowWithDiscount,
		arg.MaxDeductionPercent,
	)
	var i MerchantMembershipSetting
	err := row.Scan(
		&i.ID,
		&i.MerchantID,
		&i.BalanceUsableScenes,
		&i.BonusUsableScenes,
		&i.AllowWithVoucher,
		&i.AllowWithDiscount,
		&i.MaxDeductionPercent,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}
