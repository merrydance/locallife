// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: rider.sql

package db

import (
	"context"
	"time"

	"github.com/jackc/pgx/v5/pgtype"
)

const countOnlineRiders = `-- name: CountOnlineRiders :one
SELECT COUNT(*) FROM riders
WHERE is_online = true AND status = 'active'
`

func (q *Queries) CountOnlineRiders(ctx context.Context) (int64, error) {
	row := q.db.QueryRow(ctx, countOnlineRiders)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const countRidersByRegion = `-- name: CountRidersByRegion :one
SELECT COUNT(*) FROM riders
WHERE region_id = $1
`

// 统计区域内骑手数量
func (q *Queries) CountRidersByRegion(ctx context.Context, regionID pgtype.Int8) (int64, error) {
	row := q.db.QueryRow(ctx, countRidersByRegion, regionID)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const countRidersByRegionWithStatus = `-- name: CountRidersByRegionWithStatus :one
SELECT COUNT(*) FROM riders
WHERE region_id = $1 AND status = $2
`

type CountRidersByRegionWithStatusParams struct {
	RegionID pgtype.Int8 `json:"region_id"`
	Status   string      `json:"status"`
}

// 按区域和状态统计骑手数量
func (q *Queries) CountRidersByRegionWithStatus(ctx context.Context, arg CountRidersByRegionWithStatusParams) (int64, error) {
	row := q.db.QueryRow(ctx, countRidersByRegionWithStatus, arg.RegionID, arg.Status)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const countRidersByStatus = `-- name: CountRidersByStatus :one
SELECT COUNT(*) FROM riders
WHERE status = $1
`

func (q *Queries) CountRidersByStatus(ctx context.Context, status string) (int64, error) {
	row := q.db.QueryRow(ctx, countRidersByStatus, status)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const createRider = `-- name: CreateRider :one
INSERT INTO riders (
    user_id,
    real_name,
    id_card_no,
    phone,
    region_id,
    status
) VALUES (
    $1, $2, $3, $4, $5, 'pending'
) RETURNING id, user_id, real_name, id_card_no, phone, deposit_amount, frozen_deposit, status, is_online, credit_score, current_longitude, current_latitude, location_updated_at, total_orders, total_earnings, online_duration, created_at, updated_at, region_id, application_id, sub_mch_id
`

type CreateRiderParams struct {
	UserID   int64       `json:"user_id"`
	RealName string      `json:"real_name"`
	IDCardNo string      `json:"id_card_no"`
	Phone    string      `json:"phone"`
	RegionID pgtype.Int8 `json:"region_id"`
}

func (q *Queries) CreateRider(ctx context.Context, arg CreateRiderParams) (Rider, error) {
	row := q.db.QueryRow(ctx, createRider,
		arg.UserID,
		arg.RealName,
		arg.IDCardNo,
		arg.Phone,
		arg.RegionID,
	)
	var i Rider
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.RealName,
		&i.IDCardNo,
		&i.Phone,
		&i.DepositAmount,
		&i.FrozenDeposit,
		&i.Status,
		&i.IsOnline,
		&i.CreditScore,
		&i.CurrentLongitude,
		&i.CurrentLatitude,
		&i.LocationUpdatedAt,
		&i.TotalOrders,
		&i.TotalEarnings,
		&i.OnlineDuration,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.RegionID,
		&i.ApplicationID,
		&i.SubMchID,
	)
	return i, err
}

const deductRiderDeposit = `-- name: DeductRiderDeposit :one
UPDATE riders
SET 
    deposit_amount = deposit_amount - $2,
    updated_at = now()
WHERE id = $1
  AND deposit_amount >= $2  -- 确保余额充足
RETURNING id, user_id, real_name, id_card_no, phone, deposit_amount, frozen_deposit, status, is_online, credit_score, current_longitude, current_latitude, location_updated_at, total_orders, total_earnings, online_duration, created_at, updated_at, region_id, application_id, sub_mch_id
`

type DeductRiderDepositParams struct {
	ID            int64 `json:"id"`
	DepositAmount int64 `json:"deposit_amount"`
}

// 从骑手押金扣款（原子操作：检查余额 + 扣款）
func (q *Queries) DeductRiderDeposit(ctx context.Context, arg DeductRiderDepositParams) (Rider, error) {
	row := q.db.QueryRow(ctx, deductRiderDeposit, arg.ID, arg.DepositAmount)
	var i Rider
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.RealName,
		&i.IDCardNo,
		&i.Phone,
		&i.DepositAmount,
		&i.FrozenDeposit,
		&i.Status,
		&i.IsOnline,
		&i.CreditScore,
		&i.CurrentLongitude,
		&i.CurrentLatitude,
		&i.LocationUpdatedAt,
		&i.TotalOrders,
		&i.TotalEarnings,
		&i.OnlineDuration,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.RegionID,
		&i.ApplicationID,
		&i.SubMchID,
	)
	return i, err
}

const getRider = `-- name: GetRider :one
SELECT id, user_id, real_name, id_card_no, phone, deposit_amount, frozen_deposit, status, is_online, credit_score, current_longitude, current_latitude, location_updated_at, total_orders, total_earnings, online_duration, created_at, updated_at, region_id, application_id, sub_mch_id FROM riders
WHERE id = $1 LIMIT 1
`

func (q *Queries) GetRider(ctx context.Context, id int64) (Rider, error) {
	row := q.db.QueryRow(ctx, getRider, id)
	var i Rider
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.RealName,
		&i.IDCardNo,
		&i.Phone,
		&i.DepositAmount,
		&i.FrozenDeposit,
		&i.Status,
		&i.IsOnline,
		&i.CreditScore,
		&i.CurrentLongitude,
		&i.CurrentLatitude,
		&i.LocationUpdatedAt,
		&i.TotalOrders,
		&i.TotalEarnings,
		&i.OnlineDuration,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.RegionID,
		&i.ApplicationID,
		&i.SubMchID,
	)
	return i, err
}

const getRiderBySubMchID = `-- name: GetRiderBySubMchID :one
SELECT id, user_id, real_name, id_card_no, phone, deposit_amount, frozen_deposit, status, is_online, credit_score, current_longitude, current_latitude, location_updated_at, total_orders, total_earnings, online_duration, created_at, updated_at, region_id, application_id, sub_mch_id FROM riders
WHERE sub_mch_id = $1 LIMIT 1
`

// 通过二级商户号查找骑手
func (q *Queries) GetRiderBySubMchID(ctx context.Context, subMchID pgtype.Text) (Rider, error) {
	row := q.db.QueryRow(ctx, getRiderBySubMchID, subMchID)
	var i Rider
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.RealName,
		&i.IDCardNo,
		&i.Phone,
		&i.DepositAmount,
		&i.FrozenDeposit,
		&i.Status,
		&i.IsOnline,
		&i.CreditScore,
		&i.CurrentLongitude,
		&i.CurrentLatitude,
		&i.LocationUpdatedAt,
		&i.TotalOrders,
		&i.TotalEarnings,
		&i.OnlineDuration,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.RegionID,
		&i.ApplicationID,
		&i.SubMchID,
	)
	return i, err
}

const getRiderByUserID = `-- name: GetRiderByUserID :one
SELECT id, user_id, real_name, id_card_no, phone, deposit_amount, frozen_deposit, status, is_online, credit_score, current_longitude, current_latitude, location_updated_at, total_orders, total_earnings, online_duration, created_at, updated_at, region_id, application_id, sub_mch_id FROM riders
WHERE user_id = $1 LIMIT 1
`

func (q *Queries) GetRiderByUserID(ctx context.Context, userID int64) (Rider, error) {
	row := q.db.QueryRow(ctx, getRiderByUserID, userID)
	var i Rider
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.RealName,
		&i.IDCardNo,
		&i.Phone,
		&i.DepositAmount,
		&i.FrozenDeposit,
		&i.Status,
		&i.IsOnline,
		&i.CreditScore,
		&i.CurrentLongitude,
		&i.CurrentLatitude,
		&i.LocationUpdatedAt,
		&i.TotalOrders,
		&i.TotalEarnings,
		&i.OnlineDuration,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.RegionID,
		&i.ApplicationID,
		&i.SubMchID,
	)
	return i, err
}

const getRiderForDeposit = `-- name: GetRiderForDeposit :one
SELECT id, deposit_amount, frozen_deposit
FROM riders
WHERE id = $1
FOR UPDATE
`

type GetRiderForDepositRow struct {
	ID            int64 `json:"id"`
	DepositAmount int64 `json:"deposit_amount"`
	FrozenDeposit int64 `json:"frozen_deposit"`
}

// 获取骑手押金信息（用于扣款前检查）
func (q *Queries) GetRiderForDeposit(ctx context.Context, id int64) (GetRiderForDepositRow, error) {
	row := q.db.QueryRow(ctx, getRiderForDeposit, id)
	var i GetRiderForDepositRow
	err := row.Scan(&i.ID, &i.DepositAmount, &i.FrozenDeposit)
	return i, err
}

const getRiderForUpdate = `-- name: GetRiderForUpdate :one
SELECT id, user_id, real_name, id_card_no, phone, deposit_amount, frozen_deposit, status, is_online, credit_score, current_longitude, current_latitude, location_updated_at, total_orders, total_earnings, online_duration, created_at, updated_at, region_id, application_id, sub_mch_id FROM riders
WHERE id = $1 LIMIT 1
FOR UPDATE
`

func (q *Queries) GetRiderForUpdate(ctx context.Context, id int64) (Rider, error) {
	row := q.db.QueryRow(ctx, getRiderForUpdate, id)
	var i Rider
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.RealName,
		&i.IDCardNo,
		&i.Phone,
		&i.DepositAmount,
		&i.FrozenDeposit,
		&i.Status,
		&i.IsOnline,
		&i.CreditScore,
		&i.CurrentLongitude,
		&i.CurrentLatitude,
		&i.LocationUpdatedAt,
		&i.TotalOrders,
		&i.TotalEarnings,
		&i.OnlineDuration,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.RegionID,
		&i.ApplicationID,
		&i.SubMchID,
	)
	return i, err
}

const listNearbyRiders = `-- name: ListNearbyRiders :many
SELECT id, user_id, real_name, id_card_no, phone, deposit_amount, frozen_deposit, status, is_online, credit_score, current_longitude, current_latitude, location_updated_at, total_orders, total_earnings, online_duration, created_at, updated_at, region_id, application_id, sub_mch_id, 
    (6371000 * acos(
        LEAST(1::float8, GREATEST(-1::float8,
            cos(radians($1::float8)) * cos(radians(current_latitude::float8)) * 
            cos(radians(current_longitude::float8) - radians($2::float8)) + 
            sin(radians($1::float8)) * sin(radians(current_latitude::float8))
        ))
    ))::int AS distance
FROM riders
WHERE is_online = true 
    AND status = 'active'
    AND current_latitude IS NOT NULL
    AND current_longitude IS NOT NULL
    AND (6371000 * acos(
        LEAST(1::float8, GREATEST(-1::float8,
            cos(radians($1::float8)) * cos(radians(current_latitude::float8)) * 
            cos(radians(current_longitude::float8) - radians($2::float8)) + 
            sin(radians($1::float8)) * sin(radians(current_latitude::float8))
        ))
    )) < $3::float8
ORDER BY distance
LIMIT $4::int
`

type ListNearbyRidersParams struct {
	CenterLat   float64 `json:"center_lat"`
	CenterLng   float64 `json:"center_lng"`
	MaxDistance float64 `json:"max_distance"`
	LimitCount  int32   `json:"limit_count"`
}

type ListNearbyRidersRow struct {
	ID                int64              `json:"id"`
	UserID            int64              `json:"user_id"`
	RealName          string             `json:"real_name"`
	IDCardNo          string             `json:"id_card_no"`
	Phone             string             `json:"phone"`
	DepositAmount     int64              `json:"deposit_amount"`
	FrozenDeposit     int64              `json:"frozen_deposit"`
	Status            string             `json:"status"`
	IsOnline          bool               `json:"is_online"`
	CreditScore       int16              `json:"credit_score"`
	CurrentLongitude  pgtype.Numeric     `json:"current_longitude"`
	CurrentLatitude   pgtype.Numeric     `json:"current_latitude"`
	LocationUpdatedAt pgtype.Timestamptz `json:"location_updated_at"`
	TotalOrders       int32              `json:"total_orders"`
	TotalEarnings     int64              `json:"total_earnings"`
	OnlineDuration    int32              `json:"online_duration"`
	CreatedAt         time.Time          `json:"created_at"`
	UpdatedAt         pgtype.Timestamptz `json:"updated_at"`
	RegionID          pgtype.Int8        `json:"region_id"`
	ApplicationID     pgtype.Int8        `json:"application_id"`
	SubMchID          pgtype.Text        `json:"sub_mch_id"`
	Distance          int32              `json:"distance"`
}

func (q *Queries) ListNearbyRiders(ctx context.Context, arg ListNearbyRidersParams) ([]ListNearbyRidersRow, error) {
	rows, err := q.db.Query(ctx, listNearbyRiders,
		arg.CenterLat,
		arg.CenterLng,
		arg.MaxDistance,
		arg.LimitCount,
	)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []ListNearbyRidersRow{}
	for rows.Next() {
		var i ListNearbyRidersRow
		if err := rows.Scan(
			&i.ID,
			&i.UserID,
			&i.RealName,
			&i.IDCardNo,
			&i.Phone,
			&i.DepositAmount,
			&i.FrozenDeposit,
			&i.Status,
			&i.IsOnline,
			&i.CreditScore,
			&i.CurrentLongitude,
			&i.CurrentLatitude,
			&i.LocationUpdatedAt,
			&i.TotalOrders,
			&i.TotalEarnings,
			&i.OnlineDuration,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.RegionID,
			&i.ApplicationID,
			&i.SubMchID,
			&i.Distance,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listOnlineRiders = `-- name: ListOnlineRiders :many
SELECT id, user_id, real_name, id_card_no, phone, deposit_amount, frozen_deposit, status, is_online, credit_score, current_longitude, current_latitude, location_updated_at, total_orders, total_earnings, online_duration, created_at, updated_at, region_id, application_id, sub_mch_id FROM riders
WHERE is_online = true AND status = 'active'
ORDER BY location_updated_at DESC
`

func (q *Queries) ListOnlineRiders(ctx context.Context) ([]Rider, error) {
	rows, err := q.db.Query(ctx, listOnlineRiders)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []Rider{}
	for rows.Next() {
		var i Rider
		if err := rows.Scan(
			&i.ID,
			&i.UserID,
			&i.RealName,
			&i.IDCardNo,
			&i.Phone,
			&i.DepositAmount,
			&i.FrozenDeposit,
			&i.Status,
			&i.IsOnline,
			&i.CreditScore,
			&i.CurrentLongitude,
			&i.CurrentLatitude,
			&i.LocationUpdatedAt,
			&i.TotalOrders,
			&i.TotalEarnings,
			&i.OnlineDuration,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.RegionID,
			&i.ApplicationID,
			&i.SubMchID,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listOnlineRidersByRegion = `-- name: ListOnlineRidersByRegion :many
SELECT id, user_id, real_name, id_card_no, phone, deposit_amount, frozen_deposit, status, is_online, credit_score, current_longitude, current_latitude, location_updated_at, total_orders, total_earnings, online_duration, created_at, updated_at, region_id, application_id, sub_mch_id FROM riders
WHERE region_id = $1 
    AND is_online = true 
    AND status = 'active'
ORDER BY location_updated_at DESC
`

// 列出区域内在线骑手
func (q *Queries) ListOnlineRidersByRegion(ctx context.Context, regionID pgtype.Int8) ([]Rider, error) {
	rows, err := q.db.Query(ctx, listOnlineRidersByRegion, regionID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []Rider{}
	for rows.Next() {
		var i Rider
		if err := rows.Scan(
			&i.ID,
			&i.UserID,
			&i.RealName,
			&i.IDCardNo,
			&i.Phone,
			&i.DepositAmount,
			&i.FrozenDeposit,
			&i.Status,
			&i.IsOnline,
			&i.CreditScore,
			&i.CurrentLongitude,
			&i.CurrentLatitude,
			&i.LocationUpdatedAt,
			&i.TotalOrders,
			&i.TotalEarnings,
			&i.OnlineDuration,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.RegionID,
			&i.ApplicationID,
			&i.SubMchID,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listRidersByRegion = `-- name: ListRidersByRegion :many
SELECT id, user_id, real_name, id_card_no, phone, deposit_amount, frozen_deposit, status, is_online, credit_score, current_longitude, current_latitude, location_updated_at, total_orders, total_earnings, online_duration, created_at, updated_at, region_id, application_id, sub_mch_id FROM riders
WHERE region_id = $1
ORDER BY created_at DESC
LIMIT $2 OFFSET $3
`

type ListRidersByRegionParams struct {
	RegionID pgtype.Int8 `json:"region_id"`
	Limit    int32       `json:"limit"`
	Offset   int32       `json:"offset"`
}

// 按区域列出骑手（供运营商管理使用）
func (q *Queries) ListRidersByRegion(ctx context.Context, arg ListRidersByRegionParams) ([]Rider, error) {
	rows, err := q.db.Query(ctx, listRidersByRegion, arg.RegionID, arg.Limit, arg.Offset)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []Rider{}
	for rows.Next() {
		var i Rider
		if err := rows.Scan(
			&i.ID,
			&i.UserID,
			&i.RealName,
			&i.IDCardNo,
			&i.Phone,
			&i.DepositAmount,
			&i.FrozenDeposit,
			&i.Status,
			&i.IsOnline,
			&i.CreditScore,
			&i.CurrentLongitude,
			&i.CurrentLatitude,
			&i.LocationUpdatedAt,
			&i.TotalOrders,
			&i.TotalEarnings,
			&i.OnlineDuration,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.RegionID,
			&i.ApplicationID,
			&i.SubMchID,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listRidersByRegionWithStatus = `-- name: ListRidersByRegionWithStatus :many
SELECT id, user_id, real_name, id_card_no, phone, deposit_amount, frozen_deposit, status, is_online, credit_score, current_longitude, current_latitude, location_updated_at, total_orders, total_earnings, online_duration, created_at, updated_at, region_id, application_id, sub_mch_id FROM riders
WHERE region_id = $1 AND status = $2
ORDER BY created_at DESC
LIMIT $3 OFFSET $4
`

type ListRidersByRegionWithStatusParams struct {
	RegionID pgtype.Int8 `json:"region_id"`
	Status   string      `json:"status"`
	Limit    int32       `json:"limit"`
	Offset   int32       `json:"offset"`
}

// 按区域和状态列出骑手
func (q *Queries) ListRidersByRegionWithStatus(ctx context.Context, arg ListRidersByRegionWithStatusParams) ([]Rider, error) {
	rows, err := q.db.Query(ctx, listRidersByRegionWithStatus,
		arg.RegionID,
		arg.Status,
		arg.Limit,
		arg.Offset,
	)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []Rider{}
	for rows.Next() {
		var i Rider
		if err := rows.Scan(
			&i.ID,
			&i.UserID,
			&i.RealName,
			&i.IDCardNo,
			&i.Phone,
			&i.DepositAmount,
			&i.FrozenDeposit,
			&i.Status,
			&i.IsOnline,
			&i.CreditScore,
			&i.CurrentLongitude,
			&i.CurrentLatitude,
			&i.LocationUpdatedAt,
			&i.TotalOrders,
			&i.TotalEarnings,
			&i.OnlineDuration,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.RegionID,
			&i.ApplicationID,
			&i.SubMchID,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listRidersByStatus = `-- name: ListRidersByStatus :many
SELECT id, user_id, real_name, id_card_no, phone, deposit_amount, frozen_deposit, status, is_online, credit_score, current_longitude, current_latitude, location_updated_at, total_orders, total_earnings, online_duration, created_at, updated_at, region_id, application_id, sub_mch_id FROM riders
WHERE status = $1
ORDER BY created_at DESC
LIMIT $2 OFFSET $3
`

type ListRidersByStatusParams struct {
	Status string `json:"status"`
	Limit  int32  `json:"limit"`
	Offset int32  `json:"offset"`
}

func (q *Queries) ListRidersByStatus(ctx context.Context, arg ListRidersByStatusParams) ([]Rider, error) {
	rows, err := q.db.Query(ctx, listRidersByStatus, arg.Status, arg.Limit, arg.Offset)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []Rider{}
	for rows.Next() {
		var i Rider
		if err := rows.Scan(
			&i.ID,
			&i.UserID,
			&i.RealName,
			&i.IDCardNo,
			&i.Phone,
			&i.DepositAmount,
			&i.FrozenDeposit,
			&i.Status,
			&i.IsOnline,
			&i.CreditScore,
			&i.CurrentLongitude,
			&i.CurrentLatitude,
			&i.LocationUpdatedAt,
			&i.TotalOrders,
			&i.TotalEarnings,
			&i.OnlineDuration,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.RegionID,
			&i.ApplicationID,
			&i.SubMchID,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const updateRiderDeposit = `-- name: UpdateRiderDeposit :one
UPDATE riders
SET 
    deposit_amount = $2,
    frozen_deposit = $3,
    updated_at = now()
WHERE id = $1
RETURNING id, user_id, real_name, id_card_no, phone, deposit_amount, frozen_deposit, status, is_online, credit_score, current_longitude, current_latitude, location_updated_at, total_orders, total_earnings, online_duration, created_at, updated_at, region_id, application_id, sub_mch_id
`

type UpdateRiderDepositParams struct {
	ID            int64 `json:"id"`
	DepositAmount int64 `json:"deposit_amount"`
	FrozenDeposit int64 `json:"frozen_deposit"`
}

func (q *Queries) UpdateRiderDeposit(ctx context.Context, arg UpdateRiderDepositParams) (Rider, error) {
	row := q.db.QueryRow(ctx, updateRiderDeposit, arg.ID, arg.DepositAmount, arg.FrozenDeposit)
	var i Rider
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.RealName,
		&i.IDCardNo,
		&i.Phone,
		&i.DepositAmount,
		&i.FrozenDeposit,
		&i.Status,
		&i.IsOnline,
		&i.CreditScore,
		&i.CurrentLongitude,
		&i.CurrentLatitude,
		&i.LocationUpdatedAt,
		&i.TotalOrders,
		&i.TotalEarnings,
		&i.OnlineDuration,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.RegionID,
		&i.ApplicationID,
		&i.SubMchID,
	)
	return i, err
}

const updateRiderLocation = `-- name: UpdateRiderLocation :one
UPDATE riders
SET 
    current_longitude = $2,
    current_latitude = $3,
    location_updated_at = now(),
    updated_at = now()
WHERE id = $1
RETURNING id, user_id, real_name, id_card_no, phone, deposit_amount, frozen_deposit, status, is_online, credit_score, current_longitude, current_latitude, location_updated_at, total_orders, total_earnings, online_duration, created_at, updated_at, region_id, application_id, sub_mch_id
`

type UpdateRiderLocationParams struct {
	ID               int64          `json:"id"`
	CurrentLongitude pgtype.Numeric `json:"current_longitude"`
	CurrentLatitude  pgtype.Numeric `json:"current_latitude"`
}

func (q *Queries) UpdateRiderLocation(ctx context.Context, arg UpdateRiderLocationParams) (Rider, error) {
	row := q.db.QueryRow(ctx, updateRiderLocation, arg.ID, arg.CurrentLongitude, arg.CurrentLatitude)
	var i Rider
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.RealName,
		&i.IDCardNo,
		&i.Phone,
		&i.DepositAmount,
		&i.FrozenDeposit,
		&i.Status,
		&i.IsOnline,
		&i.CreditScore,
		&i.CurrentLongitude,
		&i.CurrentLatitude,
		&i.LocationUpdatedAt,
		&i.TotalOrders,
		&i.TotalEarnings,
		&i.OnlineDuration,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.RegionID,
		&i.ApplicationID,
		&i.SubMchID,
	)
	return i, err
}

const updateRiderOnlineDuration = `-- name: UpdateRiderOnlineDuration :one
UPDATE riders
SET 
    online_duration = online_duration + $2,
    updated_at = now()
WHERE id = $1
RETURNING id, user_id, real_name, id_card_no, phone, deposit_amount, frozen_deposit, status, is_online, credit_score, current_longitude, current_latitude, location_updated_at, total_orders, total_earnings, online_duration, created_at, updated_at, region_id, application_id, sub_mch_id
`

type UpdateRiderOnlineDurationParams struct {
	ID             int64 `json:"id"`
	OnlineDuration int32 `json:"online_duration"`
}

func (q *Queries) UpdateRiderOnlineDuration(ctx context.Context, arg UpdateRiderOnlineDurationParams) (Rider, error) {
	row := q.db.QueryRow(ctx, updateRiderOnlineDuration, arg.ID, arg.OnlineDuration)
	var i Rider
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.RealName,
		&i.IDCardNo,
		&i.Phone,
		&i.DepositAmount,
		&i.FrozenDeposit,
		&i.Status,
		&i.IsOnline,
		&i.CreditScore,
		&i.CurrentLongitude,
		&i.CurrentLatitude,
		&i.LocationUpdatedAt,
		&i.TotalOrders,
		&i.TotalEarnings,
		&i.OnlineDuration,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.RegionID,
		&i.ApplicationID,
		&i.SubMchID,
	)
	return i, err
}

const updateRiderOnlineStatus = `-- name: UpdateRiderOnlineStatus :one
UPDATE riders
SET is_online = $2, updated_at = now()
WHERE id = $1
RETURNING id, user_id, real_name, id_card_no, phone, deposit_amount, frozen_deposit, status, is_online, credit_score, current_longitude, current_latitude, location_updated_at, total_orders, total_earnings, online_duration, created_at, updated_at, region_id, application_id, sub_mch_id
`

type UpdateRiderOnlineStatusParams struct {
	ID       int64 `json:"id"`
	IsOnline bool  `json:"is_online"`
}

func (q *Queries) UpdateRiderOnlineStatus(ctx context.Context, arg UpdateRiderOnlineStatusParams) (Rider, error) {
	row := q.db.QueryRow(ctx, updateRiderOnlineStatus, arg.ID, arg.IsOnline)
	var i Rider
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.RealName,
		&i.IDCardNo,
		&i.Phone,
		&i.DepositAmount,
		&i.FrozenDeposit,
		&i.Status,
		&i.IsOnline,
		&i.CreditScore,
		&i.CurrentLongitude,
		&i.CurrentLatitude,
		&i.LocationUpdatedAt,
		&i.TotalOrders,
		&i.TotalEarnings,
		&i.OnlineDuration,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.RegionID,
		&i.ApplicationID,
		&i.SubMchID,
	)
	return i, err
}

const updateRiderRegion = `-- name: UpdateRiderRegion :one
UPDATE riders
SET region_id = $2, updated_at = now()
WHERE id = $1
RETURNING id, user_id, real_name, id_card_no, phone, deposit_amount, frozen_deposit, status, is_online, credit_score, current_longitude, current_latitude, location_updated_at, total_orders, total_earnings, online_duration, created_at, updated_at, region_id, application_id, sub_mch_id
`

type UpdateRiderRegionParams struct {
	ID       int64       `json:"id"`
	RegionID pgtype.Int8 `json:"region_id"`
}

// 更新骑手所属区域
func (q *Queries) UpdateRiderRegion(ctx context.Context, arg UpdateRiderRegionParams) (Rider, error) {
	row := q.db.QueryRow(ctx, updateRiderRegion, arg.ID, arg.RegionID)
	var i Rider
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.RealName,
		&i.IDCardNo,
		&i.Phone,
		&i.DepositAmount,
		&i.FrozenDeposit,
		&i.Status,
		&i.IsOnline,
		&i.CreditScore,
		&i.CurrentLongitude,
		&i.CurrentLatitude,
		&i.LocationUpdatedAt,
		&i.TotalOrders,
		&i.TotalEarnings,
		&i.OnlineDuration,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.RegionID,
		&i.ApplicationID,
		&i.SubMchID,
	)
	return i, err
}

const updateRiderStats = `-- name: UpdateRiderStats :one
UPDATE riders
SET 
    total_orders = total_orders + $2,
    total_earnings = total_earnings + $3,
    updated_at = now()
WHERE id = $1
RETURNING id, user_id, real_name, id_card_no, phone, deposit_amount, frozen_deposit, status, is_online, credit_score, current_longitude, current_latitude, location_updated_at, total_orders, total_earnings, online_duration, created_at, updated_at, region_id, application_id, sub_mch_id
`

type UpdateRiderStatsParams struct {
	ID            int64 `json:"id"`
	TotalOrders   int32 `json:"total_orders"`
	TotalEarnings int64 `json:"total_earnings"`
}

func (q *Queries) UpdateRiderStats(ctx context.Context, arg UpdateRiderStatsParams) (Rider, error) {
	row := q.db.QueryRow(ctx, updateRiderStats, arg.ID, arg.TotalOrders, arg.TotalEarnings)
	var i Rider
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.RealName,
		&i.IDCardNo,
		&i.Phone,
		&i.DepositAmount,
		&i.FrozenDeposit,
		&i.Status,
		&i.IsOnline,
		&i.CreditScore,
		&i.CurrentLongitude,
		&i.CurrentLatitude,
		&i.LocationUpdatedAt,
		&i.TotalOrders,
		&i.TotalEarnings,
		&i.OnlineDuration,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.RegionID,
		&i.ApplicationID,
		&i.SubMchID,
	)
	return i, err
}

const updateRiderStatus = `-- name: UpdateRiderStatus :one
UPDATE riders
SET status = $2, updated_at = now()
WHERE id = $1
RETURNING id, user_id, real_name, id_card_no, phone, deposit_amount, frozen_deposit, status, is_online, credit_score, current_longitude, current_latitude, location_updated_at, total_orders, total_earnings, online_duration, created_at, updated_at, region_id, application_id, sub_mch_id
`

type UpdateRiderStatusParams struct {
	ID     int64  `json:"id"`
	Status string `json:"status"`
}

func (q *Queries) UpdateRiderStatus(ctx context.Context, arg UpdateRiderStatusParams) (Rider, error) {
	row := q.db.QueryRow(ctx, updateRiderStatus, arg.ID, arg.Status)
	var i Rider
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.RealName,
		&i.IDCardNo,
		&i.Phone,
		&i.DepositAmount,
		&i.FrozenDeposit,
		&i.Status,
		&i.IsOnline,
		&i.CreditScore,
		&i.CurrentLongitude,
		&i.CurrentLatitude,
		&i.LocationUpdatedAt,
		&i.TotalOrders,
		&i.TotalEarnings,
		&i.OnlineDuration,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.RegionID,
		&i.ApplicationID,
		&i.SubMchID,
	)
	return i, err
}

const updateRiderSubMchID = `-- name: UpdateRiderSubMchID :one
UPDATE riders
SET 
    sub_mch_id = $2,
    updated_at = now()
WHERE id = $1
RETURNING id, user_id, real_name, id_card_no, phone, deposit_amount, frozen_deposit, status, is_online, credit_score, current_longitude, current_latitude, location_updated_at, total_orders, total_earnings, online_duration, created_at, updated_at, region_id, application_id, sub_mch_id
`

type UpdateRiderSubMchIDParams struct {
	ID       int64       `json:"id"`
	SubMchID pgtype.Text `json:"sub_mch_id"`
}

// 更新骑手的微信二级商户号
func (q *Queries) UpdateRiderSubMchID(ctx context.Context, arg UpdateRiderSubMchIDParams) (Rider, error) {
	row := q.db.QueryRow(ctx, updateRiderSubMchID, arg.ID, arg.SubMchID)
	var i Rider
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.RealName,
		&i.IDCardNo,
		&i.Phone,
		&i.DepositAmount,
		&i.FrozenDeposit,
		&i.Status,
		&i.IsOnline,
		&i.CreditScore,
		&i.CurrentLongitude,
		&i.CurrentLatitude,
		&i.LocationUpdatedAt,
		&i.TotalOrders,
		&i.TotalEarnings,
		&i.OnlineDuration,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.RegionID,
		&i.ApplicationID,
		&i.SubMchID,
	)
	return i, err
}
