// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: operator_application.sql

package db

import (
	"context"
	"time"

	"github.com/jackc/pgx/v5/pgtype"
)

const approveOperatorApplication = `-- name: ApproveOperatorApplication :one
UPDATE operator_applications
SET
  status = 'approved',
  reviewed_by = $2,
  reviewed_at = now(),
  updated_at = now()
WHERE id = $1 AND status = 'submitted'
RETURNING id, user_id, region_id, name, contact_name, contact_phone, business_license_url, business_license_number, business_license_ocr, legal_person_name, legal_person_id_number, id_card_front_url, id_card_back_url, id_card_front_ocr, id_card_back_ocr, requested_contract_years, status, reject_reason, reviewed_by, reviewed_at, created_at, updated_at, submitted_at
`

type ApproveOperatorApplicationParams struct {
	ID         int64       `json:"id"`
	ReviewedBy pgtype.Int8 `json:"reviewed_by"`
}

// 审核通过运营商申请（平台管理员操作）
func (q *Queries) ApproveOperatorApplication(ctx context.Context, arg ApproveOperatorApplicationParams) (OperatorApplication, error) {
	row := q.db.QueryRow(ctx, approveOperatorApplication, arg.ID, arg.ReviewedBy)
	var i OperatorApplication
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.RegionID,
		&i.Name,
		&i.ContactName,
		&i.ContactPhone,
		&i.BusinessLicenseUrl,
		&i.BusinessLicenseNumber,
		&i.BusinessLicenseOcr,
		&i.LegalPersonName,
		&i.LegalPersonIDNumber,
		&i.IDCardFrontUrl,
		&i.IDCardBackUrl,
		&i.IDCardFrontOcr,
		&i.IDCardBackOcr,
		&i.RequestedContractYears,
		&i.Status,
		&i.RejectReason,
		&i.ReviewedBy,
		&i.ReviewedAt,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.SubmittedAt,
	)
	return i, err
}

const countPendingOperatorApplications = `-- name: CountPendingOperatorApplications :one
SELECT COUNT(*) FROM operator_applications
WHERE status = 'submitted'
`

// 统计待审核申请数量
func (q *Queries) CountPendingOperatorApplications(ctx context.Context) (int64, error) {
	row := q.db.QueryRow(ctx, countPendingOperatorApplications)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const createOperatorApplicationDraft = `-- name: CreateOperatorApplicationDraft :one

INSERT INTO operator_applications (
  user_id,
  region_id,
  status
) VALUES (
  $1, $2, 'draft'
)
RETURNING id, user_id, region_id, name, contact_name, contact_phone, business_license_url, business_license_number, business_license_ocr, legal_person_name, legal_person_id_number, id_card_front_url, id_card_back_url, id_card_front_ocr, id_card_back_ocr, requested_contract_years, status, reject_reason, reviewed_by, reviewed_at, created_at, updated_at, submitted_at
`

type CreateOperatorApplicationDraftParams struct {
	UserID   int64 `json:"user_id"`
	RegionID int64 `json:"region_id"`
}

// ==================== 运营商入驻申请（草稿模式+人工审核） ====================
// 创建运营商申请草稿（需要用户ID和区域ID）
func (q *Queries) CreateOperatorApplicationDraft(ctx context.Context, arg CreateOperatorApplicationDraftParams) (OperatorApplication, error) {
	row := q.db.QueryRow(ctx, createOperatorApplicationDraft, arg.UserID, arg.RegionID)
	var i OperatorApplication
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.RegionID,
		&i.Name,
		&i.ContactName,
		&i.ContactPhone,
		&i.BusinessLicenseUrl,
		&i.BusinessLicenseNumber,
		&i.BusinessLicenseOcr,
		&i.LegalPersonName,
		&i.LegalPersonIDNumber,
		&i.IDCardFrontUrl,
		&i.IDCardBackUrl,
		&i.IDCardFrontOcr,
		&i.IDCardBackOcr,
		&i.RequestedContractYears,
		&i.Status,
		&i.RejectReason,
		&i.ReviewedBy,
		&i.ReviewedAt,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.SubmittedAt,
	)
	return i, err
}

const getOperatorApplicationByID = `-- name: GetOperatorApplicationByID :one
SELECT id, user_id, region_id, name, contact_name, contact_phone, business_license_url, business_license_number, business_license_ocr, legal_person_name, legal_person_id_number, id_card_front_url, id_card_back_url, id_card_front_ocr, id_card_back_ocr, requested_contract_years, status, reject_reason, reviewed_by, reviewed_at, created_at, updated_at, submitted_at FROM operator_applications
WHERE id = $1
`

// 通过ID获取申请
func (q *Queries) GetOperatorApplicationByID(ctx context.Context, id int64) (OperatorApplication, error) {
	row := q.db.QueryRow(ctx, getOperatorApplicationByID, id)
	var i OperatorApplication
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.RegionID,
		&i.Name,
		&i.ContactName,
		&i.ContactPhone,
		&i.BusinessLicenseUrl,
		&i.BusinessLicenseNumber,
		&i.BusinessLicenseOcr,
		&i.LegalPersonName,
		&i.LegalPersonIDNumber,
		&i.IDCardFrontUrl,
		&i.IDCardBackUrl,
		&i.IDCardFrontOcr,
		&i.IDCardBackOcr,
		&i.RequestedContractYears,
		&i.Status,
		&i.RejectReason,
		&i.ReviewedBy,
		&i.ReviewedAt,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.SubmittedAt,
	)
	return i, err
}

const getOperatorApplicationByUserID = `-- name: GetOperatorApplicationByUserID :one
SELECT id, user_id, region_id, name, contact_name, contact_phone, business_license_url, business_license_number, business_license_ocr, legal_person_name, legal_person_id_number, id_card_front_url, id_card_back_url, id_card_front_ocr, id_card_back_ocr, requested_contract_years, status, reject_reason, reviewed_by, reviewed_at, created_at, updated_at, submitted_at FROM operator_applications
WHERE user_id = $1
ORDER BY created_at DESC
LIMIT 1
`

// 获取用户的任意状态申请
func (q *Queries) GetOperatorApplicationByUserID(ctx context.Context, userID int64) (OperatorApplication, error) {
	row := q.db.QueryRow(ctx, getOperatorApplicationByUserID, userID)
	var i OperatorApplication
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.RegionID,
		&i.Name,
		&i.ContactName,
		&i.ContactPhone,
		&i.BusinessLicenseUrl,
		&i.BusinessLicenseNumber,
		&i.BusinessLicenseOcr,
		&i.LegalPersonName,
		&i.LegalPersonIDNumber,
		&i.IDCardFrontUrl,
		&i.IDCardBackUrl,
		&i.IDCardFrontOcr,
		&i.IDCardBackOcr,
		&i.RequestedContractYears,
		&i.Status,
		&i.RejectReason,
		&i.ReviewedBy,
		&i.ReviewedAt,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.SubmittedAt,
	)
	return i, err
}

const getOperatorApplicationDraft = `-- name: GetOperatorApplicationDraft :one
SELECT id, user_id, region_id, name, contact_name, contact_phone, business_license_url, business_license_number, business_license_ocr, legal_person_name, legal_person_id_number, id_card_front_url, id_card_back_url, id_card_front_ocr, id_card_back_ocr, requested_contract_years, status, reject_reason, reviewed_by, reviewed_at, created_at, updated_at, submitted_at FROM operator_applications
WHERE user_id = $1 AND status IN ('draft', 'rejected')
ORDER BY created_at DESC
LIMIT 1
`

// 获取用户的草稿或可编辑申请（排除已通过的）
func (q *Queries) GetOperatorApplicationDraft(ctx context.Context, userID int64) (OperatorApplication, error) {
	row := q.db.QueryRow(ctx, getOperatorApplicationDraft, userID)
	var i OperatorApplication
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.RegionID,
		&i.Name,
		&i.ContactName,
		&i.ContactPhone,
		&i.BusinessLicenseUrl,
		&i.BusinessLicenseNumber,
		&i.BusinessLicenseOcr,
		&i.LegalPersonName,
		&i.LegalPersonIDNumber,
		&i.IDCardFrontUrl,
		&i.IDCardBackUrl,
		&i.IDCardFrontOcr,
		&i.IDCardBackOcr,
		&i.RequestedContractYears,
		&i.Status,
		&i.RejectReason,
		&i.ReviewedBy,
		&i.ReviewedAt,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.SubmittedAt,
	)
	return i, err
}

const getPendingOperatorApplicationByRegion = `-- name: GetPendingOperatorApplicationByRegion :one
SELECT id, user_id, region_id, name, contact_name, contact_phone, business_license_url, business_license_number, business_license_ocr, legal_person_name, legal_person_id_number, id_card_front_url, id_card_back_url, id_card_front_ocr, id_card_back_ocr, requested_contract_years, status, reject_reason, reviewed_by, reviewed_at, created_at, updated_at, submitted_at FROM operator_applications
WHERE region_id = $1 AND status IN ('submitted', 'approved')
LIMIT 1
`

// 检查区域是否有待审核或已通过的申请（用于区域独占检查）
func (q *Queries) GetPendingOperatorApplicationByRegion(ctx context.Context, regionID int64) (OperatorApplication, error) {
	row := q.db.QueryRow(ctx, getPendingOperatorApplicationByRegion, regionID)
	var i OperatorApplication
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.RegionID,
		&i.Name,
		&i.ContactName,
		&i.ContactPhone,
		&i.BusinessLicenseUrl,
		&i.BusinessLicenseNumber,
		&i.BusinessLicenseOcr,
		&i.LegalPersonName,
		&i.LegalPersonIDNumber,
		&i.IDCardFrontUrl,
		&i.IDCardBackUrl,
		&i.IDCardFrontOcr,
		&i.IDCardBackOcr,
		&i.RequestedContractYears,
		&i.Status,
		&i.RejectReason,
		&i.ReviewedBy,
		&i.ReviewedAt,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.SubmittedAt,
	)
	return i, err
}

const listOperatorApplications = `-- name: ListOperatorApplications :many
SELECT 
  oa.id, oa.user_id, oa.region_id, oa.name, oa.contact_name, oa.contact_phone, oa.business_license_url, oa.business_license_number, oa.business_license_ocr, oa.legal_person_name, oa.legal_person_id_number, oa.id_card_front_url, oa.id_card_back_url, oa.id_card_front_ocr, oa.id_card_back_ocr, oa.requested_contract_years, oa.status, oa.reject_reason, oa.reviewed_by, oa.reviewed_at, oa.created_at, oa.updated_at, oa.submitted_at,
  r.name as region_name,
  r.code as region_code
FROM operator_applications oa
JOIN regions r ON r.id = oa.region_id
WHERE ($3::text IS NULL OR oa.status = $3)
ORDER BY oa.created_at DESC
LIMIT $1 OFFSET $2
`

type ListOperatorApplicationsParams struct {
	Limit  int32       `json:"limit"`
	Offset int32       `json:"offset"`
	Status pgtype.Text `json:"status"`
}

type ListOperatorApplicationsRow struct {
	ID                     int64              `json:"id"`
	UserID                 int64              `json:"user_id"`
	RegionID               int64              `json:"region_id"`
	Name                   pgtype.Text        `json:"name"`
	ContactName            pgtype.Text        `json:"contact_name"`
	ContactPhone           pgtype.Text        `json:"contact_phone"`
	BusinessLicenseUrl     pgtype.Text        `json:"business_license_url"`
	BusinessLicenseNumber  pgtype.Text        `json:"business_license_number"`
	BusinessLicenseOcr     []byte             `json:"business_license_ocr"`
	LegalPersonName        pgtype.Text        `json:"legal_person_name"`
	LegalPersonIDNumber    pgtype.Text        `json:"legal_person_id_number"`
	IDCardFrontUrl         pgtype.Text        `json:"id_card_front_url"`
	IDCardBackUrl          pgtype.Text        `json:"id_card_back_url"`
	IDCardFrontOcr         []byte             `json:"id_card_front_ocr"`
	IDCardBackOcr          []byte             `json:"id_card_back_ocr"`
	RequestedContractYears int32              `json:"requested_contract_years"`
	Status                 string             `json:"status"`
	RejectReason           pgtype.Text        `json:"reject_reason"`
	ReviewedBy             pgtype.Int8        `json:"reviewed_by"`
	ReviewedAt             pgtype.Timestamptz `json:"reviewed_at"`
	CreatedAt              time.Time          `json:"created_at"`
	UpdatedAt              time.Time          `json:"updated_at"`
	SubmittedAt            pgtype.Timestamptz `json:"submitted_at"`
	RegionName             string             `json:"region_name"`
	RegionCode             string             `json:"region_code"`
}

// 列出所有申请（支持状态筛选）
func (q *Queries) ListOperatorApplications(ctx context.Context, arg ListOperatorApplicationsParams) ([]ListOperatorApplicationsRow, error) {
	rows, err := q.db.Query(ctx, listOperatorApplications, arg.Limit, arg.Offset, arg.Status)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []ListOperatorApplicationsRow{}
	for rows.Next() {
		var i ListOperatorApplicationsRow
		if err := rows.Scan(
			&i.ID,
			&i.UserID,
			&i.RegionID,
			&i.Name,
			&i.ContactName,
			&i.ContactPhone,
			&i.BusinessLicenseUrl,
			&i.BusinessLicenseNumber,
			&i.BusinessLicenseOcr,
			&i.LegalPersonName,
			&i.LegalPersonIDNumber,
			&i.IDCardFrontUrl,
			&i.IDCardBackUrl,
			&i.IDCardFrontOcr,
			&i.IDCardBackOcr,
			&i.RequestedContractYears,
			&i.Status,
			&i.RejectReason,
			&i.ReviewedBy,
			&i.ReviewedAt,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.SubmittedAt,
			&i.RegionName,
			&i.RegionCode,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listPendingOperatorApplications = `-- name: ListPendingOperatorApplications :many
SELECT 
  oa.id, oa.user_id, oa.region_id, oa.name, oa.contact_name, oa.contact_phone, oa.business_license_url, oa.business_license_number, oa.business_license_ocr, oa.legal_person_name, oa.legal_person_id_number, oa.id_card_front_url, oa.id_card_back_url, oa.id_card_front_ocr, oa.id_card_back_ocr, oa.requested_contract_years, oa.status, oa.reject_reason, oa.reviewed_by, oa.reviewed_at, oa.created_at, oa.updated_at, oa.submitted_at,
  r.name as region_name,
  r.code as region_code
FROM operator_applications oa
JOIN regions r ON r.id = oa.region_id
WHERE oa.status = 'submitted'
ORDER BY oa.submitted_at ASC
LIMIT $1 OFFSET $2
`

type ListPendingOperatorApplicationsParams struct {
	Limit  int32 `json:"limit"`
	Offset int32 `json:"offset"`
}

type ListPendingOperatorApplicationsRow struct {
	ID                     int64              `json:"id"`
	UserID                 int64              `json:"user_id"`
	RegionID               int64              `json:"region_id"`
	Name                   pgtype.Text        `json:"name"`
	ContactName            pgtype.Text        `json:"contact_name"`
	ContactPhone           pgtype.Text        `json:"contact_phone"`
	BusinessLicenseUrl     pgtype.Text        `json:"business_license_url"`
	BusinessLicenseNumber  pgtype.Text        `json:"business_license_number"`
	BusinessLicenseOcr     []byte             `json:"business_license_ocr"`
	LegalPersonName        pgtype.Text        `json:"legal_person_name"`
	LegalPersonIDNumber    pgtype.Text        `json:"legal_person_id_number"`
	IDCardFrontUrl         pgtype.Text        `json:"id_card_front_url"`
	IDCardBackUrl          pgtype.Text        `json:"id_card_back_url"`
	IDCardFrontOcr         []byte             `json:"id_card_front_ocr"`
	IDCardBackOcr          []byte             `json:"id_card_back_ocr"`
	RequestedContractYears int32              `json:"requested_contract_years"`
	Status                 string             `json:"status"`
	RejectReason           pgtype.Text        `json:"reject_reason"`
	ReviewedBy             pgtype.Int8        `json:"reviewed_by"`
	ReviewedAt             pgtype.Timestamptz `json:"reviewed_at"`
	CreatedAt              time.Time          `json:"created_at"`
	UpdatedAt              time.Time          `json:"updated_at"`
	SubmittedAt            pgtype.Timestamptz `json:"submitted_at"`
	RegionName             string             `json:"region_name"`
	RegionCode             string             `json:"region_code"`
}

// 列出待审核的申请（平台管理员用）
func (q *Queries) ListPendingOperatorApplications(ctx context.Context, arg ListPendingOperatorApplicationsParams) ([]ListPendingOperatorApplicationsRow, error) {
	rows, err := q.db.Query(ctx, listPendingOperatorApplications, arg.Limit, arg.Offset)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []ListPendingOperatorApplicationsRow{}
	for rows.Next() {
		var i ListPendingOperatorApplicationsRow
		if err := rows.Scan(
			&i.ID,
			&i.UserID,
			&i.RegionID,
			&i.Name,
			&i.ContactName,
			&i.ContactPhone,
			&i.BusinessLicenseUrl,
			&i.BusinessLicenseNumber,
			&i.BusinessLicenseOcr,
			&i.LegalPersonName,
			&i.LegalPersonIDNumber,
			&i.IDCardFrontUrl,
			&i.IDCardBackUrl,
			&i.IDCardFrontOcr,
			&i.IDCardBackOcr,
			&i.RequestedContractYears,
			&i.Status,
			&i.RejectReason,
			&i.ReviewedBy,
			&i.ReviewedAt,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.SubmittedAt,
			&i.RegionName,
			&i.RegionCode,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const rejectOperatorApplication = `-- name: RejectOperatorApplication :one
UPDATE operator_applications
SET
  status = 'rejected',
  reject_reason = $2,
  reviewed_by = $3,
  reviewed_at = now(),
  updated_at = now()
WHERE id = $1 AND status = 'submitted'
RETURNING id, user_id, region_id, name, contact_name, contact_phone, business_license_url, business_license_number, business_license_ocr, legal_person_name, legal_person_id_number, id_card_front_url, id_card_back_url, id_card_front_ocr, id_card_back_ocr, requested_contract_years, status, reject_reason, reviewed_by, reviewed_at, created_at, updated_at, submitted_at
`

type RejectOperatorApplicationParams struct {
	ID           int64       `json:"id"`
	RejectReason pgtype.Text `json:"reject_reason"`
	ReviewedBy   pgtype.Int8 `json:"reviewed_by"`
}

// 拒绝运营商申请（平台管理员操作）
func (q *Queries) RejectOperatorApplication(ctx context.Context, arg RejectOperatorApplicationParams) (OperatorApplication, error) {
	row := q.db.QueryRow(ctx, rejectOperatorApplication, arg.ID, arg.RejectReason, arg.ReviewedBy)
	var i OperatorApplication
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.RegionID,
		&i.Name,
		&i.ContactName,
		&i.ContactPhone,
		&i.BusinessLicenseUrl,
		&i.BusinessLicenseNumber,
		&i.BusinessLicenseOcr,
		&i.LegalPersonName,
		&i.LegalPersonIDNumber,
		&i.IDCardFrontUrl,
		&i.IDCardBackUrl,
		&i.IDCardFrontOcr,
		&i.IDCardBackOcr,
		&i.RequestedContractYears,
		&i.Status,
		&i.RejectReason,
		&i.ReviewedBy,
		&i.ReviewedAt,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.SubmittedAt,
	)
	return i, err
}

const resetOperatorApplicationToDraft = `-- name: ResetOperatorApplicationToDraft :one
UPDATE operator_applications
SET
  status = 'draft',
  reject_reason = NULL,
  updated_at = now()
WHERE id = $1 AND status = 'rejected'
RETURNING id, user_id, region_id, name, contact_name, contact_phone, business_license_url, business_license_number, business_license_ocr, legal_person_name, legal_person_id_number, id_card_front_url, id_card_back_url, id_card_front_ocr, id_card_back_ocr, requested_contract_years, status, reject_reason, reviewed_by, reviewed_at, created_at, updated_at, submitted_at
`

// 重置被拒绝的申请为草稿（允许重新编辑提交）
func (q *Queries) ResetOperatorApplicationToDraft(ctx context.Context, id int64) (OperatorApplication, error) {
	row := q.db.QueryRow(ctx, resetOperatorApplicationToDraft, id)
	var i OperatorApplication
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.RegionID,
		&i.Name,
		&i.ContactName,
		&i.ContactPhone,
		&i.BusinessLicenseUrl,
		&i.BusinessLicenseNumber,
		&i.BusinessLicenseOcr,
		&i.LegalPersonName,
		&i.LegalPersonIDNumber,
		&i.IDCardFrontUrl,
		&i.IDCardBackUrl,
		&i.IDCardFrontOcr,
		&i.IDCardBackOcr,
		&i.RequestedContractYears,
		&i.Status,
		&i.RejectReason,
		&i.ReviewedBy,
		&i.ReviewedAt,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.SubmittedAt,
	)
	return i, err
}

const submitOperatorApplication = `-- name: SubmitOperatorApplication :one
UPDATE operator_applications
SET
  status = 'submitted',
  submitted_at = now(),
  updated_at = now()
WHERE id = $1 AND status = 'draft'
RETURNING id, user_id, region_id, name, contact_name, contact_phone, business_license_url, business_license_number, business_license_ocr, legal_person_name, legal_person_id_number, id_card_front_url, id_card_back_url, id_card_front_ocr, id_card_back_ocr, requested_contract_years, status, reject_reason, reviewed_by, reviewed_at, created_at, updated_at, submitted_at
`

// 提交运营商申请（从草稿变为已提交待审核）
func (q *Queries) SubmitOperatorApplication(ctx context.Context, id int64) (OperatorApplication, error) {
	row := q.db.QueryRow(ctx, submitOperatorApplication, id)
	var i OperatorApplication
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.RegionID,
		&i.Name,
		&i.ContactName,
		&i.ContactPhone,
		&i.BusinessLicenseUrl,
		&i.BusinessLicenseNumber,
		&i.BusinessLicenseOcr,
		&i.LegalPersonName,
		&i.LegalPersonIDNumber,
		&i.IDCardFrontUrl,
		&i.IDCardBackUrl,
		&i.IDCardFrontOcr,
		&i.IDCardBackOcr,
		&i.RequestedContractYears,
		&i.Status,
		&i.RejectReason,
		&i.ReviewedBy,
		&i.ReviewedAt,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.SubmittedAt,
	)
	return i, err
}

const updateOperatorApplicationBasicInfo = `-- name: UpdateOperatorApplicationBasicInfo :one
UPDATE operator_applications
SET
  name = COALESCE($2, name),
  contact_name = COALESCE($3, contact_name),
  contact_phone = COALESCE($4, contact_phone),
  requested_contract_years = COALESCE($5, requested_contract_years),
  updated_at = now()
WHERE id = $1 AND status = 'draft'
RETURNING id, user_id, region_id, name, contact_name, contact_phone, business_license_url, business_license_number, business_license_ocr, legal_person_name, legal_person_id_number, id_card_front_url, id_card_back_url, id_card_front_ocr, id_card_back_ocr, requested_contract_years, status, reject_reason, reviewed_by, reviewed_at, created_at, updated_at, submitted_at
`

type UpdateOperatorApplicationBasicInfoParams struct {
	ID                     int64       `json:"id"`
	Name                   pgtype.Text `json:"name"`
	ContactName            pgtype.Text `json:"contact_name"`
	ContactPhone           pgtype.Text `json:"contact_phone"`
	RequestedContractYears pgtype.Int4 `json:"requested_contract_years"`
}

// 更新基础信息（名称、联系人、联系电话、合同年限）
func (q *Queries) UpdateOperatorApplicationBasicInfo(ctx context.Context, arg UpdateOperatorApplicationBasicInfoParams) (OperatorApplication, error) {
	row := q.db.QueryRow(ctx, updateOperatorApplicationBasicInfo,
		arg.ID,
		arg.Name,
		arg.ContactName,
		arg.ContactPhone,
		arg.RequestedContractYears,
	)
	var i OperatorApplication
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.RegionID,
		&i.Name,
		&i.ContactName,
		&i.ContactPhone,
		&i.BusinessLicenseUrl,
		&i.BusinessLicenseNumber,
		&i.BusinessLicenseOcr,
		&i.LegalPersonName,
		&i.LegalPersonIDNumber,
		&i.IDCardFrontUrl,
		&i.IDCardBackUrl,
		&i.IDCardFrontOcr,
		&i.IDCardBackOcr,
		&i.RequestedContractYears,
		&i.Status,
		&i.RejectReason,
		&i.ReviewedBy,
		&i.ReviewedAt,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.SubmittedAt,
	)
	return i, err
}

const updateOperatorApplicationBusinessLicense = `-- name: UpdateOperatorApplicationBusinessLicense :one
UPDATE operator_applications
SET
  business_license_url = COALESCE($2, business_license_url),
  business_license_number = COALESCE($3, business_license_number),
  business_license_ocr = COALESCE($4, business_license_ocr),
  name = COALESCE($5, name),
  updated_at = now()
WHERE id = $1 AND status = 'draft'
RETURNING id, user_id, region_id, name, contact_name, contact_phone, business_license_url, business_license_number, business_license_ocr, legal_person_name, legal_person_id_number, id_card_front_url, id_card_back_url, id_card_front_ocr, id_card_back_ocr, requested_contract_years, status, reject_reason, reviewed_by, reviewed_at, created_at, updated_at, submitted_at
`

type UpdateOperatorApplicationBusinessLicenseParams struct {
	ID                    int64       `json:"id"`
	BusinessLicenseUrl    pgtype.Text `json:"business_license_url"`
	BusinessLicenseNumber pgtype.Text `json:"business_license_number"`
	BusinessLicenseOcr    []byte      `json:"business_license_ocr"`
	Name                  pgtype.Text `json:"name"`
}

// 更新营业执照信息（图片URL、执照号和OCR结果）
func (q *Queries) UpdateOperatorApplicationBusinessLicense(ctx context.Context, arg UpdateOperatorApplicationBusinessLicenseParams) (OperatorApplication, error) {
	row := q.db.QueryRow(ctx, updateOperatorApplicationBusinessLicense,
		arg.ID,
		arg.BusinessLicenseUrl,
		arg.BusinessLicenseNumber,
		arg.BusinessLicenseOcr,
		arg.Name,
	)
	var i OperatorApplication
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.RegionID,
		&i.Name,
		&i.ContactName,
		&i.ContactPhone,
		&i.BusinessLicenseUrl,
		&i.BusinessLicenseNumber,
		&i.BusinessLicenseOcr,
		&i.LegalPersonName,
		&i.LegalPersonIDNumber,
		&i.IDCardFrontUrl,
		&i.IDCardBackUrl,
		&i.IDCardFrontOcr,
		&i.IDCardBackOcr,
		&i.RequestedContractYears,
		&i.Status,
		&i.RejectReason,
		&i.ReviewedBy,
		&i.ReviewedAt,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.SubmittedAt,
	)
	return i, err
}

const updateOperatorApplicationIDCardBack = `-- name: UpdateOperatorApplicationIDCardBack :one
UPDATE operator_applications
SET
  id_card_back_url = COALESCE($2, id_card_back_url),
  id_card_back_ocr = COALESCE($3, id_card_back_ocr),
  updated_at = now()
WHERE id = $1 AND status = 'draft'
RETURNING id, user_id, region_id, name, contact_name, contact_phone, business_license_url, business_license_number, business_license_ocr, legal_person_name, legal_person_id_number, id_card_front_url, id_card_back_url, id_card_front_ocr, id_card_back_ocr, requested_contract_years, status, reject_reason, reviewed_by, reviewed_at, created_at, updated_at, submitted_at
`

type UpdateOperatorApplicationIDCardBackParams struct {
	ID            int64       `json:"id"`
	IDCardBackUrl pgtype.Text `json:"id_card_back_url"`
	IDCardBackOcr []byte      `json:"id_card_back_ocr"`
}

// 更新身份证背面信息（图片URL和OCR结果）
func (q *Queries) UpdateOperatorApplicationIDCardBack(ctx context.Context, arg UpdateOperatorApplicationIDCardBackParams) (OperatorApplication, error) {
	row := q.db.QueryRow(ctx, updateOperatorApplicationIDCardBack, arg.ID, arg.IDCardBackUrl, arg.IDCardBackOcr)
	var i OperatorApplication
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.RegionID,
		&i.Name,
		&i.ContactName,
		&i.ContactPhone,
		&i.BusinessLicenseUrl,
		&i.BusinessLicenseNumber,
		&i.BusinessLicenseOcr,
		&i.LegalPersonName,
		&i.LegalPersonIDNumber,
		&i.IDCardFrontUrl,
		&i.IDCardBackUrl,
		&i.IDCardFrontOcr,
		&i.IDCardBackOcr,
		&i.RequestedContractYears,
		&i.Status,
		&i.RejectReason,
		&i.ReviewedBy,
		&i.ReviewedAt,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.SubmittedAt,
	)
	return i, err
}

const updateOperatorApplicationIDCardFront = `-- name: UpdateOperatorApplicationIDCardFront :one
UPDATE operator_applications
SET
  id_card_front_url = COALESCE($2, id_card_front_url),
  legal_person_name = COALESCE($3, legal_person_name),
  legal_person_id_number = COALESCE($4, legal_person_id_number),
  id_card_front_ocr = COALESCE($5, id_card_front_ocr),
  updated_at = now()
WHERE id = $1 AND status = 'draft'
RETURNING id, user_id, region_id, name, contact_name, contact_phone, business_license_url, business_license_number, business_license_ocr, legal_person_name, legal_person_id_number, id_card_front_url, id_card_back_url, id_card_front_ocr, id_card_back_ocr, requested_contract_years, status, reject_reason, reviewed_by, reviewed_at, created_at, updated_at, submitted_at
`

type UpdateOperatorApplicationIDCardFrontParams struct {
	ID                  int64       `json:"id"`
	IDCardFrontUrl      pgtype.Text `json:"id_card_front_url"`
	LegalPersonName     pgtype.Text `json:"legal_person_name"`
	LegalPersonIDNumber pgtype.Text `json:"legal_person_id_number"`
	IDCardFrontOcr      []byte      `json:"id_card_front_ocr"`
}

// 更新身份证正面信息（图片URL、姓名、身份证号和OCR结果）
func (q *Queries) UpdateOperatorApplicationIDCardFront(ctx context.Context, arg UpdateOperatorApplicationIDCardFrontParams) (OperatorApplication, error) {
	row := q.db.QueryRow(ctx, updateOperatorApplicationIDCardFront,
		arg.ID,
		arg.IDCardFrontUrl,
		arg.LegalPersonName,
		arg.LegalPersonIDNumber,
		arg.IDCardFrontOcr,
	)
	var i OperatorApplication
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.RegionID,
		&i.Name,
		&i.ContactName,
		&i.ContactPhone,
		&i.BusinessLicenseUrl,
		&i.BusinessLicenseNumber,
		&i.BusinessLicenseOcr,
		&i.LegalPersonName,
		&i.LegalPersonIDNumber,
		&i.IDCardFrontUrl,
		&i.IDCardBackUrl,
		&i.IDCardFrontOcr,
		&i.IDCardBackOcr,
		&i.RequestedContractYears,
		&i.Status,
		&i.RejectReason,
		&i.ReviewedBy,
		&i.ReviewedAt,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.SubmittedAt,
	)
	return i, err
}

const updateOperatorApplicationRegion = `-- name: UpdateOperatorApplicationRegion :one
UPDATE operator_applications
SET
  region_id = $2,
  updated_at = now()
WHERE id = $1 AND status = 'draft'
RETURNING id, user_id, region_id, name, contact_name, contact_phone, business_license_url, business_license_number, business_license_ocr, legal_person_name, legal_person_id_number, id_card_front_url, id_card_back_url, id_card_front_ocr, id_card_back_ocr, requested_contract_years, status, reject_reason, reviewed_by, reviewed_at, created_at, updated_at, submitted_at
`

type UpdateOperatorApplicationRegionParams struct {
	ID       int64 `json:"id"`
	RegionID int64 `json:"region_id"`
}

// 更新申请的区域（仅草稿状态可修改）
func (q *Queries) UpdateOperatorApplicationRegion(ctx context.Context, arg UpdateOperatorApplicationRegionParams) (OperatorApplication, error) {
	row := q.db.QueryRow(ctx, updateOperatorApplicationRegion, arg.ID, arg.RegionID)
	var i OperatorApplication
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.RegionID,
		&i.Name,
		&i.ContactName,
		&i.ContactPhone,
		&i.BusinessLicenseUrl,
		&i.BusinessLicenseNumber,
		&i.BusinessLicenseOcr,
		&i.LegalPersonName,
		&i.LegalPersonIDNumber,
		&i.IDCardFrontUrl,
		&i.IDCardBackUrl,
		&i.IDCardFrontOcr,
		&i.IDCardBackOcr,
		&i.RequestedContractYears,
		&i.Status,
		&i.RejectReason,
		&i.ReviewedBy,
		&i.ReviewedAt,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.SubmittedAt,
	)
	return i, err
}
