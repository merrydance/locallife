// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: weather_coefficient.sql

package db

import (
	"context"
	"time"

	"github.com/jackc/pgx/v5/pgtype"
)

const createWeatherCoefficient = `-- name: CreateWeatherCoefficient :one
INSERT INTO weather_coefficients (
  region_id,
  recorded_at,
  weather_data,
  warning_data,
  weather_type,
  weather_code,
  temperature,
  feels_like,
  humidity,
  wind_speed,
  wind_scale,
  precip,
  visibility,
  has_warning,
  warning_type,
  warning_level,
  warning_severity,
  warning_text,
  weather_coefficient,
  warning_coefficient,
  final_coefficient,
  delivery_suspended,
  suspend_reason
) VALUES (
  $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23
) RETURNING id, region_id, recorded_at, weather_data, warning_data, weather_type, weather_code, temperature, feels_like, humidity, wind_speed, wind_scale, precip, visibility, has_warning, warning_type, warning_level, warning_severity, warning_text, weather_coefficient, warning_coefficient, final_coefficient, delivery_suspended, suspend_reason, created_at
`

type CreateWeatherCoefficientParams struct {
	RegionID           int64          `json:"region_id"`
	RecordedAt         time.Time      `json:"recorded_at"`
	WeatherData        []byte         `json:"weather_data"`
	WarningData        []byte         `json:"warning_data"`
	WeatherType        string         `json:"weather_type"`
	WeatherCode        pgtype.Text    `json:"weather_code"`
	Temperature        pgtype.Int2    `json:"temperature"`
	FeelsLike          pgtype.Int2    `json:"feels_like"`
	Humidity           pgtype.Int2    `json:"humidity"`
	WindSpeed          pgtype.Int2    `json:"wind_speed"`
	WindScale          pgtype.Text    `json:"wind_scale"`
	Precip             pgtype.Numeric `json:"precip"`
	Visibility         pgtype.Int2    `json:"visibility"`
	HasWarning         bool           `json:"has_warning"`
	WarningType        pgtype.Text    `json:"warning_type"`
	WarningLevel       pgtype.Text    `json:"warning_level"`
	WarningSeverity    pgtype.Text    `json:"warning_severity"`
	WarningText        pgtype.Text    `json:"warning_text"`
	WeatherCoefficient pgtype.Numeric `json:"weather_coefficient"`
	WarningCoefficient pgtype.Numeric `json:"warning_coefficient"`
	FinalCoefficient   pgtype.Numeric `json:"final_coefficient"`
	DeliverySuspended  bool           `json:"delivery_suspended"`
	SuspendReason      pgtype.Text    `json:"suspend_reason"`
}

func (q *Queries) CreateWeatherCoefficient(ctx context.Context, arg CreateWeatherCoefficientParams) (WeatherCoefficient, error) {
	row := q.db.QueryRow(ctx, createWeatherCoefficient,
		arg.RegionID,
		arg.RecordedAt,
		arg.WeatherData,
		arg.WarningData,
		arg.WeatherType,
		arg.WeatherCode,
		arg.Temperature,
		arg.FeelsLike,
		arg.Humidity,
		arg.WindSpeed,
		arg.WindScale,
		arg.Precip,
		arg.Visibility,
		arg.HasWarning,
		arg.WarningType,
		arg.WarningLevel,
		arg.WarningSeverity,
		arg.WarningText,
		arg.WeatherCoefficient,
		arg.WarningCoefficient,
		arg.FinalCoefficient,
		arg.DeliverySuspended,
		arg.SuspendReason,
	)
	var i WeatherCoefficient
	err := row.Scan(
		&i.ID,
		&i.RegionID,
		&i.RecordedAt,
		&i.WeatherData,
		&i.WarningData,
		&i.WeatherType,
		&i.WeatherCode,
		&i.Temperature,
		&i.FeelsLike,
		&i.Humidity,
		&i.WindSpeed,
		&i.WindScale,
		&i.Precip,
		&i.Visibility,
		&i.HasWarning,
		&i.WarningType,
		&i.WarningLevel,
		&i.WarningSeverity,
		&i.WarningText,
		&i.WeatherCoefficient,
		&i.WarningCoefficient,
		&i.FinalCoefficient,
		&i.DeliverySuspended,
		&i.SuspendReason,
		&i.CreatedAt,
	)
	return i, err
}

const deleteOldWeatherCoefficients = `-- name: DeleteOldWeatherCoefficients :exec
DELETE FROM weather_coefficients
WHERE recorded_at < $1
`

func (q *Queries) DeleteOldWeatherCoefficients(ctx context.Context, recordedAt time.Time) error {
	_, err := q.db.Exec(ctx, deleteOldWeatherCoefficients, recordedAt)
	return err
}

const getLatestWeatherCoefficient = `-- name: GetLatestWeatherCoefficient :one
SELECT id, region_id, recorded_at, weather_data, warning_data, weather_type, weather_code, temperature, feels_like, humidity, wind_speed, wind_scale, precip, visibility, has_warning, warning_type, warning_level, warning_severity, warning_text, weather_coefficient, warning_coefficient, final_coefficient, delivery_suspended, suspend_reason, created_at FROM weather_coefficients
WHERE region_id = $1
ORDER BY recorded_at DESC
LIMIT 1
`

func (q *Queries) GetLatestWeatherCoefficient(ctx context.Context, regionID int64) (WeatherCoefficient, error) {
	row := q.db.QueryRow(ctx, getLatestWeatherCoefficient, regionID)
	var i WeatherCoefficient
	err := row.Scan(
		&i.ID,
		&i.RegionID,
		&i.RecordedAt,
		&i.WeatherData,
		&i.WarningData,
		&i.WeatherType,
		&i.WeatherCode,
		&i.Temperature,
		&i.FeelsLike,
		&i.Humidity,
		&i.WindSpeed,
		&i.WindScale,
		&i.Precip,
		&i.Visibility,
		&i.HasWarning,
		&i.WarningType,
		&i.WarningLevel,
		&i.WarningSeverity,
		&i.WarningText,
		&i.WeatherCoefficient,
		&i.WarningCoefficient,
		&i.FinalCoefficient,
		&i.DeliverySuspended,
		&i.SuspendReason,
		&i.CreatedAt,
	)
	return i, err
}

const getWeatherCoefficient = `-- name: GetWeatherCoefficient :one
SELECT id, region_id, recorded_at, weather_data, warning_data, weather_type, weather_code, temperature, feels_like, humidity, wind_speed, wind_scale, precip, visibility, has_warning, warning_type, warning_level, warning_severity, warning_text, weather_coefficient, warning_coefficient, final_coefficient, delivery_suspended, suspend_reason, created_at FROM weather_coefficients
WHERE id = $1 LIMIT 1
`

func (q *Queries) GetWeatherCoefficient(ctx context.Context, id int64) (WeatherCoefficient, error) {
	row := q.db.QueryRow(ctx, getWeatherCoefficient, id)
	var i WeatherCoefficient
	err := row.Scan(
		&i.ID,
		&i.RegionID,
		&i.RecordedAt,
		&i.WeatherData,
		&i.WarningData,
		&i.WeatherType,
		&i.WeatherCode,
		&i.Temperature,
		&i.FeelsLike,
		&i.Humidity,
		&i.WindSpeed,
		&i.WindScale,
		&i.Precip,
		&i.Visibility,
		&i.HasWarning,
		&i.WarningType,
		&i.WarningLevel,
		&i.WarningSeverity,
		&i.WarningText,
		&i.WeatherCoefficient,
		&i.WarningCoefficient,
		&i.FinalCoefficient,
		&i.DeliverySuspended,
		&i.SuspendReason,
		&i.CreatedAt,
	)
	return i, err
}

const listRecentWeatherCoefficients = `-- name: ListRecentWeatherCoefficients :many
SELECT id, region_id, recorded_at, weather_data, warning_data, weather_type, weather_code, temperature, feels_like, humidity, wind_speed, wind_scale, precip, visibility, has_warning, warning_type, warning_level, warning_severity, warning_text, weather_coefficient, warning_coefficient, final_coefficient, delivery_suspended, suspend_reason, created_at FROM weather_coefficients
WHERE region_id = $1 AND recorded_at >= $2
ORDER BY recorded_at DESC
`

type ListRecentWeatherCoefficientsParams struct {
	RegionID   int64     `json:"region_id"`
	RecordedAt time.Time `json:"recorded_at"`
}

func (q *Queries) ListRecentWeatherCoefficients(ctx context.Context, arg ListRecentWeatherCoefficientsParams) ([]WeatherCoefficient, error) {
	rows, err := q.db.Query(ctx, listRecentWeatherCoefficients, arg.RegionID, arg.RecordedAt)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []WeatherCoefficient{}
	for rows.Next() {
		var i WeatherCoefficient
		if err := rows.Scan(
			&i.ID,
			&i.RegionID,
			&i.RecordedAt,
			&i.WeatherData,
			&i.WarningData,
			&i.WeatherType,
			&i.WeatherCode,
			&i.Temperature,
			&i.FeelsLike,
			&i.Humidity,
			&i.WindSpeed,
			&i.WindScale,
			&i.Precip,
			&i.Visibility,
			&i.HasWarning,
			&i.WarningType,
			&i.WarningLevel,
			&i.WarningSeverity,
			&i.WarningText,
			&i.WeatherCoefficient,
			&i.WarningCoefficient,
			&i.FinalCoefficient,
			&i.DeliverySuspended,
			&i.SuspendReason,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listRegionsWithWarning = `-- name: ListRegionsWithWarning :many
SELECT DISTINCT region_id FROM weather_coefficients
WHERE has_warning = true
  AND recorded_at = (
    SELECT MAX(recorded_at) FROM weather_coefficients wc2
    WHERE wc2.region_id = weather_coefficients.region_id
  )
`

func (q *Queries) ListRegionsWithWarning(ctx context.Context) ([]int64, error) {
	rows, err := q.db.Query(ctx, listRegionsWithWarning)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []int64{}
	for rows.Next() {
		var region_id int64
		if err := rows.Scan(&region_id); err != nil {
			return nil, err
		}
		items = append(items, region_id)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listSuspendedRegions = `-- name: ListSuspendedRegions :many
SELECT id, region_id, recorded_at, weather_data, warning_data, weather_type, weather_code, temperature, feels_like, humidity, wind_speed, wind_scale, precip, visibility, has_warning, warning_type, warning_level, warning_severity, warning_text, weather_coefficient, warning_coefficient, final_coefficient, delivery_suspended, suspend_reason, created_at FROM weather_coefficients w1
WHERE delivery_suspended = true
  AND recorded_at = (
    SELECT MAX(recorded_at) FROM weather_coefficients w2
    WHERE w2.region_id = w1.region_id
  )
`

func (q *Queries) ListSuspendedRegions(ctx context.Context) ([]WeatherCoefficient, error) {
	rows, err := q.db.Query(ctx, listSuspendedRegions)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []WeatherCoefficient{}
	for rows.Next() {
		var i WeatherCoefficient
		if err := rows.Scan(
			&i.ID,
			&i.RegionID,
			&i.RecordedAt,
			&i.WeatherData,
			&i.WarningData,
			&i.WeatherType,
			&i.WeatherCode,
			&i.Temperature,
			&i.FeelsLike,
			&i.Humidity,
			&i.WindSpeed,
			&i.WindScale,
			&i.Precip,
			&i.Visibility,
			&i.HasWarning,
			&i.WarningType,
			&i.WarningLevel,
			&i.WarningSeverity,
			&i.WarningText,
			&i.WeatherCoefficient,
			&i.WarningCoefficient,
			&i.FinalCoefficient,
			&i.DeliverySuspended,
			&i.SuspendReason,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listWeatherCoefficients = `-- name: ListWeatherCoefficients :many
SELECT id, region_id, recorded_at, weather_data, warning_data, weather_type, weather_code, temperature, feels_like, humidity, wind_speed, wind_scale, precip, visibility, has_warning, warning_type, warning_level, warning_severity, warning_text, weather_coefficient, warning_coefficient, final_coefficient, delivery_suspended, suspend_reason, created_at FROM weather_coefficients
WHERE region_id = $1
ORDER BY recorded_at DESC
LIMIT $2 OFFSET $3
`

type ListWeatherCoefficientsParams struct {
	RegionID int64 `json:"region_id"`
	Limit    int32 `json:"limit"`
	Offset   int32 `json:"offset"`
}

func (q *Queries) ListWeatherCoefficients(ctx context.Context, arg ListWeatherCoefficientsParams) ([]WeatherCoefficient, error) {
	rows, err := q.db.Query(ctx, listWeatherCoefficients, arg.RegionID, arg.Limit, arg.Offset)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []WeatherCoefficient{}
	for rows.Next() {
		var i WeatherCoefficient
		if err := rows.Scan(
			&i.ID,
			&i.RegionID,
			&i.RecordedAt,
			&i.WeatherData,
			&i.WarningData,
			&i.WeatherType,
			&i.WeatherCode,
			&i.Temperature,
			&i.FeelsLike,
			&i.Humidity,
			&i.WindSpeed,
			&i.WindScale,
			&i.Precip,
			&i.Visibility,
			&i.HasWarning,
			&i.WarningType,
			&i.WarningLevel,
			&i.WarningSeverity,
			&i.WarningText,
			&i.WeatherCoefficient,
			&i.WarningCoefficient,
			&i.FinalCoefficient,
			&i.DeliverySuspended,
			&i.SuspendReason,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}
