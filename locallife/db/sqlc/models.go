// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0

package db

import (
	"time"

	"github.com/jackc/pgx/v5/pgtype"
)

// 申诉表 - 商户/骑手对索赔的申诉
type Appeal struct {
	ID      int64 `json:"id"`
	ClaimID int64 `json:"claim_id"`
	// 申诉人类型：merchant=商户, rider=骑手
	AppellantType string `json:"appellant_type"`
	// 申诉人ID（商户ID或骑手ID）
	AppellantID  int64              `json:"appellant_id"`
	Reason       string             `json:"reason"`
	EvidenceUrls []string           `json:"evidence_urls"`
	Status       string             `json:"status"`
	ReviewerID   pgtype.Int8        `json:"reviewer_id"`
	ReviewNotes  pgtype.Text        `json:"review_notes"`
	ReviewedAt   pgtype.Timestamptz `json:"reviewed_at"`
	// 补偿金额（申诉成功时平台垫付给申诉人）
	CompensationAmount pgtype.Int8        `json:"compensation_amount"`
	CompensatedAt      pgtype.Timestamptz `json:"compensated_at"`
	// 关联区域（用于运营商按区域过滤）
	RegionID  int64     `json:"region_id"`
	CreatedAt time.Time `json:"created_at"`
}

// 用户浏览历史
type BrowseHistory struct {
	ID     int64 `json:"id"`
	UserID int64 `json:"user_id"`
	// 浏览目标类型: merchant(商户), dish(菜品)
	TargetType   string    `json:"target_type"`
	TargetID     int64     `json:"target_id"`
	LastViewedAt time.Time `json:"last_viewed_at"`
	// 浏览次数
	ViewCount int32 `json:"view_count"`
}

// 购物车主表，每个用户每个商户一个购物车
type Cart struct {
	ID int64 `json:"id"`
	// 用户ID
	UserID int64 `json:"user_id"`
	// 商户ID
	MerchantID int64     `json:"merchant_id"`
	UpdatedAt  time.Time `json:"updated_at"`
	CreatedAt  time.Time `json:"created_at"`
}

// 购物车商品表
type CartItem struct {
	ID int64 `json:"id"`
	// 购物车ID
	CartID int64 `json:"cart_id"`
	// 菜品ID，与combo_id二选一
	DishID pgtype.Int8 `json:"dish_id"`
	// 套餐ID，与dish_id二选一
	ComboID pgtype.Int8 `json:"combo_id"`
	// 数量
	Quantity int16 `json:"quantity"`
	// 定制选项，如 [{"name":"辣度","value":"微辣","extra_price":0}]
	Customizations []byte    `json:"customizations"`
	CreatedAt      time.Time `json:"created_at"`
	UpdatedAt      time.Time `json:"updated_at"`
}

// 索赔记录表 - 信用驱动免证索赔
type Claim struct {
	ID             int64       `json:"id"`
	OrderID        int64       `json:"order_id"`
	UserID         int64       `json:"user_id"`
	ClaimType      string      `json:"claim_type"`
	Description    string      `json:"description"`
	EvidenceUrls   []string    `json:"evidence_urls"`
	ClaimAmount    int64       `json:"claim_amount"`
	ApprovedAmount pgtype.Int8 `json:"approved_amount"`
	Status         string      `json:"status"`
	// instant=秒赔(>=750分+<=50元), auto=回溯通过, manual=人工审核
	ApprovalType pgtype.Text `json:"approval_type"`
	// 用户提交索赔时的信用分快照（决策依据）
	TrustScoreSnapshot pgtype.Int2 `json:"trust_score_snapshot"`
	IsMalicious        bool        `json:"is_malicious"`
	// 回溯检查：最近5笔订单（30天→90天→1年）的索赔历史
	LookbackResult     []byte             `json:"lookback_result"`
	AutoApprovalReason pgtype.Text        `json:"auto_approval_reason"`
	RejectionReason    pgtype.Text        `json:"rejection_reason"`
	ReviewerID         pgtype.Int8        `json:"reviewer_id"`
	ReviewNotes        pgtype.Text        `json:"review_notes"`
	CreatedAt          time.Time          `json:"created_at"`
	ReviewedAt         pgtype.Timestamptz `json:"reviewed_at"`
	PaidAt             pgtype.Timestamptz `json:"paid_at"`
}

type CloudPrinter struct {
	ID               int64              `json:"id"`
	MerchantID       int64              `json:"merchant_id"`
	PrinterName      string             `json:"printer_name"`
	PrinterSn        string             `json:"printer_sn"`
	PrinterKey       string             `json:"printer_key"`
	PrinterType      string             `json:"printer_type"`
	PrintTakeout     bool               `json:"print_takeout"`
	PrintDineIn      bool               `json:"print_dine_in"`
	PrintReservation bool               `json:"print_reservation"`
	IsActive         bool               `json:"is_active"`
	CreatedAt        time.Time          `json:"created_at"`
	UpdatedAt        pgtype.Timestamptz `json:"updated_at"`
}

// 合单支付主表，支持多商户一次支付
type CombinedPaymentOrder struct {
	ID     int64 `json:"id"`
	UserID int64 `json:"user_id"`
	// 合单商户订单号，微信合单支付接口使用
	CombineOutTradeNo string `json:"combine_out_trade_no"`
	// 合计支付金额（分），所有子订单之和
	TotalAmount   int64              `json:"total_amount"`
	PrepayID      pgtype.Text        `json:"prepay_id"`
	TransactionID pgtype.Text        `json:"transaction_id"`
	Status        string             `json:"status"`
	PaidAt        pgtype.Timestamptz `json:"paid_at"`
	CreatedAt     time.Time          `json:"created_at"`
	ExpiresAt     pgtype.Timestamptz `json:"expires_at"`
}

// 合单支付子订单表，每个商户一个子单
type CombinedPaymentSubOrder struct {
	ID                int64 `json:"id"`
	CombinedPaymentID int64 `json:"combined_payment_id"`
	OrderID           int64 `json:"order_id"`
	MerchantID        int64 `json:"merchant_id"`
	// 微信子商户号
	SubMchid string `json:"sub_mchid"`
	Amount   int64  `json:"amount"`
	// 子单商户订单号，对应微信的sub_out_trade_no
	OutTradeNo          string    `json:"out_trade_no"`
	Description         string    `json:"description"`
	ProfitSharingStatus string    `json:"profit_sharing_status"`
	CreatedAt           time.Time `json:"created_at"`
}

type ComboDish struct {
	ID       int64 `json:"id"`
	ComboID  int64 `json:"combo_id"`
	DishID   int64 `json:"dish_id"`
	Quantity int16 `json:"quantity"`
}

type ComboSet struct {
	ID            int64              `json:"id"`
	MerchantID    int64              `json:"merchant_id"`
	Name          string             `json:"name"`
	Description   pgtype.Text        `json:"description"`
	ImageUrl      pgtype.Text        `json:"image_url"`
	OriginalPrice int64              `json:"original_price"`
	ComboPrice    int64              `json:"combo_price"`
	IsOnline      bool               `json:"is_online"`
	CreatedAt     time.Time          `json:"created_at"`
	UpdatedAt     pgtype.Timestamptz `json:"updated_at"`
	DeletedAt     pgtype.Timestamptz `json:"deleted_at"`
}

type ComboTag struct {
	ID        int64     `json:"id"`
	ComboID   int64     `json:"combo_id"`
	TagID     int64     `json:"tag_id"`
	CreatedAt time.Time `json:"created_at"`
}

type DailyInventory struct {
	ID            int64              `json:"id"`
	MerchantID    int64              `json:"merchant_id"`
	DishID        int64              `json:"dish_id"`
	Date          pgtype.Date        `json:"date"`
	TotalQuantity int32              `json:"total_quantity"`
	SoldQuantity  int32              `json:"sold_quantity"`
	CreatedAt     time.Time          `json:"created_at"`
	UpdatedAt     pgtype.Timestamptz `json:"updated_at"`
}

// 配送单表
type Delivery struct {
	ID                int64              `json:"id"`
	OrderID           int64              `json:"order_id"`
	RiderID           pgtype.Int8        `json:"rider_id"`
	PickupAddress     string             `json:"pickup_address"`
	PickupLongitude   pgtype.Numeric     `json:"pickup_longitude"`
	PickupLatitude    pgtype.Numeric     `json:"pickup_latitude"`
	PickupContact     pgtype.Text        `json:"pickup_contact"`
	PickupPhone       pgtype.Text        `json:"pickup_phone"`
	PickedAt          pgtype.Timestamptz `json:"picked_at"`
	DeliveryAddress   string             `json:"delivery_address"`
	DeliveryLongitude pgtype.Numeric     `json:"delivery_longitude"`
	DeliveryLatitude  pgtype.Numeric     `json:"delivery_latitude"`
	DeliveryContact   pgtype.Text        `json:"delivery_contact"`
	DeliveryPhone     pgtype.Text        `json:"delivery_phone"`
	DeliveredAt       pgtype.Timestamptz `json:"delivered_at"`
	// 配送距离（米）
	Distance    int32 `json:"distance"`
	DeliveryFee int64 `json:"delivery_fee"`
	// 骑手配送收益（分）
	RiderEarnings int64 `json:"rider_earnings"`
	// 状态：pending待分配/assigned已分配/picking取餐中/picked已取餐/delivering配送中/delivered已送达/completed已完成/cancelled已取消
	Status              string             `json:"status"`
	EstimatedPickupAt   pgtype.Timestamptz `json:"estimated_pickup_at"`
	EstimatedDeliveryAt pgtype.Timestamptz `json:"estimated_delivery_at"`
	IsDamaged           bool               `json:"is_damaged"`
	IsDelayed           bool               `json:"is_delayed"`
	DamageAmount        int64              `json:"damage_amount"`
	DamageReason        pgtype.Text        `json:"damage_reason"`
	CreatedAt           time.Time          `json:"created_at"`
	AssignedAt          pgtype.Timestamptz `json:"assigned_at"`
	CompletedAt         pgtype.Timestamptz `json:"completed_at"`
}

// 运费配置表，按区县配置基础运费规则
type DeliveryFeeConfig struct {
	ID int64 `json:"id"`
	// 区县级别的region_id
	RegionID int64 `json:"region_id"`
	// 基础运费（分）
	BaseFee int64 `json:"base_fee"`
	// 基础距离（米），在此范围内收取基础运费
	BaseDistance int32 `json:"base_distance"`
	// 超出基础距离后每公里加价（分）
	ExtraFeePerKm int64 `json:"extra_fee_per_km"`
	// 货值系数，如0.01表示1%
	ValueRatio pgtype.Numeric `json:"value_ratio"`
	// 最高运费上限（分），NULL表示不限
	MaxFee pgtype.Int8 `json:"max_fee"`
	// 最低运费（分）
	MinFee    int64              `json:"min_fee"`
	IsActive  bool               `json:"is_active"`
	CreatedAt time.Time          `json:"created_at"`
	UpdatedAt pgtype.Timestamptz `json:"updated_at"`
}

// 可接单订单池
type DeliveryPool struct {
	ID                int64          `json:"id"`
	OrderID           int64          `json:"order_id"`
	MerchantID        int64          `json:"merchant_id"`
	PickupLongitude   pgtype.Numeric `json:"pickup_longitude"`
	PickupLatitude    pgtype.Numeric `json:"pickup_latitude"`
	DeliveryLongitude pgtype.Numeric `json:"delivery_longitude"`
	DeliveryLatitude  pgtype.Numeric `json:"delivery_latitude"`
	// 配送距离（米）
	Distance         int32     `json:"distance"`
	DeliveryFee      int64     `json:"delivery_fee"`
	ExpectedPickupAt time.Time `json:"expected_pickup_at"`
	ExpiresAt        time.Time `json:"expires_at"`
	Priority         int32     `json:"priority"`
	CreatedAt        time.Time `json:"created_at"`
}

// M10: 满减规则表
type DiscountRule struct {
	ID                     int64              `json:"id"`
	MerchantID             int64              `json:"merchant_id"`
	Name                   string             `json:"name"`
	Description            pgtype.Text        `json:"description"`
	MinOrderAmount         int64              `json:"min_order_amount"`
	DiscountAmount         int64              `json:"discount_amount"`
	CanStackWithVoucher    bool               `json:"can_stack_with_voucher"`
	CanStackWithMembership bool               `json:"can_stack_with_membership"`
	ValidFrom              time.Time          `json:"valid_from"`
	ValidUntil             time.Time          `json:"valid_until"`
	IsActive               bool               `json:"is_active"`
	CreatedAt              time.Time          `json:"created_at"`
	UpdatedAt              pgtype.Timestamptz `json:"updated_at"`
	DeletedAt              pgtype.Timestamptz `json:"deleted_at"`
}

type Dish struct {
	ID          int64              `json:"id"`
	MerchantID  int64              `json:"merchant_id"`
	CategoryID  pgtype.Int8        `json:"category_id"`
	Name        string             `json:"name"`
	Description pgtype.Text        `json:"description"`
	ImageUrl    pgtype.Text        `json:"image_url"`
	Price       int64              `json:"price"`
	MemberPrice pgtype.Int8        `json:"member_price"`
	IsAvailable bool               `json:"is_available"`
	IsOnline    bool               `json:"is_online"`
	SortOrder   int16              `json:"sort_order"`
	CreatedAt   time.Time          `json:"created_at"`
	UpdatedAt   pgtype.Timestamptz `json:"updated_at"`
	// 预估制作时间（分钟），默认10分钟
	PrepareTime int16              `json:"prepare_time"`
	DeletedAt   pgtype.Timestamptz `json:"deleted_at"`
}

type DishCategory struct {
	ID        int64              `json:"id"`
	Name      string             `json:"name"`
	CreatedAt time.Time          `json:"created_at"`
	DeletedAt pgtype.Timestamptz `json:"deleted_at"`
}

type DishCustomizationGroup struct {
	ID         int64     `json:"id"`
	DishID     int64     `json:"dish_id"`
	Name       string    `json:"name"`
	IsRequired bool      `json:"is_required"`
	SortOrder  int16     `json:"sort_order"`
	CreatedAt  time.Time `json:"created_at"`
}

type DishCustomizationOption struct {
	ID         int64 `json:"id"`
	GroupID    int64 `json:"group_id"`
	TagID      int64 `json:"tag_id"`
	ExtraPrice int64 `json:"extra_price"`
	SortOrder  int16 `json:"sort_order"`
}

type DishIngredient struct {
	ID           int64     `json:"id"`
	DishID       int64     `json:"dish_id"`
	IngredientID int64     `json:"ingredient_id"`
	CreatedAt    time.Time `json:"created_at"`
}

type DishTag struct {
	ID        int64     `json:"id"`
	DishID    int64     `json:"dish_id"`
	TagID     int64     `json:"tag_id"`
	CreatedAt time.Time `json:"created_at"`
}

// 微信平台收付通二级商户进件申请
type EcommerceApplyment struct {
	ID int64 `json:"id"`
	// 主体类型: merchant-商户, rider-骑手, operator-运营商
	SubjectType  string      `json:"subject_type"`
	SubjectID    int64       `json:"subject_id"`
	OutRequestNo string      `json:"out_request_no"`
	ApplymentID  pgtype.Int8 `json:"applyment_id"`
	// 微信主体类型: 2401-小微商户(个人), 2500-个体工商户, 2600-企业
	OrganizationType      string      `json:"organization_type"`
	BusinessLicenseNumber pgtype.Text `json:"business_license_number"`
	BusinessLicenseCopy   pgtype.Text `json:"business_license_copy"`
	MerchantName          string      `json:"merchant_name"`
	LegalPerson           string      `json:"legal_person"`
	IDCardNumber          string      `json:"id_card_number"`
	IDCardName            string      `json:"id_card_name"`
	IDCardValidTime       string      `json:"id_card_valid_time"`
	IDCardFrontCopy       string      `json:"id_card_front_copy"`
	IDCardBackCopy        string      `json:"id_card_back_copy"`
	AccountType           string      `json:"account_type"`
	AccountBank           string      `json:"account_bank"`
	BankAddressCode       string      `json:"bank_address_code"`
	BankName              pgtype.Text `json:"bank_name"`
	AccountNumber         string      `json:"account_number"`
	AccountName           string      `json:"account_name"`
	ContactName           string      `json:"contact_name"`
	ContactIDCardNumber   pgtype.Text `json:"contact_id_card_number"`
	MobilePhone           string      `json:"mobile_phone"`
	ContactEmail          pgtype.Text `json:"contact_email"`
	MerchantShortname     string      `json:"merchant_shortname"`
	Qualifications        []byte      `json:"qualifications"`
	BusinessAdditionPics  []string    `json:"business_addition_pics"`
	BusinessAdditionDesc  pgtype.Text `json:"business_addition_desc"`
	// 进件状态: pending-待提交, submitted-已提交, auditing-审核中, rejected-已驳回, frozen-冻结, to_be_signed-待签约, signing-签约中, rejected_sign-签约失败, finish-完成
	Status       string             `json:"status"`
	SignUrl      pgtype.Text        `json:"sign_url"`
	SignState    pgtype.Text        `json:"sign_state"`
	RejectReason pgtype.Text        `json:"reject_reason"`
	SubMchID     pgtype.Text        `json:"sub_mch_id"`
	CreatedAt    time.Time          `json:"created_at"`
	SubmittedAt  pgtype.Timestamptz `json:"submitted_at"`
	AuditedAt    pgtype.Timestamptz `json:"audited_at"`
	UpdatedAt    time.Time          `json:"updated_at"`
}

// 用户收藏表
type Favorite struct {
	ID int64 `json:"id"`
	// 用户ID
	UserID int64 `json:"user_id"`
	// 收藏类型：merchant=商户, dish=菜品
	FavoriteType string `json:"favorite_type"`
	// 收藏的商户ID
	MerchantID pgtype.Int8 `json:"merchant_id"`
	// 收藏的菜品ID
	DishID    pgtype.Int8 `json:"dish_id"`
	CreatedAt time.Time   `json:"created_at"`
}

// 食品安全事件表 - 唯一需要证据的场景
type FoodSafetyIncident struct {
	ID           int64  `json:"id"`
	OrderID      int64  `json:"order_id"`
	MerchantID   int64  `json:"merchant_id"`
	UserID       int64  `json:"user_id"`
	IncidentType string `json:"incident_type"`
	Description  string `json:"description"`
	// 食安必须有证据（照片、描述）
	EvidenceUrls []string `json:"evidence_urls"`
	// 订单完整快照（所有字段）用于事故溯源
	OrderSnapshot []byte `json:"order_snapshot"`
	// 商户快照（菜单、当班员工）
	MerchantSnapshot []byte `json:"merchant_snapshot"`
	// 骑手快照（配送路线、时间）
	RiderSnapshot []byte `json:"rider_snapshot"`
	// merchant-suspended: 商户已熔断，需整改和人工审核
	Status              string             `json:"status"`
	InvestigationReport pgtype.Text        `json:"investigation_report"`
	Resolution          pgtype.Text        `json:"resolution"`
	CreatedAt           time.Time          `json:"created_at"`
	ResolvedAt          pgtype.Timestamptz `json:"resolved_at"`
}

// 欺诈模式检测表 - 纯规则引擎（设备指纹+地址聚类+协同索赔）
type FraudPattern struct {
	ID int64 `json:"id"`
	// device-reuse: 同设备多账号, address-cluster: 同地址多账号, coordinated-claims: 协同索赔
	PatternType        string      `json:"pattern_type"`
	RelatedUserIds     []int64     `json:"related_user_ids"`
	RelatedOrderIds    []int64     `json:"related_order_ids"`
	RelatedClaimIds    []int64     `json:"related_claim_ids"`
	DeviceFingerprints []string    `json:"device_fingerprints"`
	AddressIds         []int64     `json:"address_ids"`
	IpAddresses        []string    `json:"ip_addresses"`
	PatternDescription pgtype.Text `json:"pattern_description"`
	// 匹配规则数量（同设备+同地址=2），>=2确认为欺诈
	MatchCount int16 `json:"match_count"`
	// 确认后拉黑用户，平台返还商户/骑手损失
	IsConfirmed bool               `json:"is_confirmed"`
	ReviewerID  pgtype.Int8        `json:"reviewer_id"`
	ReviewNotes pgtype.Text        `json:"review_notes"`
	ActionTaken pgtype.Text        `json:"action_taken"`
	DetectedAt  time.Time          `json:"detected_at"`
	ReviewedAt  pgtype.Timestamptz `json:"reviewed_at"`
	ConfirmedAt pgtype.Timestamptz `json:"confirmed_at"`
}

type Ingredient struct {
	ID         int64       `json:"id"`
	Name       string      `json:"name"`
	IsSystem   bool        `json:"is_system"`
	Category   pgtype.Text `json:"category"`
	IsAllergen bool        `json:"is_allergen"`
	CreatedBy  pgtype.Int8 `json:"created_by"`
	CreatedAt  time.Time   `json:"created_at"`
}

// M10: 会员交易流水表
type MembershipTransaction struct {
	ID             int64       `json:"id"`
	MembershipID   int64       `json:"membership_id"`
	Type           string      `json:"type"`
	Amount         int64       `json:"amount"`
	BalanceAfter   int64       `json:"balance_after"`
	RelatedOrderID pgtype.Int8 `json:"related_order_id"`
	RechargeRuleID pgtype.Int8 `json:"recharge_rule_id"`
	Notes          pgtype.Text `json:"notes"`
	CreatedAt      time.Time   `json:"created_at"`
}

type Merchant struct {
	ID          int64          `json:"id"`
	OwnerUserID int64          `json:"owner_user_id"`
	Name        string         `json:"name"`
	Description pgtype.Text    `json:"description"`
	LogoUrl     pgtype.Text    `json:"logo_url"`
	Phone       string         `json:"phone"`
	Address     string         `json:"address"`
	Latitude    pgtype.Numeric `json:"latitude"`
	Longitude   pgtype.Numeric `json:"longitude"`
	// pending, approved, rejected, suspended
	Status string `json:"status"`
	// JSON存储原始申请数据（营业执照信息等）
	ApplicationData []byte    `json:"application_data"`
	CreatedAt       time.Time `json:"created_at"`
	UpdatedAt       time.Time `json:"updated_at"`
	// Optimistic locking version for concurrent updates
	Version int32 `json:"version"`
	// 商户所属区域ID，必填，用于多租户隔离和运营商管理
	RegionID int64 `json:"region_id"`
	// 商户营业状态: true=营业中, false=已打烊
	IsOpen bool `json:"is_open"`
	// 自动打烊时间（可选）
	AutoCloseAt pgtype.Timestamptz `json:"auto_close_at"`
	DeletedAt   pgtype.Timestamptz `json:"deleted_at"`
}

type MerchantApplication struct {
	ID                      int64       `json:"id"`
	UserID                  int64       `json:"user_id"`
	MerchantName            string      `json:"merchant_name"`
	BusinessLicenseNumber   string      `json:"business_license_number"`
	BusinessLicenseImageUrl string      `json:"business_license_image_url"`
	LegalPersonName         string      `json:"legal_person_name"`
	LegalPersonIDNumber     string      `json:"legal_person_id_number"`
	LegalPersonIDFrontUrl   string      `json:"legal_person_id_front_url"`
	LegalPersonIDBackUrl    string      `json:"legal_person_id_back_url"`
	ContactPhone            string      `json:"contact_phone"`
	BusinessAddress         string      `json:"business_address"`
	BusinessScope           pgtype.Text `json:"business_scope"`
	// draft=草稿, submitted=已提交(待审核), approved=已通过, rejected=已拒绝
	Status       string             `json:"status"`
	RejectReason pgtype.Text        `json:"reject_reason"`
	ReviewedBy   pgtype.Int8        `json:"reviewed_by"`
	ReviewedAt   pgtype.Timestamptz `json:"reviewed_at"`
	CreatedAt    time.Time          `json:"created_at"`
	UpdatedAt    time.Time          `json:"updated_at"`
	// 商户位置经度，由前端地图选点提供
	Longitude pgtype.Numeric `json:"longitude"`
	// 商户位置纬度，由前端地图选点提供
	Latitude pgtype.Numeric `json:"latitude"`
	// 区域ID，根据商户定位自动确定
	RegionID pgtype.Int8 `json:"region_id"`
	// 食品经营许可证图片URL
	FoodPermitUrl pgtype.Text `json:"food_permit_url"`
	// 食品经营许可证OCR识别结果JSON
	FoodPermitOcr []byte `json:"food_permit_ocr"`
	// 营业执照OCR识别结果JSON
	BusinessLicenseOcr []byte `json:"business_license_ocr"`
	// 身份证正面OCR识别结果JSON
	IDCardFrontOcr []byte `json:"id_card_front_ocr"`
	// 身份证背面OCR识别结果JSON
	IDCardBackOcr []byte `json:"id_card_back_ocr"`
	// 门头照片URL数组 JSON，最多3张
	StorefrontImages []byte `json:"storefront_images"`
	// 店内环境照片URL数组 JSON，最多5张
	EnvironmentImages []byte `json:"environment_images"`
}

type MerchantBusinessHour struct {
	ID         int64 `json:"id"`
	MerchantID int64 `json:"merchant_id"`
	// 0=Sunday, 1=Monday, ..., 6=Saturday
	DayOfWeek int32       `json:"day_of_week"`
	OpenTime  pgtype.Time `json:"open_time"`
	CloseTime pgtype.Time `json:"close_time"`
	IsClosed  bool        `json:"is_closed"`
	// 特殊日期覆盖常规营业时间，如节假日
	SpecialDate pgtype.Date `json:"special_date"`
	CreatedAt   time.Time   `json:"created_at"`
	UpdatedAt   time.Time   `json:"updated_at"`
}

// 商户运费满返促销表，门槛式阶梯取最优
type MerchantDeliveryPromotion struct {
	ID         int64  `json:"id"`
	MerchantID int64  `json:"merchant_id"`
	Name       string `json:"name"`
	// 最低订单金额（分）
	MinOrderAmount int64 `json:"min_order_amount"`
	// 减免金额（分）
	DiscountAmount int64              `json:"discount_amount"`
	ValidFrom      time.Time          `json:"valid_from"`
	ValidUntil     time.Time          `json:"valid_until"`
	IsActive       bool               `json:"is_active"`
	CreatedAt      time.Time          `json:"created_at"`
	UpdatedAt      pgtype.Timestamptz `json:"updated_at"`
}

type MerchantDishCategory struct {
	MerchantID int64     `json:"merchant_id"`
	CategoryID int64     `json:"category_id"`
	SortOrder  int16     `json:"sort_order"`
	CreatedAt  time.Time `json:"created_at"`
}

// M10: 商户会员账户表
type MerchantMembership struct {
	ID             int64              `json:"id"`
	MerchantID     int64              `json:"merchant_id"`
	UserID         int64              `json:"user_id"`
	Balance        int64              `json:"balance"`
	TotalRecharged int64              `json:"total_recharged"`
	TotalConsumed  int64              `json:"total_consumed"`
	CreatedAt      time.Time          `json:"created_at"`
	UpdatedAt      pgtype.Timestamptz `json:"updated_at"`
}

// 商户会员使用场景配置
type MerchantMembershipSetting struct {
	ID         int64 `json:"id"`
	MerchantID int64 `json:"merchant_id"`
	// 余额可用场景: dine_in(堂食), takeout(外卖), reservation(预定)
	BalanceUsableScenes []string `json:"balance_usable_scenes"`
	// 赠送金额可用场景，可比余额更严格
	BonusUsableScenes []string `json:"bonus_usable_scenes"`
	// 是否允许与优惠券叠加
	AllowWithVoucher bool `json:"allow_with_voucher"`
	// 是否允许与满减叠加
	AllowWithDiscount bool `json:"allow_with_discount"`
	// 单笔最大抵扣比例(1-100)
	MaxDeductionPercent int32              `json:"max_deduction_percent"`
	CreatedAt           time.Time          `json:"created_at"`
	UpdatedAt           pgtype.Timestamptz `json:"updated_at"`
}

// 商户微信支付配置（平台收付通）
type MerchantPaymentConfig struct {
	ID         int64 `json:"id"`
	MerchantID int64 `json:"merchant_id"`
	// 微信平台收付通二级商户号
	SubMchID string `json:"sub_mch_id"`
	// 配置状态：active-启用, suspended-暂停
	Status    string    `json:"status"`
	CreatedAt time.Time `json:"created_at"`
	UpdatedAt time.Time `json:"updated_at"`
}

// 商户信任画像表 - 信用分驱动食安熔断
type MerchantProfile struct {
	ID         int64 `json:"id"`
	MerchantID int64 `json:"merchant_id"`
	// 商户信任分，400以下停业整顿
	TrustScore      int16 `json:"trust_score"`
	TotalOrders     int32 `json:"total_orders"`
	TotalSales      int64 `json:"total_sales"`
	CompletedOrders int32 `json:"completed_orders"`
	TotalClaims     int32 `json:"total_claims"`
	// 异物索赔：一周3次触发限流
	ForeignObjectClaims int32 `json:"foreign_object_claims"`
	// 食安事件：需整改和人工审核
	FoodSafetyIncidents int32 `json:"food_safety_incidents"`
	TimeoutCount        int32 `json:"timeout_count"`
	RefuseOrderCount    int32 `json:"refuse_order_count"`
	Recent7dClaims      int32 `json:"recent_7d_claims"`
	Recent7dIncidents   int32 `json:"recent_7d_incidents"`
	Recent30dClaims     int32 `json:"recent_30d_claims"`
	Recent30dIncidents  int32 `json:"recent_30d_incidents"`
	Recent30dTimeouts   int32 `json:"recent_30d_timeouts"`
	Recent90dClaims     int32 `json:"recent_90d_claims"`
	Recent90dIncidents  int32 `json:"recent_90d_incidents"`
	// 是否已熔断（食安事件/信用分过低）
	IsSuspended   bool               `json:"is_suspended"`
	SuspendReason pgtype.Text        `json:"suspend_reason"`
	SuspendedAt   pgtype.Timestamptz `json:"suspended_at"`
	SuspendUntil  pgtype.Timestamptz `json:"suspend_until"`
	UpdatedAt     time.Time          `json:"updated_at"`
}

type MerchantTag struct {
	MerchantID int64     `json:"merchant_id"`
	TagID      int64     `json:"tag_id"`
	CreatedAt  time.Time `json:"created_at"`
}

// 用户通知表，支持WebSocket实时推送
type Notification struct {
	ID     int64 `json:"id"`
	UserID int64 `json:"user_id"`
	// 通知类型：order/payment/delivery/system/food_safety
	Type    string `json:"type"`
	Title   string `json:"title"`
	Content string `json:"content"`
	// 关联实体类型，用于跳转
	RelatedType pgtype.Text `json:"related_type"`
	RelatedID   pgtype.Int8 `json:"related_id"`
	// 扩展数据JSON，用于前端渲染
	ExtraData []byte             `json:"extra_data"`
	IsRead    bool               `json:"is_read"`
	ReadAt    pgtype.Timestamptz `json:"read_at"`
	// 是否已通过WebSocket推送
	IsPushed  bool               `json:"is_pushed"`
	PushedAt  pgtype.Timestamptz `json:"pushed_at"`
	CreatedAt time.Time          `json:"created_at"`
	// 过期时间，过期后可删除
	ExpiresAt pgtype.Timestamptz `json:"expires_at"`
}

type Operator struct {
	ID     int64 `json:"id"`
	UserID int64 `json:"user_id"`
	// 运营商的主要区域（已废弃UNIQUE约束，现通过operator_regions表管理多区域）
	RegionID       int64              `json:"region_id"`
	Name           string             `json:"name"`
	ContactName    string             `json:"contact_name"`
	ContactPhone   string             `json:"contact_phone"`
	WechatMchID    pgtype.Text        `json:"wechat_mch_id"`
	CommissionRate pgtype.Numeric     `json:"commission_rate"`
	Status         string             `json:"status"`
	CreatedAt      time.Time          `json:"created_at"`
	UpdatedAt      pgtype.Timestamptz `json:"updated_at"`
	// 合同开始日期
	ContractStartDate pgtype.Date `json:"contract_start_date"`
	// 合同到期日期
	ContractEndDate pgtype.Date `json:"contract_end_date"`
	// 合同年限（1/2/3年等）
	ContractYears int32 `json:"contract_years"`
	// 微信平台收付通二级商户号（开户成功后返回）
	SubMchID pgtype.Text `json:"sub_mch_id"`
}

// 运营商入驻申请表，支持草稿保存和人工审核
type OperatorApplication struct {
	ID     int64 `json:"id"`
	UserID int64 `json:"user_id"`
	// 申请运营的区县ID，独占（一区一运营商）
	RegionID              int64       `json:"region_id"`
	Name                  pgtype.Text `json:"name"`
	ContactName           pgtype.Text `json:"contact_name"`
	ContactPhone          pgtype.Text `json:"contact_phone"`
	BusinessLicenseUrl    pgtype.Text `json:"business_license_url"`
	BusinessLicenseNumber pgtype.Text `json:"business_license_number"`
	// 营业执照OCR识别结果JSON
	BusinessLicenseOcr  []byte      `json:"business_license_ocr"`
	LegalPersonName     pgtype.Text `json:"legal_person_name"`
	LegalPersonIDNumber pgtype.Text `json:"legal_person_id_number"`
	IDCardFrontUrl      pgtype.Text `json:"id_card_front_url"`
	IDCardBackUrl       pgtype.Text `json:"id_card_back_url"`
	// 身份证正面OCR识别结果JSON
	IDCardFrontOcr []byte `json:"id_card_front_ocr"`
	// 身份证背面OCR识别结果JSON
	IDCardBackOcr          []byte `json:"id_card_back_ocr"`
	RequestedContractYears int32  `json:"requested_contract_years"`
	// draft=草稿, submitted=已提交待审核, approved=已通过, rejected=已拒绝
	Status       string             `json:"status"`
	RejectReason pgtype.Text        `json:"reject_reason"`
	ReviewedBy   pgtype.Int8        `json:"reviewed_by"`
	ReviewedAt   pgtype.Timestamptz `json:"reviewed_at"`
	CreatedAt    time.Time          `json:"created_at"`
	UpdatedAt    time.Time          `json:"updated_at"`
	SubmittedAt  pgtype.Timestamptz `json:"submitted_at"`
}

// 运营商管理的区域列表，支持一个运营商管理多个区县
type OperatorRegion struct {
	ID         int64     `json:"id"`
	OperatorID int64     `json:"operator_id"`
	RegionID   int64     `json:"region_id"`
	Status     string    `json:"status"`
	CreatedAt  time.Time `json:"created_at"`
}

type Order struct {
	ID                  int64              `json:"id"`
	OrderNo             string             `json:"order_no"`
	UserID              int64              `json:"user_id"`
	MerchantID          int64              `json:"merchant_id"`
	OrderType           string             `json:"order_type"`
	AddressID           pgtype.Int8        `json:"address_id"`
	DeliveryFee         int64              `json:"delivery_fee"`
	DeliveryDistance    pgtype.Int4        `json:"delivery_distance"`
	TableID             pgtype.Int8        `json:"table_id"`
	ReservationID       pgtype.Int8        `json:"reservation_id"`
	Subtotal            int64              `json:"subtotal"`
	DiscountAmount      int64              `json:"discount_amount"`
	DeliveryFeeDiscount int64              `json:"delivery_fee_discount"`
	TotalAmount         int64              `json:"total_amount"`
	Status              string             `json:"status"`
	PaymentMethod       pgtype.Text        `json:"payment_method"`
	PaidAt              pgtype.Timestamptz `json:"paid_at"`
	Notes               pgtype.Text        `json:"notes"`
	CreatedAt           time.Time          `json:"created_at"`
	UpdatedAt           pgtype.Timestamptz `json:"updated_at"`
	CompletedAt         pgtype.Timestamptz `json:"completed_at"`
	CancelledAt         pgtype.Timestamptz `json:"cancelled_at"`
	CancelReason        pgtype.Text        `json:"cancel_reason"`
	FinalAmount         pgtype.Int8        `json:"final_amount"`
	PlatformCommission  pgtype.Int8        `json:"platform_commission"`
	// 使用的用户优惠券ID
	UserVoucherID pgtype.Int8 `json:"user_voucher_id"`
	// 优惠券抵扣金额(分)
	VoucherAmount int64 `json:"voucher_amount"`
	// 会员余额支付金额(分)
	BalancePaid int64 `json:"balance_paid"`
	// 使用的会员卡ID
	MembershipID pgtype.Int8 `json:"membership_id"`
}

type OrderDisplayConfig struct {
	ID               int64              `json:"id"`
	MerchantID       int64              `json:"merchant_id"`
	EnablePrint      bool               `json:"enable_print"`
	PrintTakeout     bool               `json:"print_takeout"`
	PrintDineIn      bool               `json:"print_dine_in"`
	PrintReservation bool               `json:"print_reservation"`
	EnableVoice      bool               `json:"enable_voice"`
	VoiceTakeout     bool               `json:"voice_takeout"`
	VoiceDineIn      bool               `json:"voice_dine_in"`
	EnableKds        bool               `json:"enable_kds"`
	KdsUrl           pgtype.Text        `json:"kds_url"`
	CreatedAt        time.Time          `json:"created_at"`
	UpdatedAt        pgtype.Timestamptz `json:"updated_at"`
}

type OrderItem struct {
	ID             int64       `json:"id"`
	OrderID        int64       `json:"order_id"`
	DishID         pgtype.Int8 `json:"dish_id"`
	ComboID        pgtype.Int8 `json:"combo_id"`
	Name           string      `json:"name"`
	UnitPrice      int64       `json:"unit_price"`
	Quantity       int16       `json:"quantity"`
	Subtotal       int64       `json:"subtotal"`
	Customizations []byte      `json:"customizations"`
	CreatedAt      time.Time   `json:"created_at"`
}

type OrderStatusLog struct {
	ID           int64       `json:"id"`
	OrderID      int64       `json:"order_id"`
	FromStatus   pgtype.Text `json:"from_status"`
	ToStatus     string      `json:"to_status"`
	OperatorID   pgtype.Int8 `json:"operator_id"`
	OperatorType pgtype.Text `json:"operator_type"`
	Notes        pgtype.Text `json:"notes"`
	CreatedAt    time.Time   `json:"created_at"`
}

type PaymentOrder struct {
	ID            int64              `json:"id"`
	OrderID       pgtype.Int8        `json:"order_id"`
	ReservationID pgtype.Int8        `json:"reservation_id"`
	UserID        int64              `json:"user_id"`
	PaymentType   string             `json:"payment_type"`
	BusinessType  string             `json:"business_type"`
	Amount        int64              `json:"amount"`
	OutTradeNo    string             `json:"out_trade_no"`
	TransactionID pgtype.Text        `json:"transaction_id"`
	PrepayID      pgtype.Text        `json:"prepay_id"`
	Status        string             `json:"status"`
	PaidAt        pgtype.Timestamptz `json:"paid_at"`
	CreatedAt     time.Time          `json:"created_at"`
	ExpiresAt     pgtype.Timestamptz `json:"expires_at"`
	Attach        pgtype.Text        `json:"attach"`
	// 关联的合单支付ID，单商户支付时为NULL
	CombinedPaymentID pgtype.Int8 `json:"combined_payment_id"`
}

// 高峰/特殊时段配置表（午高峰、晚高峰、深夜配送等）
type PeakHourConfig struct {
	ID       int64 `json:"id"`
	RegionID int64 `json:"region_id"`
	// 配置名称，如：午高峰、晚高峰、深夜配送
	Name      string      `json:"name"`
	StartTime pgtype.Time `json:"start_time"`
	// 结束时间，可小于start_time表示跨天（如22:00-06:00）
	EndTime pgtype.Time `json:"end_time"`
	// 运费系数，如1.20表示加价20%
	Coefficient pgtype.Numeric `json:"coefficient"`
	// 生效的星期：1=周一...7=周日
	DaysOfWeek []int16            `json:"days_of_week"`
	IsActive   bool               `json:"is_active"`
	CreatedAt  time.Time          `json:"created_at"`
	UpdatedAt  pgtype.Timestamptz `json:"updated_at"`
}

type PrintLog struct {
	ID           int64              `json:"id"`
	OrderID      int64              `json:"order_id"`
	PrinterID    int64              `json:"printer_id"`
	PrintContent string             `json:"print_content"`
	Status       string             `json:"status"`
	ErrorMessage pgtype.Text        `json:"error_message"`
	PrintedAt    pgtype.Timestamptz `json:"printed_at"`
	CreatedAt    time.Time          `json:"created_at"`
}

type ProfitSharingOrder struct {
	ID                 int64              `json:"id"`
	PaymentOrderID     int64              `json:"payment_order_id"`
	MerchantID         int64              `json:"merchant_id"`
	OperatorID         pgtype.Int8        `json:"operator_id"`
	OrderSource        string             `json:"order_source"`
	TotalAmount        int64              `json:"total_amount"`
	PlatformCommission int64              `json:"platform_commission"`
	OperatorCommission int64              `json:"operator_commission"`
	MerchantAmount     int64              `json:"merchant_amount"`
	OutOrderNo         string             `json:"out_order_no"`
	SharingOrderID     pgtype.Text        `json:"sharing_order_id"`
	Status             string             `json:"status"`
	FinishedAt         pgtype.Timestamptz `json:"finished_at"`
	CreatedAt          time.Time          `json:"created_at"`
	// 配送费（分），外卖订单专用
	DeliveryFee int64 `json:"delivery_fee"`
	// 骑手ID，配送订单关联
	RiderID pgtype.Int8 `json:"rider_id"`
	// 骑手分账金额（分），等于配送费
	RiderAmount int64 `json:"rider_amount"`
	// 可分账金额（分）= total_amount - delivery_fee
	DistributableAmount int64 `json:"distributable_amount"`
	// 平台分账比例（百分比），默认2%
	PlatformRate int32 `json:"platform_rate"`
	// 运营商分账比例（百分比），默认3%
	OperatorRate int32 `json:"operator_rate"`
}

// M10: 充值规则表（充100送20等）
type RechargeRule struct {
	ID             int64              `json:"id"`
	MerchantID     int64              `json:"merchant_id"`
	RechargeAmount int64              `json:"recharge_amount"`
	BonusAmount    int64              `json:"bonus_amount"`
	IsActive       bool               `json:"is_active"`
	ValidFrom      time.Time          `json:"valid_from"`
	ValidUntil     time.Time          `json:"valid_until"`
	CreatedAt      time.Time          `json:"created_at"`
	UpdatedAt      pgtype.Timestamptz `json:"updated_at"`
}

// 推荐算法配置
type RecommendConfig struct {
	ID             int64          `json:"id"`
	Name           string         `json:"name"`
	DistanceWeight pgtype.Numeric `json:"distance_weight"`
	RouteWeight    pgtype.Numeric `json:"route_weight"`
	UrgencyWeight  pgtype.Numeric `json:"urgency_weight"`
	ProfitWeight   pgtype.Numeric `json:"profit_weight"`
	// 最大推荐距离（米）
	MaxDistance int32              `json:"max_distance"`
	MaxResults  int32              `json:"max_results"`
	IsActive    bool               `json:"is_active"`
	CreatedAt   time.Time          `json:"created_at"`
	UpdatedAt   pgtype.Timestamptz `json:"updated_at"`
}

// 推荐结果表：缓存生成的推荐结果
type Recommendation struct {
	ID          int64   `json:"id"`
	UserID      int64   `json:"user_id"`
	DishIds     []int64 `json:"dish_ids"`
	ComboIds    []int64 `json:"combo_ids"`
	MerchantIds []int64 `json:"merchant_ids"`
	// 使用的算法：collaborative/content-based/hybrid/ee-algorithm
	Algorithm   string         `json:"algorithm"`
	Score       pgtype.Numeric `json:"score"`
	GeneratedAt time.Time      `json:"generated_at"`
	// 推荐过期时间（通常5分钟后）
	ExpiredAt time.Time `json:"expired_at"`
}

// 推荐配置表：区域级别EE算法配置
type RecommendationConfig struct {
	ID       int64 `json:"id"`
	RegionID int64 `json:"region_id"`
	// 喜好推荐比例 0.00-1.00，默认60%
	ExploitationRatio pgtype.Numeric `json:"exploitation_ratio"`
	// 探索推荐比例 0.00-1.00，默认30%
	ExplorationRatio pgtype.Numeric `json:"exploration_ratio"`
	// 随机推荐比例 0.00-1.00，默认10%
	RandomRatio pgtype.Numeric `json:"random_ratio"`
	// 是否启用自动调整比例（基于成交转化率，M12功能）
	AutoAdjust bool      `json:"auto_adjust"`
	UpdatedAt  time.Time `json:"updated_at"`
}

type RefundOrder struct {
	ID             int64              `json:"id"`
	PaymentOrderID int64              `json:"payment_order_id"`
	RefundType     string             `json:"refund_type"`
	RefundAmount   int64              `json:"refund_amount"`
	RefundReason   pgtype.Text        `json:"refund_reason"`
	OutRefundNo    string             `json:"out_refund_no"`
	RefundID       pgtype.Text        `json:"refund_id"`
	PlatformRefund pgtype.Int8        `json:"platform_refund"`
	OperatorRefund pgtype.Int8        `json:"operator_refund"`
	MerchantRefund pgtype.Int8        `json:"merchant_refund"`
	Status         string             `json:"status"`
	RefundedAt     pgtype.Timestamptz `json:"refunded_at"`
	CreatedAt      time.Time          `json:"created_at"`
}

type Region struct {
	ID int64 `json:"id"`
	// 行政区划代码
	Code string `json:"code"`
	Name string `json:"name"`
	// 1=省 2=市 3=区 4=县
	Level     int16          `json:"level"`
	ParentID  pgtype.Int8    `json:"parent_id"`
	Longitude pgtype.Numeric `json:"longitude"`
	Latitude  pgtype.Numeric `json:"latitude"`
	CreatedAt time.Time      `json:"created_at"`
	// 和风天气城市ID，首次查询后缓存
	QweatherLocationID pgtype.Text `json:"qweather_location_id"`
}

type ReservationItem struct {
	ID            int64       `json:"id"`
	ReservationID int64       `json:"reservation_id"`
	DishID        pgtype.Int8 `json:"dish_id"`
	ComboID       pgtype.Int8 `json:"combo_id"`
	Quantity      int16       `json:"quantity"`
	UnitPrice     int64       `json:"unit_price"`
	TotalPrice    int64       `json:"total_price"`
	CreatedAt     time.Time   `json:"created_at"`
}

// 订单评价表
type Review struct {
	ID int64 `json:"id"`
	// 订单ID，每个订单只能评价一次
	OrderID int64 `json:"order_id"`
	// 评价用户ID
	UserID int64 `json:"user_id"`
	// 商户ID
	MerchantID int64 `json:"merchant_id"`
	// 评价内容
	Content string `json:"content"`
	// 评价图片URLs，PostgreSQL数组类型
	Images []string `json:"images"`
	// 是否可见，低信用用户评价不展示
	IsVisible bool `json:"is_visible"`
	// 商户回复内容
	MerchantReply pgtype.Text `json:"merchant_reply"`
	// 回复时间
	RepliedAt pgtype.Timestamptz `json:"replied_at"`
	CreatedAt time.Time          `json:"created_at"`
}

// 骑手表
type Rider struct {
	ID       int64  `json:"id"`
	UserID   int64  `json:"user_id"`
	RealName string `json:"real_name"`
	IDCardNo string `json:"id_card_no"`
	Phone    string `json:"phone"`
	// 可用押金余额（分）
	DepositAmount int64 `json:"deposit_amount"`
	// 冻结押金（分）
	FrozenDeposit     int64              `json:"frozen_deposit"`
	Status            string             `json:"status"`
	IsOnline          bool               `json:"is_online"`
	CreditScore       int16              `json:"credit_score"`
	CurrentLongitude  pgtype.Numeric     `json:"current_longitude"`
	CurrentLatitude   pgtype.Numeric     `json:"current_latitude"`
	LocationUpdatedAt pgtype.Timestamptz `json:"location_updated_at"`
	TotalOrders       int32              `json:"total_orders"`
	TotalEarnings     int64              `json:"total_earnings"`
	// 累计在线时长（秒）
	OnlineDuration int32              `json:"online_duration"`
	CreatedAt      time.Time          `json:"created_at"`
	UpdatedAt      pgtype.Timestamptz `json:"updated_at"`
	// 骑手所属区域ID，用于多租户隔离，骑手只能接该区域内的订单
	RegionID pgtype.Int8 `json:"region_id"`
	// 关联的入驻申请ID，审核通过后填充
	ApplicationID pgtype.Int8 `json:"application_id"`
	// 微信平台收付通二级商户号
	SubMchID pgtype.Text `json:"sub_mch_id"`
}

// 骑手入驻申请表，支持草稿保存和自动审核
type RiderApplication struct {
	ID             int64       `json:"id"`
	UserID         int64       `json:"user_id"`
	RealName       pgtype.Text `json:"real_name"`
	Phone          pgtype.Text `json:"phone"`
	IDCardFrontUrl pgtype.Text `json:"id_card_front_url"`
	IDCardBackUrl  pgtype.Text `json:"id_card_back_url"`
	// 身份证OCR识别结果JSON
	IDCardOcr     []byte      `json:"id_card_ocr"`
	HealthCertUrl pgtype.Text `json:"health_cert_url"`
	// 健康证OCR识别结果JSON
	HealthCertOcr []byte `json:"health_cert_ocr"`
	// draft=草稿, submitted=已提交待审核, approved=已通过, rejected=已拒绝
	Status       string             `json:"status"`
	RejectReason pgtype.Text        `json:"reject_reason"`
	ReviewedBy   pgtype.Int8        `json:"reviewed_by"`
	ReviewedAt   pgtype.Timestamptz `json:"reviewed_at"`
	CreatedAt    time.Time          `json:"created_at"`
	UpdatedAt    pgtype.Timestamptz `json:"updated_at"`
	SubmittedAt  pgtype.Timestamptz `json:"submitted_at"`
}

// 骑手押金流水
type RiderDeposit struct {
	ID      int64 `json:"id"`
	RiderID int64 `json:"rider_id"`
	Amount  int64 `json:"amount"`
	// 流水类型: deposit=充值, withdraw=提现, freeze=冻结, unfreeze=解冻, deduct=扣款, withdraw_rollback=提现回滚
	Type           string      `json:"type"`
	RelatedOrderID pgtype.Int8 `json:"related_order_id"`
	BalanceAfter   int64       `json:"balance_after"`
	Remark         pgtype.Text `json:"remark"`
	CreatedAt      time.Time   `json:"created_at"`
}

// 骑手位置记录
type RiderLocation struct {
	ID         int64          `json:"id"`
	RiderID    int64          `json:"rider_id"`
	DeliveryID pgtype.Int8    `json:"delivery_id"`
	Longitude  pgtype.Numeric `json:"longitude"`
	Latitude   pgtype.Numeric `json:"latitude"`
	// 定位精度（米）
	Accuracy pgtype.Numeric `json:"accuracy"`
	// 速度 m/s
	Speed pgtype.Numeric `json:"speed"`
	// 方向角度
	Heading    pgtype.Numeric `json:"heading"`
	RecordedAt time.Time      `json:"recorded_at"`
}

// 高值单资格积分变更日志表
type RiderPremiumScoreLog struct {
	ID                int64       `json:"id"`
	RiderID           int64       `json:"rider_id"`
	ChangeAmount      int16       `json:"change_amount"`
	OldScore          int16       `json:"old_score"`
	NewScore          int16       `json:"new_score"`
	ChangeType        string      `json:"change_type"`
	RelatedOrderID    pgtype.Int8 `json:"related_order_id"`
	RelatedDeliveryID pgtype.Int8 `json:"related_delivery_id"`
	Remark            pgtype.Text `json:"remark"`
	CreatedAt         time.Time   `json:"created_at"`
}

// 骑手信任画像表 - 餐损索赔由押金扣除
type RiderProfile struct {
	ID      int64 `json:"id"`
	RiderID int64 `json:"rider_id"`
	// 骑手信任分，350以下暂停接单
	TrustScore          int16 `json:"trust_score"`
	TotalDeliveries     int32 `json:"total_deliveries"`
	CompletedDeliveries int32 `json:"completed_deliveries"`
	OnTimeDeliveries    int32 `json:"on_time_deliveries"`
	DelayedDeliveries   int32 `json:"delayed_deliveries"`
	CancelledDeliveries int32 `json:"cancelled_deliveries"`
	// 餐损事件：一周3次触发扣分
	TotalDamageIncidents int32 `json:"total_damage_incidents"`
	CustomerComplaints   int32 `json:"customer_complaints"`
	TimeoutIncidents     int32 `json:"timeout_incidents"`
	Recent7dDamages      int32 `json:"recent_7d_damages"`
	Recent7dDelays       int32 `json:"recent_7d_delays"`
	Recent30dDamages     int32 `json:"recent_30d_damages"`
	Recent30dDelays      int32 `json:"recent_30d_delays"`
	Recent30dComplaints  int32 `json:"recent_30d_complaints"`
	Recent90dDamages     int32 `json:"recent_90d_damages"`
	Recent90dDelays      int32 `json:"recent_90d_delays"`
	TotalOnlineHours     int32 `json:"total_online_hours"`
	// 是否暂停接单
	IsSuspended   bool               `json:"is_suspended"`
	SuspendReason pgtype.Text        `json:"suspend_reason"`
	SuspendedAt   pgtype.Timestamptz `json:"suspended_at"`
	SuspendUntil  pgtype.Timestamptz `json:"suspend_until"`
	UpdatedAt     time.Time          `json:"updated_at"`
	// 高值单资格积分：普通单+1，高值单-3，超时-5，餐损-10，≥0可接高值单
	PremiumScore int16 `json:"premium_score"`
}

type Session struct {
	ID                    int64     `json:"id"`
	UserID                int64     `json:"user_id"`
	AccessToken           string    `json:"access_token"`
	RefreshToken          string    `json:"refresh_token"`
	AccessTokenExpiresAt  time.Time `json:"access_token_expires_at"`
	RefreshTokenExpiresAt time.Time `json:"refresh_token_expires_at"`
	UserAgent             string    `json:"user_agent"`
	ClientIp              string    `json:"client_ip"`
	IsRevoked             bool      `json:"is_revoked"`
	CreatedAt             time.Time `json:"created_at"`
}

type Table struct {
	ID                   int64              `json:"id"`
	MerchantID           int64              `json:"merchant_id"`
	TableNo              string             `json:"table_no"`
	TableType            string             `json:"table_type"`
	Capacity             int16              `json:"capacity"`
	Description          pgtype.Text        `json:"description"`
	MinimumSpend         pgtype.Int8        `json:"minimum_spend"`
	QrCodeUrl            pgtype.Text        `json:"qr_code_url"`
	Status               string             `json:"status"`
	CurrentReservationID pgtype.Int8        `json:"current_reservation_id"`
	CreatedAt            time.Time          `json:"created_at"`
	UpdatedAt            pgtype.Timestamptz `json:"updated_at"`
}

// 桌台/包间图片表
type TableImage struct {
	ID int64 `json:"id"`
	// 桌台ID
	TableID int64 `json:"table_id"`
	// 图片URL
	ImageUrl string `json:"image_url"`
	// 排序顺序
	SortOrder int32 `json:"sort_order"`
	// 是否为主图
	IsPrimary bool      `json:"is_primary"`
	CreatedAt time.Time `json:"created_at"`
}

type TableReservation struct {
	ID              int64              `json:"id"`
	TableID         int64              `json:"table_id"`
	UserID          int64              `json:"user_id"`
	MerchantID      int64              `json:"merchant_id"`
	ReservationDate pgtype.Date        `json:"reservation_date"`
	ReservationTime pgtype.Time        `json:"reservation_time"`
	GuestCount      int16              `json:"guest_count"`
	ContactName     string             `json:"contact_name"`
	ContactPhone    string             `json:"contact_phone"`
	PaymentMode     string             `json:"payment_mode"`
	DepositAmount   int64              `json:"deposit_amount"`
	PrepaidAmount   int64              `json:"prepaid_amount"`
	RefundDeadline  time.Time          `json:"refund_deadline"`
	Status          string             `json:"status"`
	PaymentDeadline time.Time          `json:"payment_deadline"`
	Notes           pgtype.Text        `json:"notes"`
	PaidAt          pgtype.Timestamptz `json:"paid_at"`
	ConfirmedAt     pgtype.Timestamptz `json:"confirmed_at"`
	CompletedAt     pgtype.Timestamptz `json:"completed_at"`
	CancelledAt     pgtype.Timestamptz `json:"cancelled_at"`
	CancelReason    pgtype.Text        `json:"cancel_reason"`
	CreatedAt       time.Time          `json:"created_at"`
	UpdatedAt       pgtype.Timestamptz `json:"updated_at"`
	// 顾客到店签到时间
	CheckedInAt pgtype.Timestamptz `json:"checked_in_at"`
	// 厨房开始制作时间
	CookingStartedAt pgtype.Timestamptz `json:"cooking_started_at"`
	// 预订来源：online(线上)、phone(电话)、walkin(现场)、merchant(商户代订)
	Source pgtype.Text `json:"source"`
}

type TableTag struct {
	ID        int64     `json:"id"`
	TableID   int64     `json:"table_id"`
	TagID     int64     `json:"tag_id"`
	CreatedAt time.Time `json:"created_at"`
}

type Tag struct {
	ID   int64  `json:"id"`
	Name string `json:"name"`
	// merchant, product, service, etc.
	Type      string    `json:"type"`
	SortOrder int16     `json:"sort_order"`
	Status    string    `json:"status"`
	CreatedAt time.Time `json:"created_at"`
}

// TrustScore变更记录表（审计日志）- 所有信用分变更可追溯
type TrustScoreChange struct {
	ID         int64  `json:"id"`
	EntityType string `json:"entity_type"`
	EntityID   int64  `json:"entity_id"`
	OldScore   int16  `json:"old_score"`
	NewScore   int16  `json:"new_score"`
	// 变化值：负数=扣分，正数=加分（第一版不实现加分）
	ScoreChange int16 `json:"score_change"`
	// 变更原因类型：用于统计分析
	ReasonType        string      `json:"reason_type"`
	ReasonDescription string      `json:"reason_description"`
	RelatedType       pgtype.Text `json:"related_type"`
	RelatedID         pgtype.Int8 `json:"related_id"`
	// 系统自动变更 vs 人工调整
	IsAuto     bool        `json:"is_auto"`
	OperatorID pgtype.Int8 `json:"operator_id"`
	CreatedAt  time.Time   `json:"created_at"`
}

type User struct {
	ID int64 `json:"id"`
	// 微信小程序唯一标识
	WechatOpenid string `json:"wechat_openid"`
	// 微信开放平台unionid
	WechatUnionid pgtype.Text `json:"wechat_unionid"`
	FullName      string      `json:"full_name"`
	// 手机号，可选绑定
	Phone pgtype.Text `json:"phone"`
	// 微信头像URL
	AvatarUrl pgtype.Text `json:"avatar_url"`
	CreatedAt time.Time   `json:"created_at"`
}

type UserAddress struct {
	ID            int64          `json:"id"`
	UserID        int64          `json:"user_id"`
	RegionID      int64          `json:"region_id"`
	DetailAddress string         `json:"detail_address"`
	ContactName   string         `json:"contact_name"`
	ContactPhone  string         `json:"contact_phone"`
	Longitude     pgtype.Numeric `json:"longitude"`
	Latitude      pgtype.Numeric `json:"latitude"`
	IsDefault     bool           `json:"is_default"`
	CreatedAt     time.Time      `json:"created_at"`
}

// 用户余额账户
type UserBalance struct {
	UserID int64 `json:"user_id"`
	// 可用余额（分）
	Balance int64 `json:"balance"`
	// 冻结余额，提现处理中（分）
	FrozenBalance int64     `json:"frozen_balance"`
	TotalIncome   int64     `json:"total_income"`
	TotalExpense  int64     `json:"total_expense"`
	TotalWithdraw int64     `json:"total_withdraw"`
	CreatedAt     time.Time `json:"created_at"`
	UpdatedAt     time.Time `json:"updated_at"`
}

// 用户余额变动日志
type UserBalanceLog struct {
	ID     int64 `json:"id"`
	UserID int64 `json:"user_id"`
	// 变动类型：claim_refund/order_pay/withdraw/recharge/adjustment
	Type          string      `json:"type"`
	Amount        int64       `json:"amount"`
	BalanceBefore int64       `json:"balance_before"`
	BalanceAfter  int64       `json:"balance_after"`
	RelatedType   pgtype.Text `json:"related_type"`
	RelatedID     pgtype.Int8 `json:"related_id"`
	// 资金来源：rider_deposit/merchant_refund/platform
	SourceType pgtype.Text `json:"source_type"`
	SourceID   pgtype.Int8 `json:"source_id"`
	Remark     pgtype.Text `json:"remark"`
	CreatedAt  time.Time   `json:"created_at"`
}

// 用户行为埋点表：浏览、详情、加购、购买
type UserBehavior struct {
	ID     int64 `json:"id"`
	UserID int64 `json:"user_id"`
	// view/detail/cart/purchase - 浏览列表/查看详情/加购/购买
	BehaviorType string      `json:"behavior_type"`
	DishID       pgtype.Int8 `json:"dish_id"`
	ComboID      pgtype.Int8 `json:"combo_id"`
	MerchantID   pgtype.Int8 `json:"merchant_id"`
	// 停留时长(秒)，仅view/detail行为有值
	Duration  pgtype.Int4 `json:"duration"`
	CreatedAt time.Time   `json:"created_at"`
}

// 用户索赔警告状态表，记录用户的索赔行为模式
type UserClaimWarning struct {
	ID     int64 `json:"id"`
	UserID int64 `json:"user_id"`
	// 被警告次数：5单3索赔首次警告+1
	WarningCount      int32              `json:"warning_count"`
	LastWarningAt     pgtype.Timestamptz `json:"last_warning_at"`
	LastWarningReason pgtype.Text        `json:"last_warning_reason"`
	// 是否需要提交证据：被警告后再次索赔时需要
	RequiresEvidence bool `json:"requires_evidence"`
	// 平台垫付次数：问题用户的索赔由平台承担
	PlatformPayCount int32     `json:"platform_pay_count"`
	CreatedAt        time.Time `json:"created_at"`
	UpdatedAt        time.Time `json:"updated_at"`
}

// 用户设备指纹表，用于检测设备复用欺诈
type UserDevice struct {
	ID     int64 `json:"id"`
	UserID int64 `json:"user_id"`
	// 设备指纹，可以是设备IMEI、UUID或浏览器指纹（TEXT类型，遵循PostgreSQL最佳实践）
	DeviceID string `json:"device_id"`
	// 设备类型：ios/android/web等
	DeviceType  string      `json:"device_type"`
	DeviceModel pgtype.Text `json:"device_model"`
	OsVersion   pgtype.Text `json:"os_version"`
	AppVersion  pgtype.Text `json:"app_version"`
	UserAgent   pgtype.Text `json:"user_agent"`
	IpAddress   pgtype.Text `json:"ip_address"`
	LastLoginAt time.Time   `json:"last_login_at"`
	CreatedAt   time.Time   `json:"created_at"`
	FirstSeen   time.Time   `json:"first_seen"`
	LastSeen    time.Time   `json:"last_seen"`
	UpdatedAt   time.Time   `json:"updated_at"`
}

// 用户通知偏好设置
type UserNotificationPreference struct {
	ID                            int64 `json:"id"`
	UserID                        int64 `json:"user_id"`
	EnableOrderNotifications      bool  `json:"enable_order_notifications"`
	EnablePaymentNotifications    bool  `json:"enable_payment_notifications"`
	EnableDeliveryNotifications   bool  `json:"enable_delivery_notifications"`
	EnableSystemNotifications     bool  `json:"enable_system_notifications"`
	EnableFoodSafetyNotifications bool  `json:"enable_food_safety_notifications"`
	// 免打扰开始时间
	DoNotDisturbStart pgtype.Time `json:"do_not_disturb_start"`
	// 免打扰结束时间
	DoNotDisturbEnd pgtype.Time        `json:"do_not_disturb_end"`
	CreatedAt       time.Time          `json:"created_at"`
	UpdatedAt       pgtype.Timestamptz `json:"updated_at"`
}

// 用户偏好表：基于行为和消费分析
type UserPreference struct {
	ID     int64 `json:"id"`
	UserID int64 `json:"user_id"`
	// JSON格式：{"川菜": 0.8, "粤菜": 0.6} - 菜系偏好得分
	CuisinePreferences []byte      `json:"cuisine_preferences"`
	PriceRangeMin      pgtype.Int8 `json:"price_range_min"`
	PriceRangeMax      pgtype.Int8 `json:"price_range_max"`
	AvgOrderAmount     pgtype.Int8 `json:"avg_order_amount"`
	// PostgreSQL数组：[11,12,18,19] - 常下单时段(小时)
	FavoriteTimeSlots []int32     `json:"favorite_time_slots"`
	PurchaseFrequency int16       `json:"purchase_frequency"`
	LastOrderDate     pgtype.Date `json:"last_order_date"`
	// JSON格式：{"川菜": 15, "粤菜": 8} - 购买次数统计
	TopCuisines []byte    `json:"top_cuisines"`
	UpdatedAt   time.Time `json:"updated_at"`
}

// 用户信任画像表（顾客）- 信用驱动异常处理
type UserProfile struct {
	ID     int64  `json:"id"`
	UserID int64  `json:"user_id"`
	Role   string `json:"role"`
	// 信任分，初始850（高信任），只有负面行为才扣分
	TrustScore         int16 `json:"trust_score"`
	TotalOrders        int32 `json:"total_orders"`
	CompletedOrders    int32 `json:"completed_orders"`
	CancelledOrders    int32 `json:"cancelled_orders"`
	TotalClaims        int32 `json:"total_claims"`
	MaliciousClaims    int32 `json:"malicious_claims"`
	FoodSafetyReports  int32 `json:"food_safety_reports"`
	VerifiedViolations int32 `json:"verified_violations"`
	// 近7天索赔次数（快速识别异常）
	Recent7dClaims int32 `json:"recent_7d_claims"`
	Recent7dOrders int32 `json:"recent_7d_orders"`
	// 近30天索赔次数（回溯检查）
	Recent30dClaims  int32 `json:"recent_30d_claims"`
	Recent30dOrders  int32 `json:"recent_30d_orders"`
	Recent30dCancels int32 `json:"recent_30d_cancels"`
	// 近90天索赔次数（长期趋势）
	Recent90dClaims int32              `json:"recent_90d_claims"`
	Recent90dOrders int32              `json:"recent_90d_orders"`
	IsBlacklisted   bool               `json:"is_blacklisted"`
	BlacklistReason pgtype.Text        `json:"blacklist_reason"`
	BlacklistedAt   pgtype.Timestamptz `json:"blacklisted_at"`
	UpdatedAt       time.Time          `json:"updated_at"`
}

type UserRole struct {
	ID     int64 `json:"id"`
	UserID int64 `json:"user_id"`
	// customer/merchant/rider/operator/staff
	Role string `json:"role"`
	// active/suspended
	Status string `json:"status"`
	// 关联实体ID（如商户ID、骑手ID等）
	RelatedEntityID pgtype.Int8 `json:"related_entity_id"`
	CreatedAt       time.Time   `json:"created_at"`
}

// M10: 用户代金券表
type UserVoucher struct {
	ID         int64              `json:"id"`
	VoucherID  int64              `json:"voucher_id"`
	UserID     int64              `json:"user_id"`
	Status     string             `json:"status"`
	OrderID    pgtype.Int8        `json:"order_id"`
	UsedAt     pgtype.Timestamptz `json:"used_at"`
	ObtainedAt time.Time          `json:"obtained_at"`
	ExpiresAt  time.Time          `json:"expires_at"`
}

// M10: 代金券模板表
type Voucher struct {
	ID              int64              `json:"id"`
	MerchantID      int64              `json:"merchant_id"`
	Code            string             `json:"code"`
	Name            string             `json:"name"`
	Description     pgtype.Text        `json:"description"`
	Amount          int64              `json:"amount"`
	MinOrderAmount  int64              `json:"min_order_amount"`
	TotalQuantity   int32              `json:"total_quantity"`
	ClaimedQuantity int32              `json:"claimed_quantity"`
	UsedQuantity    int32              `json:"used_quantity"`
	ValidFrom       time.Time          `json:"valid_from"`
	ValidUntil      time.Time          `json:"valid_until"`
	IsActive        bool               `json:"is_active"`
	CreatedAt       time.Time          `json:"created_at"`
	UpdatedAt       pgtype.Timestamptz `json:"updated_at"`
	// 允许使用的订单类型: takeout(外卖), dine_in(堂食), takeaway(外带), reservation(预定)
	AllowedOrderTypes []string           `json:"allowed_order_types"`
	DeletedAt         pgtype.Timestamptz `json:"deleted_at"`
}

// 天气系数记录表，定时抓取和风天气数据
type WeatherCoefficient struct {
	ID          int64     `json:"id"`
	RegionID    int64     `json:"region_id"`
	RecordedAt  time.Time `json:"recorded_at"`
	WeatherData []byte    `json:"weather_data"`
	WarningData []byte    `json:"warning_data"`
	// sunny/cloudy/rainy/heavy_rain/snowy/extreme
	WeatherType string `json:"weather_type"`
	// 和风天气图标代码
	WeatherCode pgtype.Text `json:"weather_code"`
	Temperature pgtype.Int2 `json:"temperature"`
	FeelsLike   pgtype.Int2 `json:"feels_like"`
	Humidity    pgtype.Int2 `json:"humidity"`
	// 风速（km/h）
	WindSpeed pgtype.Int2 `json:"wind_speed"`
	WindScale pgtype.Text `json:"wind_scale"`
	// 降水量（mm）
	Precip pgtype.Numeric `json:"precip"`
	// 能见度（km）
	Visibility pgtype.Int2 `json:"visibility"`
	// 是否有预警
	HasWarning bool `json:"has_warning"`
	// 预警类型代码，如1001=台风, 1003=暴雨
	WarningType pgtype.Text `json:"warning_type"`
	// 预警等级: blue/yellow/orange/red
	WarningLevel pgtype.Text `json:"warning_level"`
	// 严重程度: minor/moderate/severe/extreme
	WarningSeverity pgtype.Text `json:"warning_severity"`
	WarningText     pgtype.Text `json:"warning_text"`
	// 天气系数
	WeatherCoefficient pgtype.Numeric `json:"weather_coefficient"`
	// 预警系数
	WarningCoefficient pgtype.Numeric `json:"warning_coefficient"`
	// 最终系数 = max(天气系数, 预警系数)
	FinalCoefficient pgtype.Numeric `json:"final_coefficient"`
	// 是否暂停配送（极端天气）
	DeliverySuspended bool        `json:"delivery_suspended"`
	SuspendReason     pgtype.Text `json:"suspend_reason"`
	CreatedAt         time.Time   `json:"created_at"`
}

type WechatAccessToken struct {
	ID int64 `json:"id"`
	// miniprogram/official-account
	AppType     string    `json:"app_type"`
	AccessToken string    `json:"access_token"`
	ExpiresAt   time.Time `json:"expires_at"`
	CreatedAt   time.Time `json:"created_at"`
}

// 微信支付回调通知记录表，用于防止重复处理（幂等性）
type WechatNotification struct {
	// 微信通知ID，微信保证全局唯一
	ID string `json:"id"`
	// 通知事件类型
	EventType    string      `json:"event_type"`
	ResourceType pgtype.Text `json:"resource_type"`
	Summary      pgtype.Text `json:"summary"`
	// 商户订单号，用于关联业务订单
	OutTradeNo    pgtype.Text `json:"out_trade_no"`
	TransactionID pgtype.Text `json:"transaction_id"`
	// 通知处理完成时间
	ProcessedAt pgtype.Timestamp `json:"processed_at"`
	CreatedAt   pgtype.Timestamp `json:"created_at"`
}
