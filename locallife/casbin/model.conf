# Casbin RBAC Model for LocalLife Platform
# 
# This model supports:
# - Role-based access control (RBAC)
# - Path pattern matching for API routes
# - Action-based permission (HTTP methods)
#
# Request Format: sub, obj, act
# - sub: user role (admin, operator, merchant_owner, merchant_staff, rider, customer)
# - obj: resource path (e.g., /v1/platform/stats/*, /v1/operator/*)
# - act: HTTP method (GET, POST, PUT, DELETE, PATCH)
#
# Note: Region isolation and resource ownership are handled by dedicated middleware
# since they require database lookups for entity relationships.

[request_definition]
r = sub, obj, act

[policy_definition]
p = sub, obj, act

[role_definition]
# g: role inheritance (role -> parent role)
g = _, _

[policy_effect]
e = some(where (p.eft == allow))

[matchers]
# Match conditions:
# 1. Role matches directly or via inheritance (g)
# 2. Object matches (using keyMatch2 for path patterns like /v1/orders/:id)
# 3. Action matches (HTTP method)
m = g(r.sub, p.sub) && keyMatch2(r.obj, p.obj) && r.act == p.act
