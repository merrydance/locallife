<custom-navbar title="骑手入驻" showBack="{{true}}" bind:navheight="onNavHeight" />

<view class="page-container has-fixed-bottom" style="padding-top: {{navBarHeight}}px;">
  <view class="form-container">
    <!-- 1. 证照上传 (置顶) -->
    <view class="section-header">证照上传 (自动识别)</view>
    
    <view class="upload-group">
      <view class="upload-item">
        <view class="upload-label required">身份证正面</view>
        <document-uploader type="id-front" title="上传人像页" value="{{idCardFrontImages.length > 0 ? idCardFrontImages[0].url : ''}}" bind:change="onIdCardFrontUpload" bind:remove="onIdCardFrontRemove" />
      </view>
      
      <view class="upload-item">
        <view class="upload-label required">身份证反面</view>
        <document-uploader type="id-back" title="上传国徽页" value="{{idCardBackImages.length > 0 ? idCardBackImages[0].url : ''}}" bind:change="onIdCardBackUpload" bind:remove="onIdCardBackRemove" />
      </view>

      <view class="upload-item">
        <view class="upload-label required">健康证</view>
        <document-uploader type="permit" title="点击上传健康证" value="{{healthCertImages.length > 0 ? healthCertImages[0].url : ''}}" bind:change="onHealthCertUpload" bind:remove="onHealthCertRemove" />
      </view>
    </view>

    <!-- 拍摄要求引导 -->
    <view class="onboarding-guide">
      <view class="guide-title">
        <view class="guide-line"></view>
        <text>拍摄照片要求</text>
        <view class="guide-line"></view>
      </view>
      <view class="guide-list">
        <view class="guide-item">
          <view class="guide-img-box correct">
            <view class="guide-rect"></view>
            <t-icon name="check-circle-filled" size="32rpx" color="#4CAF50" class="guide-status-icon" />
          </view>
          <text>标准拍摄</text>
        </view>
        <view class="guide-item">
          <view class="guide-img-box error missing">
            <view class="guide-rect"></view>
            <t-icon name="close-circle-filled" size="32rpx" color="#F44336" class="guide-status-icon" />
          </view>
          <text>边框缺失</text>
        </view>
        <view class="guide-item">
          <view class="guide-img-box error blur">
            <view class="guide-rect"></view>
            <t-icon name="close-circle-filled" size="32rpx" color="#F44336" class="guide-status-icon" />
          </view>
          <text>照片模糊</text>
        </view>
        <view class="guide-item">
          <view class="guide-img-box error glare">
            <view class="guide-rect"></view>
            <t-icon name="close-circle-filled" size="32rpx" color="#F44336" class="guide-status-icon" />
          </view>
          <text>闪光强烈</text>
        </view>
      </view>
    </view>

    <!-- 2. 信息回填 (仅保留用户要求的核心信息) -->
    <view class="section-header">信息快速回填</view>
    <t-cell-group theme="card">
      <t-cell title="真实姓名" required>
        <input class="input" placeholder="识别回填" value="{{formData.name}}" bindinput="onNameInput" />
      </t-cell>
      <t-cell title="联系电话" required>
        <input class="input" placeholder="请输入联系电话" value="{{formData.phone}}" bindinput="onPhoneInput" />
      </t-cell>
      <t-cell title="性别" required>
        <input class="input" placeholder="识别回填" value="{{formData.gender}}" bindinput="onGenderInput" />
      </t-cell>
      <t-cell title="身份证号" required>
        <input class="input" placeholder="识别回填" value="{{formData.idCard}}" bindinput="onIdCardInput" />
      </t-cell>
       <t-cell title="身份证有效期" required>
        <input class="input" placeholder="识别回填" value="{{formData.idCardValidity}}" bindinput="onIdCardValidityInput" />
      </t-cell>
      <t-cell title="籍贯地址" required>
        <input class="input" placeholder="识别回填" value="{{formData.hometown}}" bindinput="onHometownInput" />
      </t-cell>
      <t-cell title="当前住址">
        <input class="input" placeholder="识别回填" value="{{formData.currentAddress}}" bindinput="onCurrentAddressInput" />
      </t-cell>
    </t-cell-group>

    <!-- 3. 配送设置 -->
    <view class="section-header">配送设置</view>
    <t-cell-group theme="card">
      <t-cell title="服务区域" arrow required bindtap="onChooseAddress">
        <view class="address-display {{formData.address ? '' : 'placeholder'}}">
          {{formData.address || '选择配送中心点'}}
        </view>
      </t-cell>
      <t-cell title="详细地址">
        <input class="input" placeholder="输入详细地址" value="{{formData.addressDetail}}" bindinput="onAddressDetailInput" />
      </t-cell>
      <t-cell title="配送载具" arrow required bindtap="onChooseVehicle">
        <view class="picker-text {{formData.vehicle ? '' : 'placeholder'}}">
          {{formData.vehicle || '请选择'}}
        </view>
      </t-cell>
      <t-cell title="配送时间" arrow required bindtap="onChooseTime">
        <view class="picker-text {{formData.availableTime ? '' : 'placeholder'}}">
          {{formData.availableTime || '请选择'}}
        </view>
      </t-cell>
    </t-cell-group>
  </view>
</view>

<!-- 选择器组件 -->
<t-picker
  visible="{{vehiclePickerVisible}}"
  value="{{vehiclePickerValue}}"
  data-key="vehicle"
  title="选择配送载具"
  cancelBtn="取消"
  confirmBtn="确认"
  bindconfirm="onVehicleConfirm"
  bindcancel="onVehicleCancel"
>
  <t-picker-item options="{{vehicleOptions}}" />
</t-picker>

<t-picker
  visible="{{timePickerVisible}}"
  value="{{timePickerValue}}"
  data-key="time"
  title="选择配送时间"
  cancelBtn="取消"
  confirmBtn="确认"
  bindconfirm="onTimeConfirm"
  bindcancel="onTimeCancel"
>
  <t-picker-item options="{{timeOptions}}" />
</t-picker>

<!-- 底部提交按钮 -->
<view class="fixed-bottom-bar">
  <t-button class="w-full" theme="primary" size="large" bindtap="onSubmit">
    提交申请
  </t-button>
</view>


