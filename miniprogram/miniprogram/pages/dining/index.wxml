<custom-navbar title="å ‚é£Ÿç‚¹é¤" showBack="{{true}}" bind:navheight="onNavHeight" />

<view class="page-container" style="padding-top: {{navBarHeight}}px; padding-bottom: 120rpx;">
  <t-loading wx:if="{{loading}}" theme="circular" size="40rpx" class="loading" />
  
  <view wx:if="{{!loading && session}}" class="content">
    <!-- æ¡Œå°ä¿¡æ¯ -->
    <view class="table-info">
      <view class="info-row">
        <text class="label">é¤å…:</text>
        <text class="value">{{session.merchant_name}}</text>
      </view>
      <view class="info-row">
        <text class="label">æ¡Œå°:</text>
        <text class="value">{{session.table_name}}</text>
      </view>
      <t-button class="call-btn" size="small" icon="service" bindtap="onCallWaiter">å‘¼å«æœåŠ¡å‘˜</t-button>
    </view>

    <!-- èœå“åˆ—è¡¨ -->
    <view class="dishes-container">
      <!-- å·¦ä¾§åˆ†ç±» -->
      <scroll-view class="category-sidebar" scroll-y>
        <view 
          wx:for="{{categories}}" 
          wx:key="id"
          class="category-item {{activeCategoryId === item.id ? 'active' : ''}}"
          data-id="{{item.id}}"
          bindtap="onCategoryChange"
        >
          {{item.name}}
        </view>
      </scroll-view>

      <!-- å³ä¾§èœå“ -->
      <scroll-view class="dishes-list" scroll-y>
        <view wx:for="{{dishes}}" wx:key="id" wx:if="{{item.category_id === activeCategoryId}}" class="dish-item">
          <t-image class="dish-image" src="{{item.image_url}}" mode="aspectFill" />
          <view class="dish-info">
            <text class="dish-name">{{item.name}}</text>
            <text class="dish-desc">{{item.description}}</text>
            <view class="dish-meta">
              <text class="rating">â­{{item.rating}}</text>
              <text class="price">Â¥{{item.priceDisplay}}</text>
            </view>
          </view>
          <t-button 
            class="add-btn" 
            size="small" 
            icon="add" 
            shape="circle" 
            theme="primary"
            data-id="{{item.id}}"
            bindtap="onAddCart"
          />
        </view>
      </scroll-view>
    </view>
  </view>
</view>

<!-- è´­ç‰©è½¦æ  -->
<view wx:if="{{!loading && session && cartCount > 0}}" class="cart-bar">
  <view class="cart-info">
    <text class="cart-count">ğŸ›’ {{cartCount}}ä»¶</text>
    <text class="cart-price">Â¥{{cartPriceDisplay}}</text>
  </view>
  <t-button class="submit-btn" theme="primary" bindtap="onSubmitOrder">ä¸‹å•</t-button>
</view>
