<!-- å‘˜å·¥ç®¡ç†é¡µé¢ - PC-SaaS å¸ƒå±€ -->
<wxs module="utils">
  module.exports = {
    formatDate: function(dateStr) {
      if (!dateStr) return '-'
      return dateStr.slice(0, 10)
    },
    getRoleName: function(role) {
      var map = {
        'owner': 'è€æ¿',
        'manager': 'åº—é•¿',
        'chef': 'å¨å¸ˆé•¿',
        'cashier': 'æ”¶é“¶å‘˜',
        'pending': 'å¾…åˆ†é…'
      }
      return map[role] || role
    },
    getRoleIcon: function(role) {
      var map = {
        'owner': 'ğŸ‘‘',
        'manager': 'ğŸ‘”',
        'chef': 'ğŸ‘¨â€ğŸ³',
        'cashier': 'ğŸ’°',
        'pending': 'â³'
      }
      return map[role] || 'ğŸ‘¤'
    },
    getRoleColor: function(role) {
      var map = {
        'owner': '#722ed1',
        'manager': '#1890ff',
        'chef': '#fa8c16',
        'cashier': '#52c41a',
        'pending': '#999'
      }
      return map[role] || '#666'
    }
  }
</wxs>

<!-- å°å±æç¤º -->
<match-media max-width="1599">
  <view class="desktop-only-notice">
    <view class="notice-box">
      <view class="notice-icon">ğŸ‘·</view>
      <text class="notice-title">æ­¤åŠŸèƒ½éœ€è¦åœ¨ç”µè„‘ç«¯ä½¿ç”¨</text>
      <text class="notice-desc">è¯·ä½¿ç”¨ 1600px ä»¥ä¸Šåˆ†è¾¨ç‡çš„æ˜¾ç¤ºå™¨è®¿é—®å‘˜å·¥ç®¡ç†</text>
      <navigator url="/pages/merchant/dashboard/index" class="btn-back">è¿”å›å·¥ä½œå°</navigator>
    </view>
  </view>
</match-media>

<!-- å¤§å±å¸ƒå±€ -->
<match-media min-width="1600">
  <view class="saas-layout">
    <!-- ä¸»åŒºåŸŸ -->
    <view class="main-area" style="margin-left: 0;">
      <!-- é¡µé¢å†…å®¹ -->
      <view class="page-container">
        <!-- é¡µé¢æ ‡é¢˜æ  -->
        <view class="page-header">
          <view class="page-title">
            <text class="title-icon">ğŸ‘·</text>
            <text class="title-text">å‘˜å·¥ç®¡ç†</text>
          </view>
          <view class="header-actions">
            <button class="btn-refresh" bindtap="onRefresh">
              <text class="btn-icon">ğŸ”„</text>
              åˆ·æ–°
            </button>
            <button class="btn-primary" bindtap="onGenerateInviteCode">
              <text class="btn-icon">ğŸ“¨</text>
              å‘˜å·¥é‚€è¯·ç 
            </button>
            <button class="btn-primary" bindtap="onGenerateBossCode">
              <text class="btn-icon">ğŸ†</text>
              Bossè®¤é¢†ç 
            </button>
          </view>
        </view>

        <!-- åŠ è½½çŠ¶æ€ -->
        <view wx:if="{{loading}}" class="loading-state">
          <view class="loading-spinner"></view>
          <text>åŠ è½½ä¸­...</text>
        </view>

        <!-- å‘˜å·¥åˆ—è¡¨ -->
        <view wx:else class="staff-list">
          <!-- ç©ºçŠ¶æ€ -->
          <view wx:if="{{staffList.length === 0}}" class="empty-state">
            <text class="empty-icon">ğŸ‘¥</text>
            <text class="empty-text">æš‚æ— å‘˜å·¥</text>
            <text class="empty-hint">ç‚¹å‡»"ç”Ÿæˆé‚€è¯·ç "é‚€è¯·å‘˜å·¥åŠ å…¥</text>
          </view>

          <!-- å‘˜å·¥è¡¨æ ¼ -->
          <view wx:else class="staff-table">
            <view class="table-header">
              <text class="col-name">å‘˜å·¥</text>
              <text class="col-role">è§’è‰²</text>
              <text class="col-status">çŠ¶æ€</text>
              <text class="col-date">åŠ å…¥æ—¶é—´</text>
              <text class="col-action">æ“ä½œ</text>
            </view>
            <view 
              wx:for="{{staffList}}" 
              wx:key="id" 
              class="table-row"
            >
              <view class="col-name">
                <image wx:if="{{item.avatar_url}}" class="staff-avatar" src="{{item.avatar_url}}" mode="aspectFill" />
                <view wx:else class="staff-avatar-placeholder">ğŸ‘¤</view>
                <text class="staff-name">{{item.full_name || 'æœªè®¾ç½®æ˜µç§°'}}</text>
              </view>
              <view class="col-role">
                <view class="role-tag" style="background: {{utils.getRoleColor(item.role)}}15; color: {{utils.getRoleColor(item.role)}}">
                  <text class="role-icon">{{utils.getRoleIcon(item.role)}}</text>
                  <text>{{utils.getRoleName(item.role)}}</text>
                </view>
              </view>
              <text class="col-status {{item.status === 'active' ? 'status-active' : (item.status === 'pending' ? 'status-pending' : 'status-inactive')}}">
                {{item.status === 'active' ? 'åœ¨èŒ' : (item.status === 'pending' ? 'å¾…åˆ†é…' : 'å·²ç¦»èŒ')}}
              </text>
              <text class="col-date">{{utils.formatDate(item.created_at)}}</text>
              <view class="col-action">
                <block wx:if="{{item.role !== 'owner'}}">
                  <!-- åœ¨èŒå‘˜å·¥ï¼šå¯ä¿®æ”¹è§’è‰²æˆ–ç§»é™¤ -->
                  <block wx:if="{{item.status === 'active'}}">
                    <button class="btn-sm btn-edit" data-id="{{item.id}}" bindtap="onEditRole">ä¿®æ”¹è§’è‰²</button>
                    <button class="btn-sm btn-danger" data-id="{{item.id}}" bindtap="onDeleteStaff">ç§»é™¤</button>
                  </block>
                  <!-- ç¦»èŒå‘˜å·¥ï¼šå¯é‡æ–°åˆ†é…è§’è‰²ï¼ˆæ¢å¤å…¥èŒï¼‰ -->
                  <block wx:elif="{{item.status === 'disabled'}}">
                    <button class="btn-sm btn-edit" data-id="{{item.id}}" bindtap="onEditRole">é‡æ–°å…¥èŒ</button>
                  </block>
                </block>
                <text wx:else class="owner-badge">åº—é“ºæ‰€æœ‰è€…</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
</match-media>

<!-- é‚€è¯·ç å¼¹çª— -->
<view wx:if="{{showInviteModal}}" class="modal-mask" bindtap="onCloseInviteModal">
  <view class="modal-content invite-modal" catchtap>
    <view class="modal-header">
      <text class="modal-title">å‘˜å·¥é‚€è¯·ç </text>
      <view class="modal-close" bindtap="onCloseInviteModal">Ã—</view>
    </view>
    
    <view wx:if="{{generating}}" class="modal-loading">
      <view class="loading-spinner"></view>
    </view>
    
    <view wx:else class="modal-body">
      <!-- QR ç æ˜¾ç¤ºåŒºåŸŸ -->
      <view class="qrcode-wrapper">
        <t-qrcode 
          value="{{inviteCodeUrl}}" 
          size="{{200}}"
          color="#000000"
          bgColor="#ffffff"
          level="M"
        />
      </view>
      
      <!-- é‚€è¯·ç æ–‡æœ¬ï¼ˆå¯é€‰å¤åˆ¶ï¼‰ -->
      <view class="invite-code-text">
        <text class="code-label">é‚€è¯·ç ï¼š</text>
        <text class="code-value">{{inviteCode}}</text>
      </view>
      
      <text class="invite-hint">å‘˜å·¥æ‰«æäºŒç»´ç æˆ–è¾“å…¥é‚€è¯·ç å³å¯åŠ å…¥åº—é“º</text>
      <text class="invite-expires">æœ‰æ•ˆæœŸè‡³ï¼š{{inviteExpiresAt}}</text>
      
      <view class="invite-actions">
        <button class="btn-outline btn-half" bindtap="onCopyInviteCode">å¤åˆ¶é‚€è¯·ç </button>
        <button class="btn-primary btn-half" bindtap="onSaveQRCode">ä¿å­˜äºŒç»´ç </button>
      </view>
    </view>
  </view>
</view>

<!-- Boss è®¤é¢†ç å¼¹çª— -->
<view wx:if="{{showBossCodeModal}}" class="modal-mask" bindtap="onCloseBossCodeModal">
  <view class="modal-content invite-modal" catchtap>
    <view class="modal-header">
      <text class="modal-title">ğŸ† Boss è®¤é¢†ç </text>
      <view class="modal-close" bindtap="onCloseBossCodeModal">Ã—</view>
    </view>
    
    <view wx:if="{{generatingBossCode}}" class="modal-loading">
      <t-loading size="40px" />
    </view>
    
    <view wx:else class="modal-body">
      <!-- QR ç æ˜¾ç¤ºåŒºåŸŸ -->
      <view class="qrcode-wrapper">
        <t-qrcode 
          value="{{bossCodeUrl}}" 
          size="{{200}}"
          color="#000000"
          bgColor="#ffffff"
          level="M"
        />
      </view>
      
      <!-- è®¤é¢†ç æ–‡æœ¬ï¼ˆå¯é€‰å¤åˆ¶ï¼‰ -->
      <view class="invite-code-text">
        <text class="code-label">è®¤é¢†ç ï¼š</text>
        <text class="code-value">{{bossBindCode}}</text>
      </view>
      
      <text class="invite-hint">Boss æ‰«æäºŒç»´ç æˆ–è¾“å…¥è®¤é¢†ç å³å¯è·å¾—ç®¡ç†æƒé™</text>
      <text class="invite-expires">æœ‰æ•ˆæœŸè‡³ï¼š{{bossCodeExpiresAt}}</text>
      
      <view class="invite-actions">
        <button class="btn-outline btn-half" bindtap="onCopyBossCode">å¤åˆ¶è®¤é¢†ç </button>
        <button class="btn-primary btn-half" bindtap="onSaveBossQRCode">ä¿å­˜äºŒç»´ç </button>
      </view>
    </view>
  </view>
</view>

<!-- ç¼–è¾‘è§’è‰²å¼¹çª— -->
<view wx:if="{{showEditModal}}" class="modal-mask" bindtap="onCloseEditModal">
  <view class="modal-content edit-modal" catchtap>
    <view class="modal-header">
      <text class="modal-title">ä¿®æ”¹å‘˜å·¥è§’è‰²</text>
      <view class="modal-close" bindtap="onCloseEditModal">Ã—</view>
    </view>
    
    <view class="modal-body">
      <view class="editing-staff-info">
        <image wx:if="{{editingStaff.avatar_url}}" class="edit-avatar" src="{{editingStaff.avatar_url}}" mode="aspectFill" />
        <view wx:else class="edit-avatar-placeholder">ğŸ‘¤</view>
        <text class="edit-name">{{editingStaff.full_name || 'æœªè®¾ç½®æ˜µç§°'}}</text>
      </view>
      
      <text class="form-label">é€‰æ‹©æ–°è§’è‰²</text>
      <view class="role-selector">
        <view 
          wx:for="{{roleOptions}}" 
          wx:key="value" 
          class="role-option {{selectedRole === item.value ? 'active' : ''}}"
          data-role="{{item.value}}"
          bindtap="onSelectRole"
        >
          <text class="option-icon">{{utils.getRoleIcon(item.value)}}</text>
          <text>{{item.label}}</text>
        </view>
      </view>
    </view>

    <view class="modal-footer">
      <button class="btn-cancel" bindtap="onCloseEditModal">å–æ¶ˆ</button>
      <button class="btn-primary" disabled="{{updating}}" bindtap="onSubmitRoleChange">
        {{updating ? 'ä¿å­˜ä¸­...' : 'ç¡®è®¤ä¿®æ”¹'}}
      </button>
    </view>
  </view>
</view>

<!-- åˆ é™¤ç¡®è®¤å¼¹çª— -->
<view wx:if="{{showDeleteModal}}" class="modal-mask" bindtap="onCloseDeleteModal">
  <view class="modal-content delete-modal" catchtap>
    <view class="modal-header">
      <text class="modal-title">ç¡®è®¤ç§»é™¤å‘˜å·¥</text>
      <view class="modal-close" bindtap="onCloseDeleteModal">Ã—</view>
    </view>
    
    <view class="modal-body">
      <view class="delete-warning">
        <text class="warning-icon">âš ï¸</text>
        <text class="warning-text">
          ç¡®å®šè¦ç§»é™¤å‘˜å·¥ "{{deletingStaff.full_name || 'æœªè®¾ç½®æ˜µç§°'}}" å—ï¼Ÿ
        </text>
        <text class="warning-hint">ç§»é™¤åè¯¥å‘˜å·¥å°†æ— æ³•è®¿é—®å•†æˆ·ç®¡ç†åŠŸèƒ½</text>
      </view>
    </view>

    <view class="modal-footer">
      <button class="btn-cancel" bindtap="onCloseDeleteModal">å–æ¶ˆ</button>
      <button class="btn-danger-primary" disabled="{{deleting}}" bindtap="onConfirmDelete">
        {{deleting ? 'ç§»é™¤ä¸­...' : 'ç¡®è®¤ç§»é™¤'}}
      </button>
    </view>
  </view>
</view>
