<!-- åº“å­˜ç®¡ç† - æ¡Œé¢çº§ SaaS ç•Œé¢ -->

<view class="saas-layout">
    <!-- ä¾§è¾¹æ  -->

    <!-- ä¸»åŒºåŸŸ -->
    <view class="main-area" style="margin-left: 0;">
      <!-- é¡¶éƒ¨æ  -->
      <merchant-header 
        merchant-name="{{merchantName}}"
        is-open="{{isOpen}}"
      />

      <!-- é¡µé¢å†…å®¹ - ä¸¤æ å¸ƒå±€ -->
      <view class="page-container inventory-page">
        <!-- å·¦ä¾§åˆ†ç±»åˆ—è¡¨ -->
        <view class="category-panel">
          <view class="panel-title">èœå“åˆ†ç±»</view>
          <view class="category-list">
            <view 
              class="category-item {{activeCategoryId === 'all' ? 'active' : ''}}"
              bindtap="onSelectCategory"
              data-id="all"
            >
              <text class="category-name">å…¨éƒ¨èœå“</text>
              <text class="category-count">{{allDishes.length}}</text>
            </view>
            <view 
              wx:for="{{categories}}"
              wx:key="id"
              class="category-item {{activeCategoryId === item.id ? 'active' : ''}}"
              bindtap="onSelectCategory"
              data-id="{{item.id}}"
            >
              <text class="category-name">{{item.name}}</text>
              <text class="category-count">{{item.dish_count || 0}}</text>
            </view>
          </view>
        </view>

        <!-- å³ä¾§åº“å­˜ç½‘æ ¼ -->
        <view class="inventory-panel">
          <!-- å·¥å…·æ  -->
          <view class="panel-header">
            <view class="header-title">
              <text class="title-text">ä»Šæ—¥åº“å­˜</text>
              <text class="title-date">{{todayDate}}</text>
            </view>
            <button 
              class="btn-save {{hasChanges ? 'active' : ''}}"
              disabled="{{!hasChanges || saving}}"
              bindtap="saveChanges"
            >
              {{saving ? 'ä¿å­˜ä¸­...' : ('ä¿å­˜ä¿®æ”¹' + (changedDishIds.length > 0 ? '(' + changedDishIds.length + ')' : ''))}}
            </button>
          </view>
          
          <!-- æç¤ºæ–‡å­— -->
          <view class="inventory-hint">
            <text>ğŸ’¡ ä¸å¡«å†™åº“å­˜é»˜è®¤ä¸ºæ— é™é‡ä¾›åº”ã€‚å¡«å†™åº“å­˜å¯é˜²æ­¢å½“æ—¥è¶…å–ã€‚</text>
          </view>

          <!-- åº“å­˜ç½‘æ ¼ -->
          <view class="inventory-content">
            <view wx:if="{{loading}}" class="loading-state">
              <text>åŠ è½½ä¸­...</text>
            </view>
            <view wx:elif="{{filteredDishes.length === 0}}" class="empty-state">
              <text class="empty-icon">ğŸ“¦</text>
              <text class="empty-text">æš‚æ— èœå“</text>
            </view>
            <view wx:else class="inventory-grid">
              <view 
                wx:for="{{filteredDishes}}"
                wx:key="id"
                class="inventory-card"
              >
                <image 
                  class="card-image" 
                  src="{{item.image_url || '/assets/images/dish-placeholder.png'}}" 
                  mode="aspectFill"
                />
                <view class="card-info">
                  <text class="card-name">{{item.name}}</text>
                  <text class="card-price">Â¥{{item.priceDisplay}}</text>
                </view>
                <view class="card-inventory">
                  <text class="inventory-label">åº“å­˜</text>
                  <input 
                    class="inventory-input {{item.inventory === 0 ? 'sold-out' : ''}}"
                    type="text"
                    value="{{item.inventory === -1 ? '' : item.inventory}}"
                    placeholder="æ— é™"
                    data-dish-id="{{item.id}}"
                    data-dish-name="{{item.name}}"
                    bindinput="onInventoryInput"
                  />
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>
</view>
