<custom-navbar title="退款详情" showBack="{{true}}" bind:navheight="onNavHeight" />

<view class="page" style="padding-top: {{navBarHeight}}px;">
  <t-loading wx:if="{{loading}}" theme="circular" size="40rpx" class="loading" />

  <block wx:if="{{!loading && refund}}">
    <!-- 退款状态卡片 -->
    <view class="status-card {{statusClass}}">
      <view class="status-icon">
        <t-icon wx:if="{{refund.status === 'success'}}" name="check-circle-filled" size="80rpx" color="#1d7a32" />
        <t-icon wx:elif="{{refund.status === 'pending' || refund.status === 'processing'}}" name="time-filled" size="80rpx" color="#ff9500" />
        <t-icon wx:elif="{{refund.status === 'failed'}}" name="close-circle-filled" size="80rpx" color="#e34d59" />
      </view>
      <view class="status-text">{{statusText}}</view>
      <view class="amount">{{amountDisplay}}</view>
    </view>

    <!-- 退款进度 -->
    <view class="progress-card">
      <view class="card-title">退款进度</view>
      <view class="progress-list">
        <view 
          wx:for="{{progress}}" 
          wx:key="title" 
          class="progress-item {{item.done ? 'done' : ''}} {{item.active ? 'active' : ''}}"
        >
          <view class="progress-dot"></view>
          <view class="progress-line" wx:if="{{index < progress.length - 1}}"></view>
          <view class="progress-content">
            <view class="progress-title">{{item.title}}</view>
            <view class="progress-time" wx:if="{{item.time}}">{{item.time}}</view>
          </view>
        </view>
      </view>
    </view>

    <!-- 退款信息 -->
    <view class="info-card">
      <view class="card-title">退款信息</view>
      <view class="info-row">
        <text class="label">退款类型</text>
        <text class="value">{{refundTypeText}}</text>
      </view>
      <view class="info-row">
        <text class="label">退款原因</text>
        <text class="value">{{refund.reason}}</text>
      </view>
      <view class="info-row">
        <text class="label">申请时间</text>
        <text class="value">{{refund.created_at}}</text>
      </view>
      <view class="info-row" wx:if="{{refund.processed_at}}">
        <text class="label">处理时间</text>
        <text class="value">{{refund.processed_at}}</text>
      </view>
      <view class="info-row" wx:if="{{refund.refund_transaction_id}}">
        <text class="label">退款单号</text>
        <text class="value">{{refund.refund_transaction_id}}</text>
      </view>
      <view class="info-row" wx:if="{{refund.failed_reason}}">
        <text class="label">失败原因</text>
        <text class="value error">{{refund.failed_reason}}</text>
      </view>
    </view>

    <!-- 提示信息 -->
    <view class="tips-card" wx:if="{{refund.status === 'pending' || refund.status === 'processing'}}">
      <t-icon name="info-circle" size="32rpx" color="#ff9500" />
      <text>退款将在1-3个工作日内原路退回</text>
    </view>
  </block>

  <view wx:if="{{!loading && !refund}}" class="empty">
    <t-empty description="未找到退款记录" />
  </view>
</view>
